<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Setting up Google Analytics API downloads to R</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 64px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 69px;
  margin-top: -69px;
}

.section h2 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h3 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h4 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h5 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h6 {
  padding-top: 69px;
  margin-top: -69px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">googleAnalyticsR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="setup.html">
    <span class="fa fa-wrench"></span>
     
    Setup
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-table"></span>
     
    Reporting APIs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="v4.html">
        <span class="fa fa-cogs"></span>
         
        v4 API
      </a>
    </li>
    <li>
      <a href="v3.html">
        <span class="fa fa-cog"></span>
         
        v3 API
      </a>
    </li>
    <li>
      <a href="big-query.html">
        <span class="fa fa-search"></span>
         
        BigQuery
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="management.html">
    <span class="fa fa-briefcase"></span>
     
    Management API
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-file"></span>
     
    Publishing
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="shiny.html">
        <span class="fa fa-cloud-upload"></span>
         
        Shiny
      </a>
    </li>
    <li>
      <a href="rmarkdown.html">
        <span class="fa fa-pencil-square"></span>
         
        RMarkdown
      </a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://developers.google.com/analytics/">
    <span class="fa fa-google fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/MarkEdmondson1234/googleAnalyticsR">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://docs.google.com/forms/d/e/1FAIpQLSerjirmMpB3b7LmBs_Vx_XPIE9IrhpCpPg1jUcpfBcivA3uBw/viewform">
    <span class="fa fa-slack fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Setting up Google Analytics API downloads to R</h1>

</div>


<div id="install" class="section level2">
<h2>Install</h2>
<p>The latest stable version of googleAnalyticsR is available on CRAN. <img src="http://www.r-pkg.org/badges/version/googleAnalyticsR" alt="CRAN" /></p>
<pre class="r"><code>install.package(&quot;googleAnalyticsR&quot;, dependencies = TRUE)</code></pre>
<div id="development-version-off-github" class="section level3">
<h3>Development version off github</h3>
<p>You may prefer to use the latest development version is on github which you can install via the below.</p>
<p>Github check status: <a href="https://travis-ci.org/MarkEdmondson1234/googleAnalyticsR"><img src="https://travis-ci.org/MarkEdmondson1234/googleAnalyticsR.svg?branch=master" alt="Travis-CI Build Status" /></a></p>
<pre class="r"><code>devtools::install_github(&quot;MarkEdmondson1234/googleAnalyticsR&quot;)</code></pre>
<p>Check out the <a href="https://github.com/MarkEdmondson1234/googleAnalyticsR/blob/master/NEWS.md">NEWS</a> to see whats currently available in each version.</p>
</div>
</div>
<div id="dependencies" class="section level2">
<h2>Dependencies</h2>
<p><code>googleAnalyticsR</code> requires the packages described in the <a href="https://github.com/MarkEdmondson1234/googleAnalyticsR/blob/master/DESCRIPTION"><code>Imports</code> field of the <code>DESCRIPTION</code> file</a> to be installed first, which it will do via <code>install.package(&quot;googleAnalyticsR&quot;, dependencies = TRUE)</code></p>
<p>Noteably, due to its reliance on <a href="https://CRAN.R-project.org/package=httr"><code>httr</code></a> and in turn <a href="https://CRAN.R-project.org/package=curl"><code>curl</code></a>, on linux systems it may require installation of these linux dependencies: <code>libssl-dev</code> and <code>libcurl4-openssl-dev</code>.</p>
</div>
<div id="authentication" class="section level2">
<h2>Authentication</h2>
<p>Authentication is done via the <a href="http://code.markedmondson.me/googleAuthR/articles/google-authentication-types.html"><code>googleAuthR</code></a> package, see there for advanced use cases.</p>
<pre class="r"><code>## setup
library(googleAnalyticsR)

## This should send you to your browser to authenticate your email.
## Authenticate with an email that has access to the Google Analytics View you want to use.
ga_auth()

## get your accounts
account_list &lt;- ga_account_list()

## pick a profile ID with data to query
ga_id &lt;- account_list[1,&#39;viewId&#39;]
</code></pre>
<p>Should you need to authenticate under a new user, use <code>ga_auth(new_user=TRUE)</code></p>
<p>When you authenticate it will create a <code>ga.oauth</code> file in your working directory. If that file is present, then you will not need to go via Google login when you next use <code>ga_auth()</code></p>
<p>You can specify the name and location of your cache file if you pass that to the <code>ga_auth()</code> function e.g.</p>
<pre class="r"><code>ga_auth(&quot;auth/my.oauth&quot;)</code></pre>
<p>…will create your authentication file in the relative folder called <code>auth</code> and name your cache file <code>my.oauth</code>.</p>
<p>It is recommended to specify your cache file when authenticating in an RMarkdown document.</p>
</div>
<div id="service-accounts" class="section level2">
<h2>Service accounts</h2>
<p>You can also authenticate by downloading a JSON file atached to a Google Cloud service account. More details are on the <a href="http://code.markedmondson.me/googleAuthR/articles/google-authentication-types.html#authentication-with-a-json-file-via-service-accounts"><code>googleAuthR</code> website</a>.</p>
<p>Make sure to add the service account as a user to your Google Analytics account so it has access to your Google Analytics data e.g. your service account email will look something like <code>xxxx@yyyyyy.iam.gserviceaccount.com</code> - add this email to your Google Analytics account in the Web Admin panel to the views you want it to read data from.</p>
</div>
<div id="auto-authentication" class="section level2">
<h2>Auto-authentication</h2>
<p>You can also choose to auto-authenticate by moving your authentication cache file to a global location on your computer, that all future R sessions will use.</p>
<p>This is done by creating an environment variable called <code>GA_AUTH_FILE</code> that points at a valid cache file. Once there, when you load the <code>googleAnalyticsR</code> library it will auto-authenticate with that token, meaning you will not need to call <code>ga_auth()</code> yourself as you would normally.</p>
<p>You can set environment variables using a <code>.Renviron</code> file or via the function <code>Sys.setenv()</code> - see <code>?Startup</code> for details. The first method is described below:</p>
<ol style="list-style-type: decimal">
<li>Choose your authentication cache file - either one you have generated via <code>ga_auth()</code> or or your own Google Project’s service account JSON ending with file extension <code>.json</code></li>
<li>Create a file called <code>.Renviron</code> and place it in your root directory (<code>~</code> on OSX/linux or <code>C:\\</code> on Windows). If using RStudio, you can find your root directory by clicking on the <code>Home</code> breadcrumb link in your File Explorer panel.</li>
<li>Place the absolute location of the file from step 1 into the <code>.Renviron</code> file, e.g. <code>GA_AUTH_FILE = &quot;/Users/mark/dev/auth/ga.oauth&quot;</code>.</li>
<li>Save the file and restart your R session.</li>
</ol>
<p>If all goes well you should see something similar to this when you load <code>googleAnalyticsR</code>:</p>
<pre class="r"><code>library(googleAnalyticsR)
#&gt;Successfully authenticated via /Users/mark/dev/auth/ga.oauth

## can do authenticated calls straight away
al &lt;- ga_account_list()</code></pre>
</div>
<div id="meta-data" class="section level2">
<h2>Meta data</h2>
<p>To see what dimensions and metrics are available via the API, you can use this command:</p>
<pre class="r"><code>## get a list of what metrics and dimensions you can use
ga_auth()
meta &lt;- google_analytics_meta()</code></pre>
<div class="figure">
<img src="meta_data_screenshot.png" />

</div>
<p>If offline, from <code>v0.2.0</code> this data is also available offline by typing <code>meta</code>, although it won’t be quite as up to date.</p>
<p>The meta data does not include multi-channel as they are not available to download, for those <a href="https://developers.google.com/analytics/devguides/reporting/mcf/dimsmets/">see the online version</a>.</p>
<p>When using the library, you can call metrics and dimensions with or without the <code>ga:</code> prefix (<code>mcf:</code> for multi-channel metrics/dimensions.)</p>
</div>
<div id="multiple-api-authentication" class="section level2">
<h2>Multiple API authentication</h2>
<p>If you are using more than one API for authentication (such as Search Console), then authenticate using <code>googleAuthR::gar_auth()</code> instead, to ensure you are authenticate with the correct scopes.</p>
</div>
<div id="your-own-google-project" class="section level2">
<h2>Your own Google Project</h2>
<p>With the amount of API calls possible with this library via batching and walking, its more likely the default shared Google API project will hit the 50,000 calls per day limit.</p>
<p>To mitigate that, use your own Google Developer Console Project key, so it is not shared across all users of this library.</p>
<p><a href="http://donalphipps.co.uk/">Donal Phipps</a> has very kindly created a screencast on how to set this up that you can find embedded below and via <a href="https://www.youtube.com/watch?v=4B88dRbwNfc">this link</a>.</p>
<iframe width="560" height="315" src="http://www.youtube.com/embed/4B88dRbwNfc?rel=0" frameborder="0" allowfullscreen>
</iframe>
<div id="example-adding-your-own-google-developer-console-keys" class="section level3">
<h3>Example adding your own Google Developer Console keys</h3>
<p>Set the options before any call to <code>ga_auth()</code> or other data fetching calls.</p>
<pre class="r"><code>options(googleAuthR.client_id = &quot;uxxxxxxx2fd4kesu6.apps.googleusercontent.com&quot;)
options(googleAuthR.client_secret = &quot;3JhLa_GxxxxxCQYLe31c64&quot;)
options(googleAuthR.scopes.selected = &quot;https://www.googleapis.com/auth/analytics&quot;)</code></pre>
<p>In the next example, the scopes are also set so a user can authenticate with <code>searchConsoleR</code> at the same time, which is possible as they both use <a href="http://code.markedmondson.me/googleAuthR/">googleAuthR</a> as a backend.</p>
<pre class="r"><code>options(googleAuthR.client_id = &quot;tuxxxxxxx2fd4kesu6.apps.googleusercontent.com&quot;)
options(googleAuthR.client_secret = &quot;3JhLa_GxxxxxCQYLe31c64&quot;)
options(googleAuthR.scopes.selected = c(&quot;https://www.googleapis.com/auth/analytics&quot;,
                                        &quot;https://www.googleapis.com/auth/webmasters&quot;))</code></pre>
<p>If you want to use with Shiny, then set the webapp clientId/secrets.</p>
<pre class="r"><code>options(googleAnalyticsR.webapp.client_id = &quot;xxxxx9pcab1u005cv.apps.googleusercontent.com&quot;)
options(googleAnalyticsR.webapp.client_secret = &quot;zcofxxxxxxElemXN5sf&quot;)</code></pre>
</div>
</div>

<ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/MarkEdmondson1234/googleAnalyticsR">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="http://twitter.com/HoloMarkeD">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://dk.linkedin.com/in/markpeteredmondson">
    <span class="fa fa-linkedin"></span>
     
  </a>
</li>
<li>
  <a href="http://code.markedmondson.me">
    <span class="fa fa-rss"></span>
     
    Blog
  </a>
</li>
      </ul>

<p>Copyright (c) 2018 Sunholo Ltd.  Released under <a target="_blank" href="https://opensource.org/licenses/MIT">MIT license.</a></p>
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-WFFMBH" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WFFMBH');</script>
<!-- End Google Tag Manager -->


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
