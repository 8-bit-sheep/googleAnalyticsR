<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Statistical models and visualisations with Google Analytics data • googleAnalyticsR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Statistical models and visualisations with Google Analytics data">
<meta property="og:description" content="googleAnalyticsR">
<meta property="og:image" content="https://code.markedmondson.me/googleAnalyticsR/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-47480439-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-47480439-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">googleAnalyticsR</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.8.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/setup.html">
    <span class="fas fa-wrench"></span>
     
    Setup
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-table"></span>
     
    Reporting APIs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/reporting-ga4.html">
        <span class="fas fa-digital-tachograph"></span>
         
        GA4 Data API
      </a>
    </li>
    <li>
      <a href="../articles/v4.html">
        <span class="fas fa-cogs"></span>
         
        v4 API
      </a>
    </li>
    <li>
      <a href="../articles/user-activity.html">
        <span class="fas fa-user"></span>
         
        User Activity API
      </a>
    </li>
    <li>
      <a href="../articles/v3.html">
        <span class="fas fa-cog"></span>
         
        v3 API
      </a>
    </li>
    <li>
      <a href="../articles/big-query.html">
        <span class="fas fa-search"></span>
         
        BigQuery
      </a>
    </li>
    <li>
      <a href="../articles/ganalytics.html">
        <span class="fas fa-bullseye"></span>
         
        ganalytics
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/management.html">
    <span class="fas fa-briefcase"></span>
     
    Management API
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-file"></span>
     
    Publishing
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/shiny.html">
        <span class="fas fa-cloud-upload"></span>
         
        Shiny
      </a>
    </li>
    <li>
      <a href="../articles/rmarkdown.html">
        <span class="fas fa-pencil-square"></span>
         
        RMarkdown
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/models.html">
    <span class="fas fa-calculator"></span>
     
    Models
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-question-circle"></span>
     
    Help
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../reference/index.html">
        <span class="fas fa-book-reader"></span>
         
        Function Reference
      </a>
    </li>
    <li>
      <a href="../news/index.html">
        <span class="fas fa-newspaper"></span>
         
        News
      </a>
    </li>
    <li>
      <a href="../articles/faq.html">
        <span class="fas fa-glasses"></span>
         
        FAQs
      </a>
    </li>
    <li>
      <a href="../articles/practical-tips.html">
        <span class="fas fa-bicycle"></span>
         
        Practical tips
      </a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MarkEdmondson1234/googleAnalyticsR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="models_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Statistical models and visualisations with Google Analytics data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MarkEdmondson1234/googleAnalyticsR/blob/master/vignettes/models.Rmd"><code>vignettes/models.Rmd</code></a></small>
      <div class="hidden name"><code>models.Rmd</code></div>

    </div>

    
    
<p>Downloading Google Analytics data is all well and good, but the reason most users want to use the API is to then operate and act upon that data.</p>
<p>There are several tutorials linked from the homepage that demonstrate various applications of using <code>googleAnalyticsR</code> to analyse data, but they can still be intimidating for new users of R.</p>
<p>To make it easier to distribute these analysis, <code>googleAnalyticsR</code> now includes the <code>ga_model_*</code> functions to help end users get to insights more quickly.</p>
<p><code>ga_model</code> objects can be saved to the new <code>.gamr</code> format. Loading these files using <code><a href="../reference/ga_model.html">ga_model()</a></code> and specifying your own Google Analytics viewId, all the data processing, modelling and visualisation steps can be encapsulated to give you the output.</p>
<p><code>.gamr</code> files also includes the ability to create Shiny modules which you can use to quickly create online Shiny dashboards displaying the model results, and which can switch to users own Google Analytics data using the multi-user login capabilities.</p>
<p>The <code>.gamr</code> file format can be shared with others online or within your organisation. A new R package that includes some more advanced examples is available from <a href="https://github.com/IronistM/googleAnalyticsModelR/"><code>IronistM/googleAnalyticsModelR/</code></a></p>
<div id="a-simple-example-loading-a-model-directly" class="section level2">
<h2 class="hasAnchor">
<a href="#a-simple-example-loading-a-model-directly" class="anchor"></a>A simple example loading a model directly</h2>
<p>The above loads models within a wrapper function, but you can also load model objects yourself via <code><a href="../reference/ga_model_load.html">ga_model_load()</a></code>. Included within the package are some simple models to demonstrate its use which use <code><a href="../reference/ga_model_load.html">ga_model_load()</a></code> to load from the package examples, via <code><a href="../reference/ga_model_example.html">ga_model_example()</a></code></p>
<p>The example below performs decomposition on the sessions to your website. Behind the scenes the model downloads your data with the right columns, applies the decomposition model then plots it, returning the data plotted for you to work with later:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://code.markedmondson.me/googleAnalyticsR/">googleAnalyticsR</a></span><span class="op">)</span>  <span class="co"># load library</span>

<span class="co"># your own Google Analytics viewID</span>
<span class="va">my_viewid</span> <span class="op">&lt;-</span> <span class="fl">81416156</span>

<span class="co"># load the model (equivalent to ga_model_load())</span>
<span class="va">decomp_ga</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_model_example.html">ga_model_example</a></span><span class="op">(</span><span class="st">"decomp_ga.gamr"</span><span class="op">)</span>

<span class="co"># apply model to your data</span>
<span class="va">d1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_model.html">ga_model</a></span><span class="op">(</span><span class="va">my_viewid</span>, model <span class="op">=</span> <span class="va">decomp_ga</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/unnamed-chunk-1-1.png" alt=""><p class="caption">plot of chunk unnamed-chunk-1</p>
</div>
<p>This model allows you to alter the date range of the data fetched:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># change default date range to 20 days ago to yesterday</span>
<span class="va">d2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_model.html">ga_model</a></span><span class="op">(</span><span class="va">my_viewid</span>, model <span class="op">=</span> <span class="va">decomp_ga</span>, date_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"20daysAgo"</span>,<span class="st">"yesterday"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/unnamed-chunk-2-1.png" alt=""><p class="caption">plot of chunk unnamed-chunk-2</p>
</div>
<p>You can examine the properties of the model and the arguments it was sent via its print method:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">decomp_ga</span></code></pre></div>
<pre><code>## ==ga_model object==
## Description:  Performs decomposition and creates a plot 
## Data args:    viewId date_range 
## Input data:   date sessions 
## Model args:   df 
## Output args:  x y 
## Packages:</code></pre>
<p>You can also see an overview on how a particular call to a model was created by printing out the model’s result directly to console:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d2</span></code></pre></div>
<pre><code>## ==ga_model_result object==
## Input names:        date sessions 
## Input dimensions:   20 2 
## Output names:       x seasonal trend random figure type 
## Plot class:         NULL 
## Model args passed:  date_range = c("20daysAgo", "yesterday") 
## ==ga_model object==
## Description:  Performs decomposition and creates a plot 
## Data args:    viewId date_range 
## Input data:   date sessions 
## Model args:   df 
## Output args:  x y 
## Packages:</code></pre>
<p>And if you want to review the code of the model, use <code><a href="../reference/ga_model_write.html">ga_model_write()</a></code> to write the functions out to a file.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ga_model_write.html">ga_model_write</a></span><span class="op">(</span><span class="va">decomp_ga</span>, <span class="st">"my_model.R"</span><span class="op">)</span></code></pre></div>
</div>
<div id="shiny-templates-for-ga_model-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#shiny-templates-for-ga_model-objects" class="anchor"></a>Shiny templates for ga_model objects</h2>
<p>There are Shiny templates available that can be used with model objects to quickly create Shiny apps for users. For example:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ga_model_shiny.html">ga_model_shiny</a></span><span class="op">(</span><span class="st">"inst/models/decomp_ga.gamr"</span>, template <span class="op">=</span> <span class="fu"><a href="../reference/ga_model_shiny_template.html">ga_model_shiny_template</a></span><span class="op">(</span><span class="st">"template1"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Templates can be created and parsed via <code>{{ var }}</code> templating rules. The default variables used in all templates are <code>web_json</code>, <code>scopes</code> (for Google auth), and <code>title</code>. You can pass other template specific ones via the <code>...</code> argument. The <code>ga_model</code> argument is used to load the previously created <code>ga_model</code> object into the Shiny app.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://code.markedmondson.me/googleAuthR/">googleAuthR</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://code.markedmondson.me/googleAnalyticsR/">googleAnalyticsR</a></span><span class="op">)</span>

<span class="fu"><a href="https://code.markedmondson.me/googleAuthR//reference/gar_set_client.html">gar_set_client</a></span><span class="op">(</span>web_json <span class="op">=</span> <span class="st">"{{ web_json }}"</span>,
               scopes <span class="op">=</span> <span class="st">"{{ scopes }}"</span><span class="op">)</span>

<span class="co"># loads a pre-existing model</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_model_load.html">ga_model_load</a></span><span class="op">(</span><span class="st">"{{ ga_model }}"</span><span class="op">)</span>

<span class="va">modelUi</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="va">shiny_module</span><span class="op">$</span><span class="va">ui</span>
<span class="va">modelServer</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="va">shiny_module</span><span class="op">$</span><span class="va">server</span>

<span class="co">## ui.R</span>
<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"{{ shiny_title }}"</span>,
                <span class="fu"><a href="../reference/authDropdownUI.html">authDropdownUI</a></span><span class="op">(</span><span class="st">"auth_menu"</span><span class="op">)</span>,
                <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">h2</a></span><span class="op">(</span><span class="st">"Model Description"</span><span class="op">)</span>,
                <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html">textOutput</a></span><span class="op">(</span><span class="st">"model_description"</span><span class="op">)</span>,
                <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">h2</a></span><span class="op">(</span><span class="st">"Model Output"</span><span class="op">)</span>,
                <span class="fu">modelUi</span><span class="op">(</span><span class="st">"{{ ga_model_name }}"</span><span class="op">)</span>
                
<span class="op">)</span>

<span class="co">## server.R</span>
<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span><span class="op">{</span>
  
  <span class="va">token</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://code.markedmondson.me/googleAuthR//reference/gar_shiny_auth.html">gar_shiny_auth</a></span><span class="op">(</span><span class="va">session</span><span class="op">)</span>
  
  <span class="va">al</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html">req</a></span><span class="op">(</span><span class="va">token</span><span class="op">)</span>
    <span class="fu"><a href="../reference/ga_account_list.html">ga_account_list</a></span><span class="op">(</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
  
  <span class="co"># module for authentication</span>
  <span class="va">view_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/callModule.html">callModule</a></span><span class="op">(</span><span class="va">authDropdown</span>, <span class="st">"auth_menu"</span>, ga.table <span class="op">=</span> <span class="va">al</span><span class="op">)</span>
  <span class="va">output</span><span class="op">$</span><span class="va">model_description</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderText</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">description</span><span class="op">)</span>
  
  <span class="co"># module to display model results</span>
  <span class="fu">modelServer</span><span class="op">(</span><span class="st">"{{ ga_model_name }}"</span>, view_id <span class="op">=</span> <span class="va">view_id</span><span class="op">)</span>
  
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="fu"><a href="https://code.markedmondson.me/googleAuthR//reference/gar_shiny_ui.html">gar_shiny_ui</a></span><span class="op">(</span><span class="va">ui</span>, login_ui <span class="op">=</span> <span class="va">silent_auth</span><span class="op">)</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<div id="models-and-templates-included-with-googleanalyticsr" class="section level3">
<h3 class="hasAnchor">
<a href="#models-and-templates-included-with-googleanalyticsr" class="anchor"></a>Models and Templates included with googleAnalyticsR</h3>
<p>There are some pre-created models and templates to help inspire your own. At the moment these are:</p>
<p><em>Models - accessed via <code><a href="../reference/ga_model_example.html">ga_model_example()</a></code></em></p>
<ul>
<li>
<code>"ga4-trend"</code> - Fetch GA4 time-series, display via Dygraphs</li>
<li>
<code>"ga-effect"</code> - Fetch UA time-series and use with CausalImpact</li>
<li>
<code>"decomp_ga"</code> - Fetch UA time-series and perform decomposition on them.</li>
</ul>
<p><em>Templates - accessed via <code><a href="../reference/ga_model_shiny_template.html">ga_model_shiny_template()</a></code></em></p>
<ul>
<li>
<code>"template_ga4"</code> - A basic Shiny dashboard with an account selector for GA4</li>
<li>
<code>"template_ua"</code> - A basic Shiny dashboard with an account selector for UA</li>
<li>
<code>"shinydashboard_ga4"</code> - Account selector for GA4 plus date picker using <code><a href="https://rdrr.io/r/base/library.html">library(shinydashboard)</a></code> styling.</li>
</ul>
</div>
</div>
<div id="creating-model--gamr-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-model--gamr-objects" class="anchor"></a>Creating model <code>.gamr</code> objects</h2>
<p>To create your own models, you need to predefine all the functions to look after the fetching, modelling and viewing of the data. You then pass those functions to the <code><a href="../reference/ga_model_make.html">ga_model_make()</a></code> function.</p>
<p>The functions need to follow these specifications:</p>
<ul>
<li>
<code>data_f</code> - A function to collect the data you will need. The first argument should be the <code>view_id</code> which will be pass the viewId of Google Analytics property to fetch data from.</li>
<li>
<code>model_f</code> - A function to work with the data you have fetched. The first argument should be the data.frame that is produced by the data fetching function, <code>data_f()</code>.</li>
<li>
<code>output_f</code> - A function to plot the data. The first argument should be the data.frame that is produced by the model function, <code>model_f()</code>.</li>
<li>All functions you create must include <code>...</code> as an argument.</li>
<li>Take care if you use the same argument name that it is consistent with all functions as it will be passed to all of them.</li>
</ul>
<p>If you want to also create the Shiny modules, then you also need to specify:</p>
<ul>
<li>
<code>outputShiny</code> - the output function for the UI, such as <code>plotOutput</code>
</li>
<li>
<code>renderShiny</code> - the render function for the server, such as <code>renderPlot</code>
</li>
</ul>
<p>You then supply supporting information to make sure the user can run the model:</p>
<ul>
<li>
<code>required_columns</code> - Specification of which columns the data will fetch. It will fail if they are not present.</li>
<li>
<code>required_packages</code> - The packages the end user needs to have installed to run your functions.</li>
<li>
<code>description</code> - A sentence on what the model is so they can be distinguished.</li>
</ul>
<p>To create the decomposition example model, this was applied as shown below:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">get_model_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">viewId</span>,
                           <span class="va">date_range</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span> <span class="fl">300</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,
                           <span class="va">...</span><span class="op">)</span><span class="op">{</span>
   <span class="fu"><a href="../reference/google_analytics.html">google_analytics</a></span><span class="op">(</span><span class="va">viewId</span>,
                    date_range <span class="op">=</span> <span class="va">date_range</span>,
                    metrics <span class="op">=</span> <span class="st">"sessions"</span>,
                    dimensions <span class="op">=</span> <span class="st">"date"</span>,
                    max <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>
 <span class="op">}</span>

<span class="va">decompose_sessions</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span>
   <span class="fu"><a href="https://rdrr.io/r/stats/decompose.html">decompose</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/ts.html">ts</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">sessions</span>, frequency <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>
 <span class="op">}</span>
 
<span class="va">decomp_ga</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_model_make.html">ga_model_make</a></span><span class="op">(</span><span class="va">get_model_data</span>,
                           required_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"sessions"</span><span class="op">)</span>,
                           model_f <span class="op">=</span> <span class="va">decompose_sessions</span>,
                           output_f <span class="op">=</span> <span class="fu">graphics</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>,
                           description <span class="op">=</span> <span class="st">"Performs decomposition and creates a plot"</span>,
                           outputShiny <span class="op">=</span> <span class="fu">shiny</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span>,
                           renderShiny <span class="op">=</span> <span class="fu">shiny</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="advanced-use" class="section level2">
<h2 class="hasAnchor">
<a href="#advanced-use" class="anchor"></a>Advanced use</h2>
<p>The more arguments you provide to the model creation functions, the more complicated it is for the end user, but the more flexible the model. It is suggested making several narrow usage models is better than one complicated one.</p>
<p>For instance, you could modify the above model to allow the end user to specify the metric, timespan and seasonality of the decomposition:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">get_model_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">viewId</span>,
                           <span class="va">date_range</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span> <span class="fl">300</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,
                           <span class="va">metric</span>,
                           <span class="va">...</span><span class="op">)</span><span class="op">{</span>
   <span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/google_analytics.html">google_analytics</a></span><span class="op">(</span><span class="va">viewId</span>,
                    date_range <span class="op">=</span> <span class="va">date_range</span>,
                    metrics <span class="op">=</span> <span class="va">metric</span>,
                    dimensions <span class="op">=</span> <span class="st">"date"</span>,
                    max <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>
    <span class="co"># rename the metric column so its found for modelling</span>
    <span class="va">o</span><span class="op">$</span><span class="va">the_metric</span> <span class="op">&lt;-</span> <span class="va">o</span><span class="op">[</span>, <span class="va">metric</span><span class="op">]</span>
    
    <span class="va">o</span>
    
 <span class="op">}</span>

<span class="va">decompose_sessions</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">frequency</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span>
   <span class="fu"><a href="https://rdrr.io/r/stats/decompose.html">decompose</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/ts.html">ts</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">the_metric</span>, frequency <span class="op">=</span> <span class="va">frequency</span><span class="op">)</span><span class="op">)</span>
 <span class="op">}</span>
 
<span class="va">decomp_ga_advanced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_model_make.html">ga_model_make</a></span><span class="op">(</span><span class="va">get_model_data</span>,
                           required_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, <span class="co"># less restriction on column</span>
                           model_f <span class="op">=</span> <span class="va">decompose_sessions</span>,
                           output_f <span class="op">=</span> <span class="fu">graphics</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>,
                           description <span class="op">=</span> <span class="st">"Performs decomposition and creates a plot"</span>,
                           outputShiny <span class="op">=</span> <span class="fu">shiny</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span>,
                           renderShiny <span class="op">=</span> <span class="fu">shiny</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">)</span></code></pre></div>
<p>It would then be used via:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_model.html">ga_model</a></span><span class="op">(</span><span class="fl">81416156</span>, <span class="va">decomp_ga_advanced</span>, metric<span class="op">=</span><span class="st">"users"</span>, frequency <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/unnamed-chunk-6-1.png" alt=""><p class="caption">plot of chunk unnamed-chunk-6</p>
</div>
<div id="working-with-the-model-object" class="section level3">
<h3 class="hasAnchor">
<a href="#working-with-the-model-object" class="anchor"></a>Working with the model object</h3>
<p>The model objects prints to console in a friendly manner:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">decomp_ga_advanced</span></code></pre></div>
<pre><code>## ==ga_model object==
## Description:  Performs decomposition and creates a plot 
## Data args:    viewId date_range metric 
## Input data:   date 
## Model args:   df frequency 
## Output args:  x y 
## Packages:</code></pre>
<p>You can save and load model objects from a file. It is suggested to save them with the <code>.gamr</code> suffix.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># save model to a file</span>
<span class="fu"><a href="../reference/ga_model_save.html">ga_model_save</a></span><span class="op">(</span><span class="va">decomp_ga_advanced</span>, filename <span class="op">=</span> <span class="st">"my_model.gamr"</span><span class="op">)</span>

<span class="co"># load model again</span>
<span class="fu"><a href="../reference/ga_model_load.html">ga_model_load</a></span><span class="op">(</span><span class="st">"my_model.gamr"</span><span class="op">)</span></code></pre></div>
<p>You can use models directly from the file:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ga_model.html">ga_model</a></span><span class="op">(</span><span class="fl">81416156</span>, <span class="st">"my_model.gamr"</span><span class="op">)</span></code></pre></div>
<p>If you need to change parts of a model, <code><a href="../reference/ga_model_edit.html">ga_model_edit()</a></code> lets you change individual aspects:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ga_model_edit.html">ga_model_edit</a></span><span class="op">(</span><span class="va">decomp_ga_advanced</span>, description <span class="op">=</span> <span class="st">"New description"</span><span class="op">)</span></code></pre></div>
<pre><code>## ==ga_model object==
## Description:  New description 
## Data args:    viewId date_range metric 
## Input data:   date 
## Model args:   df frequency 
## Packages:</code></pre>
<p>You can also pass it the filename, which will load, make the edit, then save the model to disk again:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ga_model_edit.html">ga_model_edit</a></span><span class="op">(</span><span class="st">"my_model.gamr"</span>, description <span class="op">=</span> <span class="st">"New description"</span><span class="op">)</span></code></pre></div>
<p>If you want to examine or change the functions in a model, you can use <code><a href="../reference/ga_model_write.html">ga_model_write()</a></code> to write them to a file, or examine them directly from the model object. The structure of the model object can be examined using <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">decomp_ga_advanced</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## List of 7
##  $ data_f           :function (viewId, date_range = c(Sys.Date() - 300, Sys.Date()), metric, ...)  
##  $ required_columns : chr "date"
##  $ model_f          :function (df, frequency, ...)  
##  $ output_f         :function (x, y, ...)  
##  $ required_packages: NULL
##  $ description      : chr "Performs decomposition and creates a plot"
##  $ shiny_module     :List of 2
##   ..$ ui    :function (id, ...)  
##   ..$ server:function (input, output, session, view_id, ...)</code></pre>
<p>And you can access various elements by the usual list methods:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">decomp_ga_advanced</span><span class="op">$</span><span class="va">data_f</span></code></pre></div>
<pre><code>## function(viewId,
##                            date_range = c(Sys.Date()- 300, Sys.Date()),
##                            metric,
##                            ...){
##    o &lt;- google_analytics(viewId,
##                     date_range = date_range,
##                     metrics = metric,
##                     dimensions = "date",
##                     max = -1)
##     # rename the metric column so its found for modelling
##     o$the_metric &lt;- o[, metric]
##     
##     o
##     
##  }</code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">decomp_ga_advanced</span><span class="op">$</span><span class="va">description</span></code></pre></div>
<pre><code>## [1] "Performs decomposition and creates a plot"</code></pre>
</div>
</div>
<div id="ga-effect-with-ga_models" class="section level2">
<h2 class="hasAnchor">
<a href="#ga-effect-with-ga_models" class="anchor"></a>GA Effect with ga_models</h2>
<p>To make your own portable <a href="https://gallery.shinyapps.io/ga-effect/">GA Effect</a>, this model uses the CausalImpact and dygraphs libraries to make a plot of your GA data.</p>
<p>This example model is available via <code><a href="../reference/ga_model_example.html">ga_model_example("ga-effect.gamr")</a></code></p>
<div id="get-data" class="section level3">
<h3 class="hasAnchor">
<a href="#get-data" class="anchor"></a>Get data</h3>
<p>The data will focus on sessions per channel grouping. For this example the end user can select the date range, but we set a default of the last 600 days.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">get_ci_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">viewId</span>, 
                        <span class="va">date_range</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="fl">600</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,
                        <span class="va">...</span><span class="op">)</span><span class="op">{</span>
  
  <span class="fu"><a href="../reference/google_analytics.html">google_analytics</a></span><span class="op">(</span><span class="va">viewId</span>, 
                   date_range <span class="op">=</span> <span class="va">date_range</span>,
                   metrics <span class="op">=</span> <span class="st">"sessions"</span>,
                   dimensions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"channelGrouping"</span><span class="op">)</span>, 
                   max <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The modelling step is copied over from the <a href="http://www.dartistics.com/timeseries.html">dartistics.com time-services example</a>.</p>
<p>The function transforms the data into the right shape, and performs the CausalImpact model. The user can select the event date to examine, the channel to test (response) and possible predictors to help the model.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># response_dim is the channel to predict.</span>
<span class="co"># predictors help with forecast</span>
<span class="va">do_ci</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, 
                  <span class="va">event_date</span>,
                  <span class="va">response</span> <span class="op">=</span> <span class="st">"Organic Search"</span>,
                  <span class="va">predictors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Video"</span>,<span class="st">"Social"</span>,<span class="st">"Direct"</span><span class="op">)</span>,
                  <span class="va">...</span><span class="op">)</span><span class="op">{</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"CausalImpact input data columns: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span><span class="op">)</span>
  <span class="co"># restrict to one response </span>
  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">is.character</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span>, 
            <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span>,
            <span class="fu">assertthat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/assertthat/man/assert-is.html">is.date</a></span><span class="op">(</span><span class="va">event_date</span><span class="op">)</span>,
            <span class="fu"><a href="https://rdrr.io/r/base/character.html">is.character</a></span><span class="op">(</span><span class="va">predictors</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">pivoted</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">%&gt;%</span> 
    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span><span class="op">(</span><span class="va">channelGrouping</span>, <span class="va">sessions</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="va">response</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">pivoted</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co">## create a time-series zoo object</span>
  <span class="va">web_data_xts</span> <span class="op">&lt;-</span> <span class="fu">xts</span><span class="fu">::</span><span class="fu">xts</span><span class="op">(</span><span class="va">pivoted</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, order.by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">pivoted</span><span class="op">$</span><span class="va">date</span><span class="op">)</span>, frequency <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>
  
  <span class="va">pre.period</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">date</span><span class="op">)</span>, <span class="va">event_date</span><span class="op">)</span><span class="op">)</span>
  <span class="va">post.period</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">event_date</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">date</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">predictors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">intersect</a></span><span class="op">(</span><span class="va">predictors</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">web_data_xts</span><span class="op">)</span><span class="op">)</span>

  <span class="co">## data in order of response, predictor1, predictor2, etc.</span>
  <span class="va">model_data</span> <span class="op">&lt;-</span> <span class="va">web_data_xts</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">response</span>,<span class="va">predictors</span><span class="op">)</span><span class="op">]</span>
  
  <span class="co"># deal with names</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">model_data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/make.names.html">make.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">model_data</span><span class="op">)</span><span class="op">)</span>
  <span class="co"># remove any NAs</span>
  <span class="va">model_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">model_data</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>

  <span class="fu">CausalImpact</span><span class="fu">::</span><span class="fu">CausalImpact</span><span class="op">(</span><span class="va">model_data</span>,  <span class="va">pre.period</span>, <span class="va">post.period</span><span class="op">)</span>

<span class="op">}</span></code></pre></div>
<p>Finally the CausalImpact model is sent into Dygraphs for interactive visualisation. The event date is the same as the one sent to the modelling step, and used to indicate it on the plot:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dygraph_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">impact</span>, <span class="va">event_date</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span>

  <span class="co">## the data for the plot is in here</span>
  <span class="va">ci</span> <span class="op">&lt;-</span> <span class="va">impact</span><span class="op">$</span><span class="va">series</span>
  
  <span class="va">ci</span> <span class="op">&lt;-</span> <span class="fu">xts</span><span class="fu">::</span><span class="fu">xts</span><span class="op">(</span><span class="va">ci</span><span class="op">)</span>

  <span class="co">## the dygraph output</span>
  <span class="fu">dygraph</span><span class="op">(</span>data<span class="op">=</span><span class="va">ci</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'response'</span>, 
                     <span class="st">'point.pred'</span>, <span class="st">'point.pred.lower'</span>, <span class="st">'point.pred.upper'</span><span class="op">)</span><span class="op">]</span>, 
          main<span class="op">=</span><span class="st">"Expected (95% confidence level) vs Observed"</span>, group<span class="op">=</span><span class="st">"ci"</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dyEvent</span><span class="op">(</span>x <span class="op">=</span> <span class="va">event_date</span>, <span class="st">"Event"</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dySeries</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'point.pred.lower'</span>, <span class="st">'point.pred'</span>,<span class="st">'point.pred.upper'</span><span class="op">)</span>, 
             label<span class="op">=</span><span class="st">'Expected'</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dySeries</span><span class="op">(</span><span class="st">'response'</span>, label<span class="op">=</span><span class="st">"Observed"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The main functions done, we now specify which R packages the model needs the user to load.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">req_packs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CausalImpact"</span>, <span class="st">"xts"</span>, <span class="st">"tidyr"</span>, <span class="st">"googleAnalyticsR"</span>, <span class="st">"assertthat"</span>, <span class="st">"dygraphs"</span><span class="op">)</span></code></pre></div>
<p>Finally we make the model, specifying which columns we expect the data to fetch, a description and specifying which Shiny functions are needed to show the dygraph if the model is used in a Shiny app.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ci_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_model_make.html">ga_model_make</a></span><span class="op">(</span><span class="va">get_ci_data</span>,
                          required_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"date"</span>,<span class="st">"channelGrouping"</span>,<span class="st">"sessions"</span><span class="op">)</span>,
                          model_f <span class="op">=</span> <span class="va">do_ci</span>,
                          output_f <span class="op">=</span> <span class="va">dygraph_plot</span>,
                          required_packages <span class="op">=</span> <span class="va">req_packs</span>,
                          description <span class="op">=</span> <span class="st">"Causal Impact on channelGrouping data"</span>,
                          outputShiny <span class="op">=</span> <span class="fu">dygraphs</span><span class="fu">::</span><span class="va">dygraphOutput</span>,
                          renderShiny <span class="op">=</span> <span class="fu">dygraphs</span><span class="fu">::</span><span class="va">renderDygraph</span><span class="op">)</span>
<span class="co"># print out model details</span>
<span class="va">ci_model</span></code></pre></div>
<pre><code>## ==ga_model object==
## Description:  Causal Impact on channelGrouping data 
## Data args:    viewId date_range 
## Input data:   date channelGrouping sessions 
## Model args:   df event_date response predictors 
## Output args:  impact event_date 
## Packages:     CausalImpact xts tidyr googleAnalyticsR assertthat dygraphs</code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># save it to a file for use later</span>
<span class="fu"><a href="../reference/ga_model_save.html">ga_model_save</a></span><span class="op">(</span><span class="va">ci_model</span>, <span class="st">"causalImpact_model.gamr"</span><span class="op">)</span></code></pre></div>
<p>To use and make an interactive plot:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://code.markedmondson.me/googleAnalyticsR/">googleAnalyticsR</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">CausalImpact</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">xts</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">dygraphs</span><span class="op">)</span>

<span class="va">ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_model.html">ga_model</a></span><span class="op">(</span><span class="fl">81416156</span>, <span class="va">ci_model</span>, event_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2019-01-01"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># print to show the plot object</span>
<span class="va">ci</span><span class="op">$</span><span class="va">plot</span></code></pre></div>
<div class="figure">
<img src="figure/unnamed-chunk-16-1.png" alt=""><p class="caption">plot of chunk unnamed-chunk-16</p>
</div>
<p>That can display interactively in a tweet:</p>
<blockquote class="twitter-tweet">
<p lang="en" dir="ltr">
An example for the documentation - CausalImpact/Dygraphs with ga_models <a href="https://t.co/9qfvi3uvLc">https://t.co/9qfvi3uvLc</a>
</p>
— Mark Edmondson (<span class="citation">@HoloMarkeD</span>) <a href="https://twitter.com/HoloMarkeD/status/1106958249130119169?ref_src=twsrc%5Etfw">March 16, 2019</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>Similarly, you can launch this in a Shiny app by slightly modifying the Shiny example used previously.</p>
<p>This is available within the package via <code><a href="https://rdrr.io/pkg/shiny/man/runApp.html">shiny::runApp(system.file("shiny/models-ga-effect", package="googleAnalyticsR"))</a></code></p>
<p><img src="model-ga-effect.png"></p>
<p>Dress it up in a nice theme and add some more inputs and outputs and you are close to the finished result.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Mark Edmondson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
