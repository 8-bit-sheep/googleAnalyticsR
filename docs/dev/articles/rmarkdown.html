<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RMarkdown reports with Google Analytics API data • googleAnalyticsR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="RMarkdown reports with Google Analytics API data">
<meta property="og:description" content="googleAnalyticsR">
<meta property="og:image" content="https://code.markedmondson.me/googleAnalyticsR/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-47480439-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-47480439-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">googleAnalyticsR</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">1.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/setup.html">
    <span class="fa fa-wrench"></span>
     
    Setup
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-table"></span>
     
    Reporting APIs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/reporting-ga4.html">
        <span class="fa fa-digital-tachograph"></span>
         
        GA4 Data API
      </a>
    </li>
    <li>
      <a href="../articles/measurement-protocol-v2.html">
        <span class="fa fa-upload"></span>
         
        Measurement Protocol
      </a>
    </li>
    <li>
      <a href="../articles/v4.html">
        <span class="fa fa-cogs"></span>
         
        v4 API
      </a>
    </li>
    <li>
      <a href="../articles/user-activity.html">
        <span class="fa fa-user"></span>
         
        User Activity API
      </a>
    </li>
    <li>
      <a href="../articles/v3.html">
        <span class="fa fa-cog"></span>
         
        v3 API
      </a>
    </li>
    <li>
      <a href="../articles/big-query.html">
        <span class="fa fa-search"></span>
         
        BigQuery
      </a>
    </li>
    <li>
      <a href="../articles/ganalytics.html">
        <span class="fa fa-bullseye"></span>
         
        ganalytics
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/management.html">
    <span class="fa fa-briefcase"></span>
     
    Management API
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-file"></span>
     
    Publishing
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/shiny.html">
        <span class="fa fa-cloud-upload"></span>
         
        Shiny
      </a>
    </li>
    <li>
      <a href="../articles/rmarkdown.html">
        <span class="fa fa-pencil-square"></span>
         
        RMarkdown
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-calculator"></span>
     
    Models
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/models.html">
        <span class="fa fa-calculator"></span>
         
        Creating Models
      </a>
    </li>
    <li>
      <a href="../articles/model-templates.html">
        <span class="fa fa-photo-video"></span>
         
        Shiny Model Templates
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-question-circle"></span>
     
    Help
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../reference/index.html">
        <span class="fa fa-book-reader"></span>
         
        Function Reference
      </a>
    </li>
    <li>
      <a href="../news/index.html">
        <span class="fa fa-newspaper"></span>
         
        News
      </a>
    </li>
    <li>
      <a href="../articles/faq.html">
        <span class="fa fa-glasses"></span>
         
        FAQs
      </a>
    </li>
    <li>
      <a href="../articles/practical-tips.html">
        <span class="fa fa-bicycle"></span>
         
        Practical tips
      </a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MarkEdmondson1234/googleAnalyticsR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="rmarkdown_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>RMarkdown reports with Google Analytics API data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MarkEdmondson1234/googleAnalyticsR/blob/master/vignettes/rmarkdown.Rmd"><code>vignettes/rmarkdown.Rmd</code></a></small>
      <div class="hidden name"><code>rmarkdown.Rmd</code></div>

    </div>

    
    
<p><code>googleAnalyticsR</code> can be used to generate reports in RMarkdown documents.</p>
<p>The default clientId that comes with the package can not be used for non-interactive use such as server scripts or RMarkdown. This is due to abuse of the free quota that used up the quota for everyone. This means you will need to set up your own clientId.</p>
<p>See <a href="http://code.markedmondson.me/googleAnalyticsR/articles/setup.html#professional-mode-your-own-google-project">setting up your own Google Project</a> - the easiest method is to use <code><a href="../reference/ga_auth_setup.html">ga_auth_setup()</a></code>.</p>
<div id="rmarkdown-authentication" class="section level2">
<h2 class="hasAnchor">
<a href="#rmarkdown-authentication" class="anchor"></a>RMarkdown Authentication</h2>
<div id="using-your-cached-email" class="section level3">
<h3 class="hasAnchor">
<a href="#using-your-cached-email" class="anchor"></a>Using your cached email</h3>
<p>If you are building Rmd’s in the same environment as you use interactively, then the Rmd can reuse that.</p>
<p>You need to avoid the interactive menu when using RMarkdown - so you will need your own clientId and to specify the email you have authenticated with that clientId to skip it e.g. <code><a href="../reference/ga_auth.html">ga_auth(email="me@work.com")</a></code></p>
</div>
<div id="example-using-an-email-cached-on-your-computer" class="section level3">
<h3 class="hasAnchor">
<a href="#example-using-an-email-cached-on-your-computer" class="anchor"></a>Example using an email cached on your computer</h3>
<pre class="markdown"><code>
---
title: "Google Analytics Report"
author: "Mark Edmondson"
date: "8 July 2016"
output: html_document
---

```{r}
knitr::opts_chunk$set(echo = TRUE)
library(googleAnalyticsR)

## specify an email you have already authenticated with once outside of Rmd
ga_auth(email="me@work.com")

...perform API actions...
```

</code></pre>
</div>
<div id="using-rmd-outside-of-your-interactive-environment" class="section level3">
<h3 class="hasAnchor">
<a href="#using-rmd-outside-of-your-interactive-environment" class="anchor"></a>Using Rmd outside of your interactive environment</h3>
<p>Two files are usually needed when authenticating in a server:</p>
<ul>
<li>Client ID JSON file - this is useful for interactive use anyhow as specifies your own GCP project and will take you off the default GCP project that comes with the package</li>
<li>Service key files - these are authentication files, linked to the clientId for your project.</li>
</ul>
<p>The recommended workflow for authentication in RMarkdown is:</p>
<ol style="list-style-type: decimal">
<li>Use <code><a href="../reference/ga_auth_setup.html">ga_auth_setup()</a></code> option 1 to help you find and download a clientId file. Put this safe in a global location that you can use for general use with the package, including interactive use</li>
<li>Run <code><a href="../reference/ga_auth_setup.html">ga_auth_setup()</a></code> option 3 to generate a service key file from the clientId file you created in step 1. Put this is a safe location out of your project folder. Note the email you created for your service key file - it will look like <code>{the_name}@{your-project-id}.iam.gserviceaccount.com</code>
</li>
<li>Run <code><a href="../reference/ga_auth_setup.html">ga_auth_setup()</a></code> option 5 to add the service email from step 2 (<code>{the_name}@{your-project-id}.iam.gserviceaccount.com</code>) as a user for your Google Analytics account.</li>
<li>Create your Rmd report using <code><a href="../reference/ga_auth.html">ga_auth(json_file="auth_file.json")</a></code>
</li>
</ol>
</div>
<div id="example-using-a-service-auth-key" class="section level3">
<h3 class="hasAnchor">
<a href="#example-using-a-service-auth-key" class="anchor"></a>Example using a service auth key</h3>
<p>Use <code><a href="../reference/ga_auth_setup.html">ga_auth_setup()</a></code> to create a client.id and auth service key.</p>
<p>Use the service key file location via <code><a href="../reference/ga_auth.html">ga_auth(json_file="your_key.json")</a></code> to authenticate instead of an email.</p>
<pre class="markdown"><code>

```{r}
knitr::opts_chunk$set(echo = TRUE)
library(googleAnalyticsR)

# we don't need to set the client.id as it takes it from the service key
# service JSON email needs to be added as a user of the viewId to work
ga_auth(json_file="auth_key.json")

...perform API actions...

```

</code></pre>
</div>
</div>
<div id="uploading-rmarkdown-files-to-shinyapps-ioshiny-server" class="section level2">
<h2 class="hasAnchor">
<a href="#uploading-rmarkdown-files-to-shinyapps-ioshiny-server" class="anchor"></a>Uploading RMarkdown files to Shinyapps.io/Shiny Server</h2>
<p>To see the reports online, you can upload RMarkdown documents to Shiny servers or shinyapps.io, to perhaps run on a schedule.</p>
<p>The recommend method for authentication is to use service accounts and <code><a href="../reference/ga_auth.html">ga_auth(json_file="your_key.json")</a></code> since this is easier and more secure in the long run.</p>
<p>However, if you want to continue using your email cached credentials, you need to ensure that the authentication cache file is present when uploaded. This can be specified in the meta data via <code>resource_files</code> in the Rmd yaml.</p>
<p>Since the token is not saved at a project level since <code>v0.7.0</code> you will need to move or specify the cache folder for the tokens. The cache folder is usually at the global location <code>~/.R/gargle/gargle-oauth</code>. Via <code>gargle</code> options, this needs to be changed for a project folder via:</p>
<p><code><a href="https://rdrr.io/r/base/options.html">options(gargle_oauth_cache = ".secrets")</a></code></p>
<p>This will then create a project folder containing cache. Upload this to the server.</p>
<pre class="markdown"><code>
---
title: "Google Analytics Report"
author: "Mark Edmondson"
date: "8 July 2016"
output: html_document
resource_files:
  - .secrets/4324vfdv425v45wvrwer
---
</code></pre>
<p>Then when you upload to Shiny Server or shinyapps.io, you should see the file in your upload choices:</p>
<p><img src="auth_token_markdown.png"></p>
<p>See details on <a href="https://cran.r-project.org/web/packages/gargle/vignettes/non-interactive-auth.html"><code>gargle</code> vignette</a></p>
<p>However, the recommend method is to use service accounts and <code><a href="../reference/ga_auth.html">ga_auth(json_file="auth_key.json")</a></code> when using a server since this is easier and more secure in the long run. Upload the service JSON file instead of the cache folder.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Mark Edmondson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
