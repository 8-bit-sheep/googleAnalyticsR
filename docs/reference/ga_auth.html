<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Authenticate with Google Analytics OAuth2 — ga_auth • googleAnalyticsR</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Authenticate with Google Analytics OAuth2 — ga_auth"><meta property="og:description" content="A wrapper for gar_auth and gar_auth_service"><meta property="og:image" content="https://code.markedmondson.me/googleAnalyticsR/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-43MDXK6CLZ"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-43MDXK6CLZ');
</script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">googleAnalyticsR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/setup.html">
    <span class="fa fa-wrench"></span>
     
    Setup
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-table"></span>
     
    Reporting APIs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/reporting-ga4.html">
        <span class="fa fa-digital-tachograph"></span>
         
        GA4 Data API
      </a>
    </li>
    <li>
      <a href="../articles/measurement-protocol-v2.html">
        <span class="fa fa-upload"></span>
         
        Measurement Protocol
      </a>
    </li>
    <li>
      <a href="../articles/v4.html">
        <span class="fa fa-cogs"></span>
         
        v4 API
      </a>
    </li>
    <li>
      <a href="../articles/user-activity.html">
        <span class="fa fa-user"></span>
         
        User Activity API
      </a>
    </li>
    <li>
      <a href="../articles/v3.html">
        <span class="fa fa-cog"></span>
         
        v3 API
      </a>
    </li>
    <li>
      <a href="../articles/big-query.html">
        <span class="fa fa-search"></span>
         
        BigQuery
      </a>
    </li>
    <li>
      <a href="../articles/ganalytics.html">
        <span class="fa fa-bullseye"></span>
         
        ganalytics
      </a>
    </li>
  </ul></li>
<li>
  <a href="../articles/management.html">
    <span class="fa fa-briefcase"></span>
     
    Management API
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-file"></span>
     
    Publishing
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/shiny.html">
        <span class="fa fa-cloud-upload"></span>
         
        Shiny
      </a>
    </li>
    <li>
      <a href="../articles/rmarkdown.html">
        <span class="fa fa-pencil-square"></span>
         
        RMarkdown
      </a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-calculator"></span>
     
    Models
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/models.html">
        <span class="fa fa-calculator"></span>
         
        Creating Models
      </a>
    </li>
    <li>
      <a href="../articles/model-templates.html">
        <span class="fa fa-photo-video"></span>
         
        Shiny Model Templates
      </a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-question-circle"></span>
     
    Help
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../reference/index.html">
        <span class="fa fa-book-reader"></span>
         
        Function Reference
      </a>
    </li>
    <li>
      <a href="../news/index.html">
        <span class="fa fa-newspaper"></span>
         
        News
      </a>
    </li>
    <li>
      <a href="../articles/faq.html">
        <span class="fa fa-glasses"></span>
         
        FAQs
      </a>
    </li>
    <li>
      <a href="../articles/practical-tips.html">
        <span class="fa fa-bicycle"></span>
         
        Practical tips
      </a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/MarkEdmondson1234/googleAnalyticsR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Authenticate with Google Analytics OAuth2</h1>
    <small class="dont-index">Source: <a href="https://github.com/MarkEdmondson1234/googleAnalyticsR/blob/HEAD/R/auth.R" class="external-link"><code>R/auth.R</code></a></small>
    <div class="hidden name"><code>ga_auth.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>A wrapper for <a href="https://code.markedmondson.me/googleAuthR//reference/gar_auth.html" class="external-link">gar_auth</a> and <a href="https://code.markedmondson.me/googleAuthR//reference/gar_auth_service.html" class="external-link">gar_auth_service</a></p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">ga_auth</span><span class="op">(</span>token <span class="op">=</span> <span class="cn">NULL</span>, email <span class="op">=</span> <span class="cn">NULL</span>, json_file <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>token</dt>
<dd><p>An existing token or file location of a token to authenticate with</p></dd>
<dt>email</dt>
<dd><p>An existing cached email to authenticate with or <code>TRUE</code> to authenticate with only email available.  If not set then you will get an interactive prompt asking you to choose which email to authenticate with.</p></dd>
<dt>json_file</dt>
<dd><p>Authentication service key you have downloaded from your Google Project - an alternative to OAuth2 email authentication</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>Invisibly, the token that has been saved to the session</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Run this function first time to authenticate with Google in your browser.</p>
<p>After initial authentication, your authentication details will be kept globally for use later, tied to your email, and the next time you authenticate you will be given a prompt to choose which email to authentcate from.  Set <code>email="your@email.com"</code> to skip the interactive prompt.</p>
    </div>
    <div id="multiple-accounts">
    <h2>Multiple accounts</h2>
    


<p>You can authenticate with a new email for each account. Supply a different email to use those details for your session.</p>
    </div>
    <div id="service-accounts">
    <h2>Service accounts</h2>
    


<p>If you use the service account JSON, you will need to add the service account email
to your Google Analytics users to see data e.g. <code>xxxx@yyyyyy.iam.gserviceaccount.com</code></p>
    </div>
    <div id="auto-authentication">
    <h2>Auto-authentication</h2>
    


<p>You can choose to auto-authenticate by creating a Google OAuth service account JSON file.</p>
<p>Specify an environment variable in R via a <code>.Renviron</code> file or using <a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a> which points to the file location of your chosen authentication file.  See <a href="https://rdrr.io/r/base/Startup.html" class="external-link">Startup</a></p>
<p>Once you have set the environment variable <code>GA_AUTH_FILE</code> to a valid file location,
the function will look there for authentication details upon loading the library meaning
you will not need to call <code>ga_auth()</code> yourself as you would normally.</p>
<p>An example <code>.Renviron</code> file is below:</p>
<p><code>GA_AUTH_FILE = "/Users/bob/auth/googleAnalyticsR.json"</code></p>
<p><code>GA_AUTH_FILE</code> can be a service account JSON ending with file extension <code>.json</code>.  Make sure to give the service account email access to your Google Analytics account as mentioned above.</p>
    </div>
    <div id="your-own-google-project">
    <h2>Your own Google Project</h2>
    


<p>Be default the Google Project used is shared by all users, so you may find it runs out of API calls.
To mitigate that, create your own Google Project and turn on the Analytics APIs.</p>
<p>The best way to do this is to use <a href="https://code.markedmondson.me/googleAuthR//reference/gar_set_client.html" class="external-link">gar_set_client</a> by downloading your JSON client credentials and setting them to be found on package startup via the <code>GAR_CLIENT_JSON</code> environment argument.  See <code><a href="https://code.markedmondson.me/googleAuthR//reference/gar_set_client.html" class="external-link">?googleAuthR::gar_set_client</a></code> function help pages for details.</p>
<p>Or you can then copy your Google Cloud Project's client ID and client secret, to place in options or environment arguments (whichever is easiest)</p>
<p>The environment args are below.  Similar to auto-authentication, you can place your entries in an <code>.Renviron</code> file</p>
<p><code>GA_CLIENT_ID="XXXX" GA_CLIENT_SECRET="XXX" GA_WEB_CLIENT_ID="XXX" GA_WEB_CLIENT_SECRET="XXX"</code></p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># to use default package credentials (for testing)</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://code.markedmondson.me/googleAnalyticsR/">googleAnalyticsR</a></span><span class="op">)</span></span>
<span class="r-in"><span class="fu">ga_auth</span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># to use your own Google Cloud Project credentials</span></span>
<span class="r-in"><span class="co"># go to GCP console and download client credentials JSON </span></span>
<span class="r-in"><span class="co"># ideally set this in .Renviron file, not here but just for demonstration</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span><span class="st">"GAR_CLIENT_JSON"</span> <span class="op">=</span> <span class="st">"location/of/file.json"</span><span class="op">)</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://code.markedmondson.me/googleAnalyticsR/">googleAnalyticsR</a></span><span class="op">)</span></span>
<span class="r-in"><span class="co"># should now be able to log in via your own GCP project</span></span>
<span class="r-in"><span class="fu">ga_auth</span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># reauthentication</span></span>
<span class="r-in"><span class="co"># Once you have authenticated, set email to skip the interactive message</span></span>
<span class="r-in"><span class="fu">ga_auth</span><span class="op">(</span>email <span class="op">=</span> <span class="st">"my@email.com"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># or leave unset to bring up menu on which email to auth with</span></span>
<span class="r-in"><span class="fu">ga_auth</span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># The googleAnalyticsR package is requesting access to your Google account. </span></span>
<span class="r-in"><span class="co"># Select a pre-authorised account or enter '0' to obtain a new token.</span></span>
<span class="r-in"><span class="co"># Press Esc/Ctrl + C to abort.</span></span>
<span class="r-in"><span class="co">#1: my@email.com</span></span>
<span class="r-in"><span class="co">#2: work@mybusiness.com</span></span>
<span class="r-in"><span class="co"># you can set authentication for many emails, then switch between them e.g.</span></span>
<span class="r-in"><span class="fu">ga_auth</span><span class="op">(</span>email <span class="op">=</span> <span class="st">"my@email.com"</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="ga_account_list.html">ga_account_list</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># lists one set of accounts</span></span>
<span class="r-in"><span class="fu">ga_auth</span><span class="op">(</span>email <span class="op">=</span> <span class="st">"work@mybusiness.com"</span><span class="op">)</span> </span>
<span class="r-in"><span class="fu"><a href="ga_account_list.html">ga_account_list</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># lists second set of accounts</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># or authenticate via the service key, that has been added to the GA as a user</span></span>
<span class="r-in"><span class="fu">ga_auth</span><span class="op">(</span>json_file <span class="op">=</span> <span class="st">"service-key.json"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Mark Edmondson.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

