<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Get Google Analytics v4 data — google_analytics • googleAnalyticsR</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Get Google Analytics v4 data — google_analytics" />
<meta property="og:description" content="Fetch Google Analytics data using the v4 API.  For the v3 API use google_analytics_3, for GA4's Data API use ga_data.  See website help for lots of examples: Google Analytics Reporting API v4 in R" />
<meta property="og:image" content="https://code.markedmondson.me/googleAnalyticsR/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-47480439-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-47480439-2');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">googleAnalyticsR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.8.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/setup.html">
    <span class="fas fa-wrench"></span>
     
    Setup
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-table"></span>
     
    Reporting APIs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/reporting-ga4.html">
        <span class="fas fa-digital-tachograph"></span>
         
        GA4 Data API
      </a>
    </li>
    <li>
      <a href="../articles/v4.html">
        <span class="fas fa-cogs"></span>
         
        v4 API
      </a>
    </li>
    <li>
      <a href="../articles/user-activity.html">
        <span class="fas fa-user"></span>
         
        User Activity API
      </a>
    </li>
    <li>
      <a href="../articles/v3.html">
        <span class="fas fa-cog"></span>
         
        v3 API
      </a>
    </li>
    <li>
      <a href="../articles/big-query.html">
        <span class="fas fa-search"></span>
         
        BigQuery
      </a>
    </li>
    <li>
      <a href="../articles/ganalytics.html">
        <span class="fas fa-bullseye"></span>
         
        ganalytics
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/management.html">
    <span class="fas fa-briefcase"></span>
     
    Management API
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-file"></span>
     
    Publishing
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/shiny.html">
        <span class="fas fa-cloud-upload"></span>
         
        Shiny
      </a>
    </li>
    <li>
      <a href="../articles/rmarkdown.html">
        <span class="fas fa-pencil-square"></span>
         
        RMarkdown
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/models.html">
    <span class="fas fa-calculator"></span>
     
    Models
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-question-circle"></span>
     
    Help
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../reference/index.html">
        <span class="fas fa-book-reader"></span>
         
        Function Reference
      </a>
    </li>
    <li>
      <a href="../news/index.html">
        <span class="fas fa-newspaper"></span>
         
        News
      </a>
    </li>
    <li>
      <a href="../articles/faq.html">
        <span class="fas fa-glasses"></span>
         
        FAQs
      </a>
    </li>
    <li>
      <a href="../articles/practical-tips.html">
        <span class="fas fa-bicycle"></span>
         
        Practical tips
      </a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/MarkEdmondson1234/googleAnalyticsR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Get Google Analytics v4 data</h1>
    <small class="dont-index">Source: <a href='https://github.com/MarkEdmondson1234/googleAnalyticsR/blob/master/R/ga_v4_get.R'><code>R/ga_v4_get.R</code></a></small>
    <div class="hidden name"><code>google_analytics.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fetch Google Analytics data using the v4 API.  For the v3 API use <a href='google_analytics_3.html'>google_analytics_3</a>, for GA4's Data API use <a href='ga_data.html'>ga_data</a>.  See website help for lots of examples: <a href='http://code.markedmondson.me/googleAnalyticsR/articles/v4.html'>Google Analytics Reporting API v4 in R</a></p>
    </div>

    <pre class="usage"><span class='fu'>google_analytics</span>(
  <span class='no'>viewId</span>,
  <span class='kw'>date_range</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>metrics</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>dimensions</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>dim_filters</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>met_filters</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>filtersExpression</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>order</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>segments</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>pivots</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>cohorts</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>max</span> <span class='kw'>=</span> <span class='fl'>1000</span>,
  <span class='kw'>samplingLevel</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"DEFAULT"</span>, <span class='st'>"SMALL"</span>, <span class='st'>"LARGE"</span>),
  <span class='kw'>metricFormat</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>histogramBuckets</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>anti_sample</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>anti_sample_batches</span> <span class='kw'>=</span> <span class='st'>"auto"</span>,
  <span class='kw'>slow_fetch</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>useResourceQuotas</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>rows_per_call</span> <span class='kw'>=</span> <span class='fl'>10000L</span>
)

<span class='fu'>google_analytics_4</span>(<span class='no'>...</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>viewId</th>
      <td><p>viewId of data to get.</p></td>
    </tr>
    <tr>
      <th>date_range</th>
      <td><p>character or date vector of format <code><a href='https://rdrr.io/r/base/c.html'>c(start, end)</a></code> or 
for two date ranges: <code><a href='https://rdrr.io/r/base/c.html'>c(start1,end1,start2,end2)</a></code></p></td>
    </tr>
    <tr>
      <th>metrics</th>
      <td><p>Metric(s) to fetch as a character vector.  You do not need to 
supply the <code>"ga:"</code> prefix.  See <a href='meta.html'>meta</a> for a list of dimensons 
and metrics the API supports. Also supports your own calculated metrics.</p></td>
    </tr>
    <tr>
      <th>dimensions</th>
      <td><p>Dimension(s) to fetch as a character vector. You do not need to 
supply the <code>"ga:"</code> prefix. See <a href='meta.html'>meta</a> for a list of dimensons 
and metrics the API supports.</p></td>
    </tr>
    <tr>
      <th>dim_filters</th>
      <td><p>A <a href='filter_clause_ga4.html'>filter_clause_ga4</a> wrapping <a href='dim_filter.html'>dim_filter</a></p></td>
    </tr>
    <tr>
      <th>met_filters</th>
      <td><p>A <a href='filter_clause_ga4.html'>filter_clause_ga4</a> wrapping <a href='met_filter.html'>met_filter</a></p></td>
    </tr>
    <tr>
      <th>filtersExpression</th>
      <td><p>A v3 API style simple filter string. Not used with other filters.</p></td>
    </tr>
    <tr>
      <th>order</th>
      <td><p>An <a href='order_type.html'>order_type</a> object</p></td>
    </tr>
    <tr>
      <th>segments</th>
      <td><p>List of segments as created by <a href='segment_ga4.html'>segment_ga4</a></p></td>
    </tr>
    <tr>
      <th>pivots</th>
      <td><p>Pivots of the data as created by <a href='pivot_ga4.html'>pivot_ga4</a></p></td>
    </tr>
    <tr>
      <th>cohorts</th>
      <td><p>Cohorts created by <a href='make_cohort_group.html'>make_cohort_group</a></p></td>
    </tr>
    <tr>
      <th>max</th>
      <td><p>Maximum number of rows to fetch. Defaults at 1000. Use -1 to fetch all results. Ignored when <code>anti_sample=TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>samplingLevel</th>
      <td><p>Sample level</p></td>
    </tr>
    <tr>
      <th>metricFormat</th>
      <td><p>If supplying calculated metrics, specify the metric type</p></td>
    </tr>
    <tr>
      <th>histogramBuckets</th>
      <td><p>For numeric dimensions such as hour, a list of buckets of data.
See details in <a href='make_ga_4_req.html'>make_ga_4_req</a></p></td>
    </tr>
    <tr>
      <th>anti_sample</th>
      <td><p>If TRUE will split up the call to avoid sampling.</p></td>
    </tr>
    <tr>
      <th>anti_sample_batches</th>
      <td><p>"auto" default, or set to number of days per batch. 1 = daily.</p></td>
    </tr>
    <tr>
      <th>slow_fetch</th>
      <td><p>For large, complicated API requests this bypasses some API hacks that may result in 500 errors.  For smaller queries, leave this as <code>FALSE</code> for quicker data fetching.</p></td>
    </tr>
    <tr>
      <th>useResourceQuotas</th>
      <td><p>If using GA360, access increased sampling limits. 
Default <code>NULL</code>, set to <code>TRUE</code> or <code>FALSE</code> if you have access to this feature.</p></td>
    </tr>
    <tr>
      <th>rows_per_call</th>
      <td><p>Set how many rows are requested by the API per call, up to a maximum of 100000.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Arguments passed to google_analytics</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A Google Analytics data.frame, with attributes showing row totals, sampling etc.</p>
    <h2 class="hasAnchor" id="row-requests"><a class="anchor" href="#row-requests"></a>Row requests</h2>

    


<p>By default the API call will use v4 batching that splits requests into 5 separate calls of 10k rows each.  This can go up to 100k, so this means up to 500k rows can be fetched per API call, however the API servers will fail with a 500 error if the query is too complicated as the processing time at Google's end gets too long.  In this case, you may want to tweak the <code>rows_per_call</code> argument downwards, or fall back to using <code>slow_fetch = FALSE</code> which will send an API request one at a time.  If fetching data via scheduled scripts this is recommended as the default.</p>
    <h2 class="hasAnchor" id="anti-sampling"><a class="anchor" href="#anti-sampling"></a>Anti-sampling</h2>

    


<p><code>anti_sample</code> being TRUE ignores <code>max</code> as the API call is split over days 
  to mitigate the sampling session limit, in which case a row limit won't work.  Take the top rows
  of the result yourself instead e.g. <code><a href='https://rdrr.io/r/utils/head.html'>head(ga_data_unsampled, 50300)</a></code></p>  
<p><code>anti_sample</code> being TRUE will also set <code>samplingLevel='LARGE'</code> to minimise 
  the number of calls.</p>
    <h2 class="hasAnchor" id="resource-quotas"><a class="anchor" href="#resource-quotas"></a>Resource Quotas</h2>

    


<p>If you are on GA360 and have access to resource quotas,
  set the <code>useResourceQuotas=TRUE</code> and set the Google Cloud 
  client ID to the project that has resource quotas activated, 
  via <a href='https://code.markedmondson.me/googleAuthR//reference/gar_set_client.html'>gar_set_client</a> or options.</p>
    <h2 class="hasAnchor" id="caching"><a class="anchor" href="#caching"></a>Caching</h2>

    


<p>By default local caching is turned on for v4 API requests.  This means that
  making the same request as one this session will read from memory and not
  make an API call. You can also set the cache to disk via 
  the <a href='ga_cache_call.html'>ga_cache_call</a> function.  This can be useful
  when running RMarkdown reports using data.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other GAv4 fetch functions: 
<code><a href='fetch_google_analytics_4_slow.html'>fetch_google_analytics_4_slow</a>()</code>,
<code><a href='fetch_google_analytics_4.html'>fetch_google_analytics_4</a>()</code>,
<code><a href='make_ga_4_req.html'>make_ga_4_req</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>googleAnalyticsR</span>)

<span class='co'>## authenticate, or use the RStudio Addin "Google API Auth" with analytics scopes set</span>

<span class='fu'><a href='ga_auth.html'>ga_auth</a></span>()

<span class='co'>## get your accounts</span>

<span class='no'>account_list</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='ga_account_list.html'>ga_account_list</a></span>()

<span class='co'>## account_list will have a column called "viewId"</span>
<span class='no'>account_list</span>$<span class='no'>viewId</span>

<span class='co'>## View account_list and pick the viewId you want to extract data from</span>
<span class='no'>ga_id</span> <span class='kw'>&lt;-</span> <span class='fl'>123456</span>

<span class='co'># examine the meta table to see metrics and dimensions you can query</span>
<span class='no'>meta</span>

<span class='co'>## simple query to test connection</span>
<span class='fu'>google_analytics</span>(<span class='no'>ga_id</span>,
                 <span class='kw'>date_range</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"2017-01-01"</span>, <span class='st'>"2017-03-01"</span>),
                 <span class='kw'>metrics</span> <span class='kw'>=</span> <span class='st'>"sessions"</span>,
                 <span class='kw'>dimensions</span> <span class='kw'>=</span> <span class='st'>"date"</span>)

<span class='co'>## change the quotaUser to fetch under</span>
<span class='fu'>google_analytics</span>(<span class='fl'>1234567</span>, <span class='kw'>date_range</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"30daysAgo"</span>, <span class='st'>"yesterday"</span>), <span class='kw'>metrics</span> <span class='kw'>=</span> <span class='st'>"sessions"</span>)

<span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span>(<span class='st'>"googleAnalyticsR.quotaUser"</span> <span class='kw'>=</span> <span class='st'>"test_user"</span>)
<span class='fu'>google_analytics</span>(<span class='fl'>1234567</span>, <span class='kw'>date_range</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"30daysAgo"</span>, <span class='st'>"yesterday"</span>), <span class='kw'>metrics</span> <span class='kw'>=</span> <span class='st'>"sessions"</span>)

}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Mark Edmondson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


