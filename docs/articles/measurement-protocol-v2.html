<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Measurement Protocol v2 • googleAnalyticsR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Measurement Protocol v2">
<meta property="og:description" content="googleAnalyticsR">
<meta property="og:image" content="https://code.markedmondson.me/googleAnalyticsR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-47480439-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-47480439-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">googleAnalyticsR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/setup.html">
    <span class="fas fa-wrench"></span>
     
    Setup
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-table"></span>
     
    Reporting APIs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/reporting-ga4.html">
        <span class="fas fa-digital-tachograph"></span>
         
        GA4 Data API
      </a>
    </li>
    <li>
      <a href="../articles/measurement-protocol-v2.html">
        <span class="fas fa-upload"></span>
         
        Measurement Protocol
      </a>
    </li>
    <li>
      <a href="../articles/v4.html">
        <span class="fas fa-cogs"></span>
         
        v4 API
      </a>
    </li>
    <li>
      <a href="../articles/user-activity.html">
        <span class="fas fa-user"></span>
         
        User Activity API
      </a>
    </li>
    <li>
      <a href="../articles/v3.html">
        <span class="fas fa-cog"></span>
         
        v3 API
      </a>
    </li>
    <li>
      <a href="../articles/big-query.html">
        <span class="fas fa-search"></span>
         
        BigQuery
      </a>
    </li>
    <li>
      <a href="../articles/ganalytics.html">
        <span class="fas fa-bullseye"></span>
         
        ganalytics
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/management.html">
    <span class="fas fa-briefcase"></span>
     
    Management API
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-file"></span>
     
    Publishing
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/shiny.html">
        <span class="fas fa-cloud-upload"></span>
         
        Shiny
      </a>
    </li>
    <li>
      <a href="../articles/rmarkdown.html">
        <span class="fas fa-pencil-square"></span>
         
        RMarkdown
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-calculator"></span>
     
    Models
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/models.html">
        <span class="fas fa-calculator"></span>
         
        Creating Models
      </a>
    </li>
    <li>
      <a href="../articles/model-templates.html">
        <span class="fas fa-photo-video"></span>
         
        Shiny Model Templates
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-question-circle"></span>
     
    Help
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../reference/index.html">
        <span class="fas fa-book-reader"></span>
         
        Function Reference
      </a>
    </li>
    <li>
      <a href="../news/index.html">
        <span class="fas fa-newspaper"></span>
         
        News
      </a>
    </li>
    <li>
      <a href="../articles/faq.html">
        <span class="fas fa-glasses"></span>
         
        FAQs
      </a>
    </li>
    <li>
      <a href="../articles/practical-tips.html">
        <span class="fas fa-bicycle"></span>
         
        Practical tips
      </a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MarkEdmondson1234/googleAnalyticsR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="measurement-protocol-v2_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Measurement Protocol v2</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MarkEdmondson1234/googleAnalyticsR/blob/master/vignettes/measurement-protocol-v2.Rmd"><code>vignettes/measurement-protocol-v2.Rmd</code></a></small>
      <div class="hidden name"><code>measurement-protocol-v2.Rmd</code></div>

    </div>

    
    
<div id="sending-hits-from-r-to-google-analytics-4-properties-via-the-measurement-protocol-v2" class="section level2">
<h2 class="hasAnchor">
<a href="#sending-hits-from-r-to-google-analytics-4-properties-via-the-measurement-protocol-v2" class="anchor"></a>Sending hits from R to Google Analytics 4 properties via the Measurement Protocol v2</h2>
<p>From the <a href="https://developers.google.com/analytics/devguides/collection/protocol/ga4">Google docs</a>:</p>
<p>The Google Analytics Measurement Protocol for Google Analytics 4 allows developers to make HTTP requests to send events directly to Google Analytics servers. This allows developers to measure how users interact with their business from any HTTP-enabled environment. Notably, this makes it easy to measure interactions that happen server-to-server.</p>
<div id="librarymeasurementprotocol" class="section level3">
<h3 class="hasAnchor">
<a href="#librarymeasurementprotocol" class="anchor"></a>library(measurementProtocol)</h3>
<p>The <a href="https://code.markedmondson.me/measurementProtocol/">measurementProtocol library</a> is the one actually making the hits, with <code>googleAnalyticsR</code> calling the same functions. Use <code><a href="https://code.markedmondson.me/measurementProtocol/">library(measurementProtocol)</a></code> directly if you don’t need the rest of the <code>googleAnalyticsR</code> functions and would like a lighter package to work with.</p>
</div>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p>Using the <code><a href="../reference/ga_mp_send.html">ga_mp_send()</a></code> function you can send tracking hits from any R environment that is connected to HTTP. This can be used in variety of ways including R package tracking; extracting user data then running statistical analysis on GA4 user data and sending it back into GA4; server side tracking implementations of R web apps such as Shiny.</p>
<p><code>googleAnalyticsR</code> includes opt-in GA4 tracking of the package usage via the <code><a href="../reference/ga_trackme.html">ga_trackme()</a></code> function.</p>
</div>
<div id="sending-ga4-hits-from-r" class="section level2">
<h2 class="hasAnchor">
<a href="#sending-ga4-hits-from-r" class="anchor"></a>Sending GA4 hits from R</h2>
<p>To send hits you need:</p>
<ol style="list-style-type: decimal">
<li>A GA4 account</li>
<li>A valid GA4 measurement Id</li>
<li>A secret API key.
<ul>
<li>Create an API secret in your GA4 interface via <code>Admin &gt; Data Streams &gt; choose your stream &gt; Measurement Protocol &gt; Create</code>
</li>
</ul>
</li>
<li>A client Id for that user - use <code><a href="../reference/ga_mp_cid.html">ga_mp_cid()</a></code> if you don’t have one already</li>
<li>Configure custom definitions in GA4 for the events you want to send
<ul>
<li>See <code>Custom definitions &gt; Create custom dimensions</code>
</li>
</ul>
</li>
</ol>
<p>An example is shown then example below:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># preferably set this in .Renviron</span>
<span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span><span class="op">(</span>GA_MP_SECRET<span class="op">=</span><span class="st">"MY_SECRET"</span><span class="op">)</span>

<span class="co"># your GA4 settings</span>
<span class="va">my_measurement_id</span> <span class="op">&lt;-</span> <span class="st">"G-43MDXK6CLZ"</span>

<span class="co"># create a connection object</span>
<span class="va">my_connection</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_mp_send.html">ga_mp_connection</a></span><span class="op">(</span><span class="va">my_measurement_id</span><span class="op">)</span>

<span class="co"># a random clientId</span>
<span class="va">a_client_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_mp_cid.html">ga_mp_cid</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_mp_event.html">ga_mp_event</a></span><span class="op">(</span><span class="st">"an_event"</span><span class="op">)</span>

<span class="co"># send to debug endpoint first to validate the hit</span>
<span class="fu"><a href="../reference/ga_mp_send.html">ga_mp_send</a></span><span class="op">(</span><span class="va">event</span>, <span class="va">a_client_id</span>, <span class="va">my_connection</span>, debug_call <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">another</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_mp_event.html">ga_mp_event</a></span><span class="op">(</span><span class="st">"another_event"</span><span class="op">)</span>

<span class="co"># send a real hit - batched together</span>
<span class="fu"><a href="../reference/ga_mp_send.html">ga_mp_send</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">event</span>, <span class="va">another</span><span class="op">)</span>, 
           <span class="va">a_client_id</span>, <span class="va">my_measurement_id</span><span class="op">)</span>

<span class="co"># you can see sent events in the real-time reports to check its working</span>
<span class="va">my_property_id</span> <span class="op">&lt;-</span> <span class="fl">206670707</span>
<span class="fu"><a href="../reference/ga_data.html">ga_data</a></span><span class="op">(</span><span class="va">my_property_id</span>, 
        dimensions <span class="op">=</span> <span class="st">"eventName"</span>, 
        metrics <span class="op">=</span> <span class="st">"eventCount"</span>, 
        dimensionFilter <span class="op">=</span> <span class="fu"><a href="../reference/ga_data_filter.html">ga_data_filter</a></span><span class="op">(</span>
           <span class="va">eventName</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"an_event"</span>,<span class="st">"another_event"</span><span class="op">)</span><span class="op">)</span>,
        realtime <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div id="configuration-of-ga4" class="section level3">
<h3 class="hasAnchor">
<a href="#configuration-of-ga4" class="anchor"></a>Configuration of GA4</h3>
<p>Once the API secret is created you can put it in an .Renviron file for the <code>GA_MP_SECRET</code> so you do not need to supply it in the R code for security.</p>
<p>You also need a clientId, which is the ID associated with the user creating the hits. Be aware of privacy laws when creating this - for example ePrivacy in the EU dictates you must get consent to associate an ID with a user. If the clientId is the same as other streams into your GA4 account (e.g. website, mobile apps), the hits you send will be associated with the same user.</p>
<p>Once you have those then you need to decide what event you want to send in. To see event parameters in your GA4 reports, create custom fields in your GA4 account first, after which you can see them in your reports 24hrs after you send them - - <code>dimension name</code> will be the label in the reports, <code>event parameter</code> will be the parameter you have sent in with the event.</p>
</div>
<div id="creating-the-connection-object" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-the-connection-object" class="anchor"></a>Creating the connection object</h3>
<p>The connection is configured with the API secret and your measurementId. Ideally the API secret should be set in your <code>.Renviron</code> file via environment argument <code>MP_SECRET</code></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># preferably set this in .Renviron</span>
<span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span><span class="op">(</span>MP_SECRET<span class="op">=</span><span class="st">"MY_SECRET"</span><span class="op">)</span>

<span class="co"># your GA4 settings</span>
<span class="va">my_measurement_id</span> <span class="op">&lt;-</span> <span class="st">"G-1234"</span>

<span class="va">my_connection</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_mp_send.html">ga_mp_connection</a></span><span class="op">(</span><span class="va">my_measurement_id</span><span class="op">)</span></code></pre></div>
<p>By default it will send the hits to <code>https://www.google-analytics.com/mp/collect</code>. To send to the debug URL <code>https://www.google-analytics.com/debug/mp/collect"</code> specify <code>debug_call=TRUE</code> in the <code><a href="../reference/ga_mp_send.html">ga_mp_send()</a></code> function.</p>
<p>If you have a custom endpoint (say you are running GTM Server Side) then you can override this URL. In that case you will also want to see your hits appear in the GTM Server Side debugger, which requires a <code>X-Gtm-Server-Preview</code> header added to the request. When in your debugger Web UI’s Preview mode, select from the top right menu “send requests manually” to find your header value and put into the connection like below:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_custom_connection</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_mp_send.html">ga_mp_connection</a></span><span class="op">(</span>
    <span class="va">my_measurement_id</span>,
    endpoint <span class="op">=</span> <span class="st">"https://gtm.example.com"</span>,
    preview_header <span class="op">=</span> <span class="st">"ZW52LTV8OWdPOExNWFkYjA0Njk4NmQ="</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="sending-the-ga4-hit-via-r" class="section level3">
<h3 class="hasAnchor">
<a href="#sending-the-ga4-hit-via-r" class="anchor"></a>Sending the GA4 hit via R</h3>
<p>You construct an event via <code><a href="../reference/ga_mp_event.html">ga_mp_event()</a></code> - a simple one may be <code><a href="../reference/ga_mp_event.html">ga_mp_event("an_event")</a></code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ga_mp_event.html">ga_mp_event</a></span><span class="op">(</span><span class="st">"an_event"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## ==GA4 MP Event
## {
##   "name": "an_event"
## }</code></pre>
<p>Refer to the <a href="https://developers.google.com/analytics/devguides/collection/protocol/ga4/reference/events">Events documentation</a> on what you can send in.</p>
<p>Once you have an event you can test it will show up when you send via <code><a href="../reference/ga_mp_send.html">ga_mp_send()</a></code> by setting <code>debug_call=TRUE</code></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_connection</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_mp_send.html">ga_mp_connection</a></span><span class="op">(</span><span class="st">"G-1234"</span><span class="op">)</span>
<span class="va">a_client_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_mp_cid.html">ga_mp_cid</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_mp_event.html">ga_mp_event</a></span><span class="op">(</span><span class="st">"an_event"</span><span class="op">)</span>
<span class="fu"><a href="../reference/ga_mp_send.html">ga_mp_send</a></span><span class="op">(</span><span class="va">event</span>, <span class="va">a_client_id</span>, <span class="va">my_connection</span>, debug_call <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## ℹ 2021-04-17 08:48:28 &gt; MP Request: https://www.google-analytics.com/debug/mp/collect?measurement_id=G-1234&amp;api_secret=MY_SECRET 
##  {
##   "client_id": "98142963.1618649309",
##   "non_personalized_ads": true,
##   "events": [
##     {
##       "name": "an_event"
##     }
##   ]
## }</code></pre>
<pre><code>## ℹ 2021-04-17 08:48:28 &gt; Response:  200</code></pre>
<pre><code>## ℹ 2021-04-17 08:48:28 &gt; No validation messages found</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>You can send many events in on send:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">another</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_mp_event.html">ga_mp_event</a></span><span class="op">(</span><span class="st">"another_event"</span><span class="op">)</span>
<span class="fu"><a href="../reference/ga_mp_send.html">ga_mp_send</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">event</span>, <span class="va">another</span><span class="op">)</span>, 
           <span class="va">a_client_id</span>, 
           <span class="va">my_connection</span>, 
           debug_call <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## ℹ 2021-04-17 08:48:28 &gt; MP Request: https://www.google-analytics.com/debug/mp/collect?measurement_id=G-1234&amp;api_secret=MY_SECRET 
##  {
##   "client_id": "98142963.1618649309",
##   "non_personalized_ads": true,
##   "events": [
##     {
##       "name": "an_event"
##     },
##     {
##       "name": "another_event"
##     }
##   ]
## }</code></pre>
<pre><code>## ℹ 2021-04-17 08:48:29 &gt; Response:  200</code></pre>
<pre><code>## ℹ 2021-04-17 08:48:29 &gt; No validation messages found</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>Events are flexible with the number of parameters you send with the event name - this allows for rich data streams. The data parameters can be added via the <code>params</code> argument and accepts (nested) named R lists:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ga_mp_event.html">ga_mp_event</a></span><span class="op">(</span><span class="st">"event_with_params"</span>, params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>my_param <span class="op">=</span> <span class="st">"hello"</span>, my_param2 <span class="op">=</span> <span class="st">"mum"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## ==GA4 MP Event
## {
##   "name": "event_with_params",
##   "params": {
##     "my_param": "hello",
##     "my_param2": "mum"
##   }
## }</code></pre>
<p>If you are making product item style hits, the helper function <code><a href="../reference/ga_mp_event_item.html">ga_mp_event_item()</a></code> helps you construct them:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># one item</span>
<span class="fu"><a href="../reference/ga_mp_event_item.html">ga_mp_event_item</a></span><span class="op">(</span>item_name <span class="op">=</span> <span class="st">"jeggings"</span>, 
                 price <span class="op">=</span> <span class="fl">8.88</span>, 
                 item_variant <span class="op">=</span> <span class="st">"Black"</span><span class="op">)</span></code></pre></div>
<pre><code>## ==GA4 MP Event Item
## {
##   "item_name": "jeggings",
##   "item_variant": "Black",
##   "price": 8.88
## }</code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># many items in a list</span>
<span class="va">items</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="fu"><a href="../reference/ga_mp_event_item.html">ga_mp_event_item</a></span><span class="op">(</span>item_id <span class="op">=</span> <span class="st">"SKU_12345"</span>, 
                   price <span class="op">=</span> <span class="fl">9.99</span>, 
                   item_brand <span class="op">=</span> <span class="st">"Gucci"</span><span class="op">)</span>, 
  <span class="fu"><a href="../reference/ga_mp_event_item.html">ga_mp_event_item</a></span><span class="op">(</span>item_name <span class="op">=</span> <span class="st">"jeggings"</span>, 
                   price <span class="op">=</span> <span class="fl">8.88</span>, 
                   item_variant <span class="op">=</span> <span class="st">"Black"</span><span class="op">)</span><span class="op">)</span>
                   
<span class="co"># construct an event with its own fields</span>
<span class="fu"><a href="../reference/ga_mp_event.html">ga_mp_event</a></span><span class="op">(</span><span class="st">"add_payment_info"</span>, 
            params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>coupon <span class="op">=</span> <span class="st">"SUMMER_FUN"</span>, 
                          payment_type <span class="op">=</span> <span class="st">"Credit Card"</span>, 
                          value <span class="op">=</span> <span class="fl">7.77</span>, 
                          currency <span class="op">=</span> <span class="st">"USD"</span><span class="op">)</span>, 
            items <span class="op">=</span> <span class="va">items</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## ==GA4 MP Event
## {
##   "name": "add_payment_info",
##   "params": {
##     "coupon": "SUMMER_FUN",
##     "payment_type": "Credit Card",
##     "value": 7.77,
##     "currency": "USD",
##     "items": [
##       {
##         "item_id": "SKU_12345",
##         "item_brand": "Gucci",
##         "price": 9.99
##       },
##       {
##         "item_name": "jeggings",
##         "item_variant": "Black",
##         "price": 8.88
##       }
##     ]
##   }
## }</code></pre>
</div>
</div>
<div id="googleanalyticsr-package-tracking-with-ga_trackme" class="section level2">
<h2 class="hasAnchor">
<a href="#googleanalyticsr-package-tracking-with-ga_trackme" class="anchor"></a>googleAnalyticsR package tracking with ga_trackme</h2>
<p><code>googleAnalyticsR</code> uses the above to provide opt-in tracking of what systems its running on.</p>
<p><code><a href="../reference/ga_trackme.html">ga_trackme()</a></code> is send on package load if consent is given in the form of a file saved on the user’s computer (much like a website cookie).</p>
<p>You can see what is sent with the <code>debug_call=TRUE</code> flag - the below is sent when this RMarkdown file renders:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ga_trackme.html">ga_trackme_event</a></span><span class="op">(</span>debug_call <span class="op">=</span> <span class="cn">TRUE</span>, say_hello <span class="op">=</span> <span class="st">"Documentation is a feature"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in file(con, "r"): cannot open file '/builder/home/.config/
## googleAnalyticsR/optin-tracking': No such file or directory</code></pre>
<pre><code>## ℹ 2021-04-17 08:48:29 &gt; MP Request: https://www.google-analytics.com/debug/mp/collect?measurement_id=G-43MDXK6CLZ&amp;api_secret=_hS_7VJARhqbCq9mF3oiNg 
##  {
##   "client_id": "12345678.987654",
##   "non_personalized_ads": true,
##   "events": [
##     {
##       "name": "r_package_loaded",
##       "params": {
##         "r_version": "R version 4.0.5 (2021-03-31)",
##         "r_platform": "x86_64-pc-linux-gnu (64-bit)",
##         "r_locale": "LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=C;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C",
##         "r_system": "Ubuntu 20.04 LTS",
##         "say_hello": "Documentation is a feature",
##         "package": "googleAnalyticsR 1.0.0"
##       }
##     }
##   ]
## }</code></pre>
<pre><code>## ℹ 2021-04-17 08:48:29 &gt; Response:  200</code></pre>
<pre><code>## ℹ 2021-04-17 08:48:29 &gt; No validation messages found</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>Send your own messages if you like! I will read them in the GA4 interface.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Mark Edmondson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
