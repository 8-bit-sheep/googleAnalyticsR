<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Activity API • googleAnalyticsR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="User Activity API">
<meta property="og:description" content="">
<meta property="og:image" content="https://code.markedmondson.me/googleAnalyticsR/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-47480439-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-47480439-2');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">googleAnalyticsR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/setup.html">
    <span class="fa fa-wrench"></span>
     
    Setup
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-table"></span>
     
    Reporting APIs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/v4.html">
        <span class="fa fa-cogs"></span>
         
        v4 API
      </a>
    </li>
    <li>
      <a href="../articles/user-activity.html">
        <span class="fa fa-user"></span>
         
        User Activity API
      </a>
    </li>
    <li>
      <a href="../articles/v3.html">
        <span class="fa fa-cog"></span>
         
        v3 API
      </a>
    </li>
    <li>
      <a href="../articles/big-query.html">
        <span class="fa fa-search"></span>
         
        BigQuery
      </a>
    </li>
    <li>
      <a href="../articles/ganalytics.html">
        <span class="fa fa-bullseye"></span>
         
        ganalytics
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/management.html">
    <span class="fa fa-briefcase"></span>
     
    Management API
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-file"></span>
     
    Publishing
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/shiny.html">
        <span class="fa fa-cloud-upload"></span>
         
        Shiny
      </a>
    </li>
    <li>
      <a href="../articles/rmarkdown.html">
        <span class="fa fa-pencil-square"></span>
         
        RMarkdown
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/models.html">
    <span class="fa fa-calculator"></span>
     
    Models
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-question-circle"></span>
     
    Help
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../reference/index.html">
        <span class="fa fa-book-reader"></span>
         
        Function Reference
      </a>
    </li>
    <li>
      <a href="../news/index.html">
        <span class="fa fa-newspaper"></span>
         
        News
      </a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>User Activity API</h1>
            
      
      
      <div class="hidden name"><code>user-activity.Rmd</code></div>

    </div>

    
    
<p>The <a href="https://developers.google.com/analytics/devguides/reporting/core/v4/rest/v4/userActivity/search">User Activity API</a> lets you query an individual user’s movement through your website, by sending in the individual <code>clientId</code> or <code>userId</code>. It is accessed via the <code><a href="../reference/ga_clientid_activity.html">ga_clientid_activity()</a></code> function.</p>
<p>At the moment it is available on the dev version of <code>googleAnalyticsR &gt;= 0.6.9000</code> and needs <code>googleAuthR &gt;= 0.7.0.9000</code> so install via:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">remotes<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/remotes/topics/install_github">install_github</a></span>(<span class="st">"MarkEdmondson1234/googleAuthR"</span>)
remotes<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/remotes/topics/install_github">install_github</a></span>(<span class="st">"MarkEdmondson1234/googleAnalyticsR"</span>)</code></pre></div>
<div id="user-activity-api-example" class="section level2">
<h2 class="hasAnchor">
<a href="#user-activity-api-example" class="anchor"></a>User Activity API example</h2>
<p>You first need to have a <code>clientId</code> or <code>userId</code> to query. You can get this via the User Explorer report in the Web UI, or via a BigQuery export, or you may be capturing the ID in a custom dimension.</p>
<p>If you know the ID from other sources such as you have set the <code>userId</code> from your CRM system.</p>
<p>Once you have an ID, specify the Google Analytics view that user was browsing and the data range of the activity you want to query:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a_user &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ga_clientid_activity.html">ga_clientid_activity</a></span>(<span class="st">"1106980347.1461227730"</span>,
                               <span class="dt">viewId =</span> <span class="dv">81416156</span>, 
                               <span class="dt">date_range =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"2019-01-01"</span>,<span class="st">"2019-02-01"</span>))</code></pre></div>
</div>
<div id="multiple-ids" class="section level2">
<h2 class="hasAnchor">
<a href="#multiple-ids" class="anchor"></a>Multiple ids</h2>
<p>You can send in multiple IDs of the same type in a vector:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">two_clientIds &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"1106980347.1461227730"</span>, <span class="st">"476443645.1541099566"</span>)
two_users &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ga_clientid_activity.html">ga_clientid_activity</a></span>(two_clientIds,
                                  <span class="dt">viewId =</span> <span class="dv">81416156</span>, 
                                  <span class="dt">date_range =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"2019-01-01"</span>,<span class="st">"2019-02-01"</span>))</code></pre></div>
</div>
<div id="return-format" class="section level2">
<h2 class="hasAnchor">
<a href="#return-format" class="anchor"></a>Return format</h2>
<p>The API returns two types of data: session level and activity hit level. Access it via <code>$sessions</code> or <code>$hits</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">two_users<span class="op">$</span>sessions
<span class="co">#    sessionId deviceCategory  platform dataSource sessionDate                    id</span>
<span class="co">#1  1548361067        desktop Macintosh        web  2019-01-24 1106980347.1461227730</span>
<span class="co">#2  1548261976        desktop Macintosh        web  2019-01-23 1106980347.1461227730</span>
<span class="co">#3  1548251272        desktop Macintosh        web  2019-01-23 1106980347.1461227730</span>
<span class="co">#4  1548017997        desktop Macintosh        web  2019-01-20 1106980347.1461227730</span>
<span class="co"># ...</span>

two_users<span class="op">$</span>hits
<span class="co"># A tibble: 102 x 26</span>
<span class="co">#   sessionId activityTime        source medium channelGrouping campaign keyword hostname</span>
<span class="co">#   &lt;chr&gt;     &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;           &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;   </span>
<span class="co"># 1 15483610… 2019-01-24 21:17:47 t.co   refer… Social          (not se… (not s… code.ma…</span>
<span class="co"># 2 15482619… 2019-01-23 17:46:16 t.co   refer… Social          (not se… (not s… code.ma…</span>
<span class="co"># 3 15482512… 2019-01-23 14:47:52 t.co   refer… Social          (not se… (not s… code.ma…</span>
<span class="co"># ...</span></code></pre></div>
<p>The amount of data returned is rich for the activity, the data columns are shown below (Although some will be empty for some rows if not applicable).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(two_users<span class="op">$</span>hits)
<span class="co"># [1] "sessionId"            "activityTime"         "source"               "medium"              </span>
<span class="co"># [5] "channelGrouping"      "campaign"             "keyword"              "hostname"            </span>
<span class="co"># [9] "landingPagePath"      "activityType"         "customDimension"      "pagePath"            </span>
<span class="co">#[13] "pageTitle"            "screenName"           "mobileDeviceBranding" "mobileDeviceModel"   </span>
<span class="co">#[17] "appName"              "ecommerce"            "goals"                "has_goal"            </span>
<span class="co">#[21] "eventCategory"        "eventAction"          "eventLabel"           "eventValue"          </span>
<span class="co">#[25] "eventCount"           "id" </span></code></pre></div>
<p>The data.frames returned include the ID you sent in as the <code>$id</code> column so you can distinguish between users.</p>
<div id="nested-columns" class="section level3">
<h3 class="hasAnchor">
<a href="#nested-columns" class="anchor"></a>Nested columns</h3>
<p>The output uses nested columns for some values so you may want to get familiar with the <code><a href="https://tidyr.tidyverse.org/reference/unnest.html">tidyr::unnest()</a></code> function when working with the data.</p>
<p>The nested columns are <code>hits$customDimension</code>, <code>hits$ecommerce</code> and <code>hits$goals</code>.</p>
<p>The nesting is necessary as you can have multiple of these events per hit, and expanding them in the response would make a very large <code>data.frame</code> to work with.</p>
<p>An example on how to unnest goals is shown below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyr)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(purrr)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)

a_user<span class="op">$</span>hits <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(has_goal) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># filter to just hits with goals</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(id, sessionId, activityTime, goals) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span>(goals) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># unnest the goals list column</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">goalIndex =</span> <span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span>(goals, <span class="st">"goalIndex"</span>), 
         <span class="dt">goalName =</span> <span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span>(goals, <span class="st">"goalName"</span>), 
         <span class="dt">goalCompletionLocation =</span> <span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span>(goals, <span class="st">"goalCompletionLocation"</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>goals)
## A tibble: 4 x 6
<span class="co">#  id                  sessionId  activityTime        goalIndex goalName           goalCompletionLocation                </span>
<span class="co">#  &lt;chr&gt;               &lt;chr&gt;      &lt;dttm&gt;              &lt;chr&gt;     &lt;chr&gt;              &lt;chr&gt;                                 </span>
<span class="co">#1 1106980347.1461227… 1548016803 2019-01-20 21:40:53 20        Visited over 4 pa… /googleAnalyticsR/articles/setup.html </span>
<span class="co">#2 1106980347.1461227… 1546979541 2019-01-08 21:34:18 1         Time over a minut… /googleAnalyticsR/articles/ganalytics…</span>
<span class="co">#3 1106980347.1461227… 1546802623 2019-01-06 20:26:59 1         Time over a minut… /googleAnalyticsR/articles/v4.html    </span>
<span class="co">#4 1106980347.1461227… 1546467261 2019-01-02 23:15:50 1         Time over a minut… /googleAnalyticsR/   </span></code></pre></div>
<p>To unnest custom dimensions, some example code is below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyr) <span class="co"># devtools::install_github("tidyverse/tidyr")</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(purrr)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)

a_user<span class="op">$</span>hits <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(id, sessionId, activityTime, customDimension) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span>(customDimension) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">cd_index =</span> <span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span>(customDimension, <span class="st">"index"</span>), 
         <span class="dt">cd_value =</span> <span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span>(customDimension, <span class="op">~</span><span class="st"> </span>.<span class="op">$</span>value <span class="op">%||%</span><span class="st"> </span><span class="ot">NA_character_</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(cd_value)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>customDimension) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/pivot_wide.html">pivot_wide</a></span>(<span class="dt">names_from =</span> cd_index, <span class="dt">values_from =</span> cd_value, <span class="dt">names_prefix =</span> <span class="st">"customDim"</span>)</code></pre></div>
<p>To unnest ecommerce and filter to only transactions, an example is shown below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a_user<span class="op">$</span>hits <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(activityType <span class="op">==</span><span class="st"> "ECOMMERCE"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(id, sessionId, activityTime, ecommerce) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">transaction =</span> <span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(ecommerce, <span class="st">"transaction"</span>),
         <span class="dt">transactionRevenue =</span> <span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span>(transaction, <span class="op">~</span>.[[<span class="st">"transactionRevenue"</span>]] <span class="op">%||%</span><span class="st"> </span><span class="ot">NA</span>),
         <span class="dt">transactionId =</span> <span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span>(transaction, <span class="op">~</span>.[[<span class="st">"transactionId"</span>]] <span class="op">%||%</span><span class="st"> </span><span class="ot">NA</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(transactionRevenue)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>transaction, <span class="op">-</span>ecommerce)</code></pre></div>
<p>To get the traffic sources per hit, you only need the first hit per session so can compute via:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a_user<span class="op">$</span>hits <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(activityType <span class="op">==</span><span class="st"> "PAGEVIEW"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(id, sessionId, activityTime, 
         source, medium, 
         channelGrouping, campaign, 
         keyword, landingPagePath) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(id, sessionId) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_all</a></span>(min)</code></pre></div>
</div>
</div>
<div id="filtering-the-response" class="section level2">
<h2 class="hasAnchor">
<a href="#filtering-the-response" class="anchor"></a>Filtering the response</h2>
<p>If you specify the <code>activity_type</code> parameter, you can filter down the response to only the events you include in a vector.</p>
<p>The permitted types are: <code><a href="https://www.rdocumentation.org/packages/base/topics/c">c("PAGEVIEW","SCREENVIEW","GOAL","ECOMMERCE","EVENT")</a></code> - include some of these to specify which you would like to see.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">only_goals &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ga_clientid_activity.html">ga_clientid_activity</a></span>(two_clientIds,
                                   <span class="dt">viewId =</span> <span class="dv">81416156</span>, 
                                   <span class="dt">date_range =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"2019-01-01"</span>,<span class="st">"2019-02-01"</span>),
                                   <span class="dt">activity_types =</span> <span class="st">"GOAL"</span>)</code></pre></div>
</div>
<div id="example-calling-users-via-a-custom-dimension" class="section level2">
<h2 class="hasAnchor">
<a href="#example-calling-users-via-a-custom-dimension" class="anchor"></a>Example calling users via a custom dimension</h2>
<p>If you are capturing Google Analytics cookie ID in a custom dimension (Which is a good idea!) then the below workflow shows how you can use the standard reporting API to fetch more detail on the users:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(googleAnalyticsR)

al &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ga_account_list.html">ga_account_list</a></span>()

<span class="co"># get a viewID you know has implemented putting cookie ID in a custom dimension</span>
viewId &lt;-<span class="st"> </span><span class="dv">84714057</span>

view_row &lt;-<span class="st"> </span>al[al<span class="op">$</span>viewId <span class="op">==</span><span class="st"> </span>viewId,]

<span class="co"># get the custom dimensions</span>
cus_dims &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ga_custom_vars_list.html">ga_custom_vars_list</a></span>(<span class="dt">accountId =</span> view_row<span class="op">$</span>accountId,
                                <span class="dt">webPropertyId =</span> view_row<span class="op">$</span>webPropertyId,
                                <span class="dt">type =</span> <span class="st">"customDimensions"</span>)
                                
<span class="co">#In this example, client.id is in ga:dimension2</span>

<span class="co"># date range of ids to query</span>
dates &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.time">Sys.Date</a></span>() <span class="op">-</span><span class="st"> </span><span class="dv">30</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.time">Sys.Date</a></span>() <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)

<span class="co"># download all client.ids who had a pageview in last 30 days</span>
<span class="co"># change this query to a segment of users you are interested in</span>
cids &lt;-<span class="st"> </span><span class="kw"><a href="../reference/google_analytics.html">google_analytics</a></span>(viewId, <span class="dt">date_range =</span> dates,
                         <span class="dt">dimensions =</span> <span class="st">"dimension2"</span>, <span class="dt">metrics =</span> <span class="st">"pageviews"</span>,
                         <span class="dt">order =</span> <span class="kw"><a href="../reference/order_type.html">order_type</a></span>(<span class="st">"pageviews"</span>, <span class="st">"DESCENDING"</span>),
                         <span class="dt">max =</span> <span class="dv">1000</span>)

<span class="co"># download user activity for all the users</span>
user_activities &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ga_clientid_activity.html">ga_clientid_activity</a></span>(cids<span class="op">$</span>dimension2,
                                        <span class="dt">viewId =</span> viewId,
                                        <span class="dt">date_range =</span> dates)</code></pre></div>
</div>
<div id="sampled-response" class="section level2">
<h2 class="hasAnchor">
<a href="#sampled-response" class="anchor"></a>Sampled response</h2>
<p>The API response may be sampled - it will send a message if this happens. If it does, follow the advice on the <a href="https://developers.google.com/analytics/devguides/reporting/core/v4/user-reporting">API documentation</a> such as splitting up the call into smaller date ranges.</p>
<p>Also bear in mind each API call counts against your Analytics Reporting v4 API quota which by default is 50k per day, so you won’t be able to fetch more user activity than that without increasing your API quota.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#user-activity-api-example">User Activity API example</a></li>
      <li><a href="#multiple-ids">Multiple ids</a></li>
      <li><a href="#return-format">Return format</a></li>
      <li><a href="#filtering-the-response">Filtering the response</a></li>
      <li><a href="#example-calling-users-via-a-custom-dimension">Example calling users via a custom dimension</a></li>
      <li><a href="#sampled-response">Sampled response</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Mark Edmondson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
