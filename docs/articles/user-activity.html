<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Activity API • googleAnalyticsR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="User Activity API">
<meta property="og:description" content="googleAnalyticsR">
<meta property="og:image" content="https://code.markedmondson.me/googleAnalyticsR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-47480439-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-47480439-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">googleAnalyticsR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/setup.html">
    <span class="fas fa-wrench"></span>
     
    Setup
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-table"></span>
     
    Reporting APIs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/reporting-ga4.html">
        <span class="fas fa-digital-tachograph"></span>
         
        GA4 Data API
      </a>
    </li>
    <li>
      <a href="../articles/measurement-protocol-v2.html">
        <span class="fas fa-upload"></span>
         
        Measurement Protocol
      </a>
    </li>
    <li>
      <a href="../articles/v4.html">
        <span class="fas fa-cogs"></span>
         
        v4 API
      </a>
    </li>
    <li>
      <a href="../articles/user-activity.html">
        <span class="fas fa-user"></span>
         
        User Activity API
      </a>
    </li>
    <li>
      <a href="../articles/v3.html">
        <span class="fas fa-cog"></span>
         
        v3 API
      </a>
    </li>
    <li>
      <a href="../articles/big-query.html">
        <span class="fas fa-search"></span>
         
        BigQuery
      </a>
    </li>
    <li>
      <a href="../articles/ganalytics.html">
        <span class="fas fa-bullseye"></span>
         
        ganalytics
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/management.html">
    <span class="fas fa-briefcase"></span>
     
    Management API
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-file"></span>
     
    Publishing
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/shiny.html">
        <span class="fas fa-cloud-upload"></span>
         
        Shiny
      </a>
    </li>
    <li>
      <a href="../articles/rmarkdown.html">
        <span class="fas fa-pencil-square"></span>
         
        RMarkdown
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-calculator"></span>
     
    Models
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/models.html">
        <span class="fas fa-calculator"></span>
         
        Creating Models
      </a>
    </li>
    <li>
      <a href="../articles/model-templates.html">
        <span class="fas fa-photo-video"></span>
         
        Shiny Model Templates
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-question-circle"></span>
     
    Help
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../reference/index.html">
        <span class="fas fa-book-reader"></span>
         
        Function Reference
      </a>
    </li>
    <li>
      <a href="../news/index.html">
        <span class="fas fa-newspaper"></span>
         
        News
      </a>
    </li>
    <li>
      <a href="../articles/faq.html">
        <span class="fas fa-glasses"></span>
         
        FAQs
      </a>
    </li>
    <li>
      <a href="../articles/practical-tips.html">
        <span class="fas fa-bicycle"></span>
         
        Practical tips
      </a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MarkEdmondson1234/googleAnalyticsR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="user-activity_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>User Activity API</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MarkEdmondson1234/googleAnalyticsR/blob/master/vignettes/user-activity.Rmd"><code>vignettes/user-activity.Rmd</code></a></small>
      <div class="hidden name"><code>user-activity.Rmd</code></div>

    </div>

    
    
<p>The <a href="https://developers.google.com/analytics/devguides/reporting/core/v4/rest/v4/userActivity/search">User Activity API</a> lets you query an individual user’s movement through your website, by sending in the individual <code>clientId</code> or <code>userId</code>. It is accessed via the <code><a href="../reference/ga_clientid_activity.html">ga_clientid_activity()</a></code> function.</p>
<p>Use Activity is available in version of <code>googleAnalyticsR &gt;= 0.6.9000</code> and needs <code>googleAuthR &gt;= 0.7.0.9000</code> so install via:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"MarkEdmondson1234/googleAuthR"</span><span class="op">)</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"MarkEdmondson1234/googleAnalyticsR"</span><span class="op">)</span></code></pre></div>
<div id="user-activity-api-example" class="section level2">
<h2 class="hasAnchor">
<a href="#user-activity-api-example" class="anchor"></a>User Activity API example</h2>
<p>You first need to have a <code>clientId</code> or <code>userId</code> to query. You can now get this from the reporting API via the dimension <code>ga:clientId</code>.</p>
<p>Its also available via the User Explorer report in the Web UI, or via a BigQuery export, or you may be capturing the ID in a custom dimension.</p>
<p>Once you have an ID, specify the Google Analytics view that user was browsing and the data range of the activity you want to query:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">viewId</span> <span class="op">&lt;-</span> <span class="fl">123456</span>
<span class="va">date_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yesterday"</span>,<span class="st">"yesterday"</span><span class="op">)</span>
<span class="va">cids</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/google_analytics.html">google_analytics</a></span><span class="op">(</span><span class="va">viewId</span>, date_range <span class="op">=</span> <span class="va">date_range</span>, 
                         metrics <span class="op">=</span> <span class="st">"sessions"</span>, dimensions <span class="op">=</span> <span class="st">"clientId"</span><span class="op">)</span>
<span class="va">users</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_clientid_activity.html">ga_clientid_activity</a></span><span class="op">(</span><span class="va">cids</span><span class="op">$</span><span class="va">clientId</span>,
                              viewId <span class="op">=</span> <span class="va">viewId</span>, 
                              date_range <span class="op">=</span> <span class="va">date_range</span><span class="op">)</span>
<span class="co">#&gt; 2019-08-15 10:43:15&gt; Fetching id: 19123.15505123</span>
<span class="co">#&gt; 2019-08-15 10:43:16&gt; Fetching id: 12123.15657123</span>
<span class="co">#&gt; 2019-08-15 10:43:17&gt; Fetching id: 11234.15657123</span>
<span class="co">#&gt; 2019-08-15 10:43:17&gt; Fetching id: 21123.1565123</span>
<span class="co">#&gt; ..etc..</span></code></pre></div>
</div>
<div id="multiple-ids" class="section level2">
<h2 class="hasAnchor">
<a href="#multiple-ids" class="anchor"></a>Multiple ids</h2>
<p>You can send in multiple IDs of the same type in a vector:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">two_clientIds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1106980347.1461227730"</span>, <span class="st">"476443645.1541099566"</span><span class="op">)</span>
<span class="va">two_users</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_clientid_activity.html">ga_clientid_activity</a></span><span class="op">(</span><span class="va">two_clientIds</span>,
                                  viewId <span class="op">=</span> <span class="fl">81416156</span>, 
                                  date_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2019-01-01"</span>,<span class="st">"2019-02-01"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="return-format" class="section level2">
<h2 class="hasAnchor">
<a href="#return-format" class="anchor"></a>Return format</h2>
<p>The API returns two types of data: session level and activity hit level. Access it via <code>$sessions</code> or <code>$hits</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">two_users</span><span class="op">$</span><span class="va">sessions</span>
<span class="co">#    sessionId deviceCategory  platform dataSource sessionDate                    id</span>
<span class="co">#1  1548361067        desktop Macintosh        web  2019-01-24 1106980347.1461227730</span>
<span class="co">#2  1548261976        desktop Macintosh        web  2019-01-23 1106980347.1461227730</span>
<span class="co">#3  1548251272        desktop Macintosh        web  2019-01-23 1106980347.1461227730</span>
<span class="co">#4  1548017997        desktop Macintosh        web  2019-01-20 1106980347.1461227730</span>
<span class="co"># ...</span>

<span class="va">two_users</span><span class="op">$</span><span class="va">hits</span>
<span class="co"># A tibble: 102 x 26</span>
<span class="co">#   sessionId activityTime        source medium channelGrouping campaign keyword hostname</span>
<span class="co">#   &lt;chr&gt;     &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;           &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;   </span>
<span class="co"># 1 15483610… 2019-01-24 21:17:47 t.co   refer… Social          (not se… (not s… code.ma…</span>
<span class="co"># 2 15482619… 2019-01-23 17:46:16 t.co   refer… Social          (not se… (not s… code.ma…</span>
<span class="co"># 3 15482512… 2019-01-23 14:47:52 t.co   refer… Social          (not se… (not s… code.ma…</span>
<span class="co"># ...</span></code></pre></div>
<p>The amount of data returned is rich for the activity, the data columns are shown below (Although some will be empty for some rows if not applicable).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">two_users</span><span class="op">$</span><span class="va">hits</span><span class="op">)</span>
<span class="co"># [1] "sessionId"            "activityTime"         "source"               "medium"              </span>
<span class="co"># [5] "channelGrouping"      "campaign"             "keyword"              "hostname"            </span>
<span class="co"># [9] "landingPagePath"      "activityType"         "customDimension"      "pagePath"            </span>
<span class="co">#[13] "pageTitle"            "screenName"           "mobileDeviceBranding" "mobileDeviceModel"   </span>
<span class="co">#[17] "appName"              "ecommerce"            "goals"                "has_goal"            </span>
<span class="co">#[21] "eventCategory"        "eventAction"          "eventLabel"           "eventValue"          </span>
<span class="co">#[25] "eventCount"           "id" </span></code></pre></div>
<p>The data.frames returned include the ID you sent in as the <code>$id</code> column so you can distinguish between users.</p>
<div id="nested-columns" class="section level3">
<h3 class="hasAnchor">
<a href="#nested-columns" class="anchor"></a>Nested columns</h3>
<p>The output uses nested columns for some values so you may want to get familiar with the <code><a href="https://tidyr.tidyverse.org/reference/nest.html">tidyr::unnest()</a></code> function when working with the data.</p>
<p>The nested columns are <code>hits$customDimension</code>, <code>hits$ecommerce</code> and <code>hits$goals</code>.</p>
<p>The nesting is necessary as you can have multiple of these events per hit, and expanding them in the response would make a very large <code>data.frame</code> to work with.</p>
<p>An example on how to unnest goals is shown below:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>

<span class="va">a_user</span><span class="op">$</span><span class="va">hits</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">has_goal</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># filter to just hits with goals</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">sessionId</span>, <span class="va">activityTime</span>, <span class="va">goals</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="va">goals</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># unnest the goals list column</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>goalIndex <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">goals</span>, <span class="st">"goalIndex"</span><span class="op">)</span>, 
         goalName <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">goals</span>, <span class="st">"goalName"</span><span class="op">)</span>, 
         goalCompletionLocation <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">goals</span>, <span class="st">"goalCompletionLocation"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">goals</span><span class="op">)</span>
<span class="co">## A tibble: 4 x 6</span>
<span class="co">#  id                  sessionId  activityTime        goalIndex goalName           goalCompletionLocation                </span>
<span class="co">#  &lt;chr&gt;               &lt;chr&gt;      &lt;dttm&gt;              &lt;chr&gt;     &lt;chr&gt;              &lt;chr&gt;                                 </span>
<span class="co">#1 1106980347.1461227… 1548016803 2019-01-20 21:40:53 20        Visited over 4 pa… /googleAnalyticsR/articles/setup.html </span>
<span class="co">#2 1106980347.1461227… 1546979541 2019-01-08 21:34:18 1         Time over a minut… /googleAnalyticsR/articles/ganalytics…</span>
<span class="co">#3 1106980347.1461227… 1546802623 2019-01-06 20:26:59 1         Time over a minut… /googleAnalyticsR/articles/v4.html    </span>
<span class="co">#4 1106980347.1461227… 1546467261 2019-01-02 23:15:50 1         Time over a minut… /googleAnalyticsR/   </span></code></pre></div>
<p>To unnest custom dimensions, some example code is below:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span> <span class="co"># devtools::install_github("tidyverse/tidyr")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>

<span class="va">a_user</span><span class="op">$</span><span class="va">hits</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">sessionId</span>, <span class="va">activityTime</span>, <span class="va">customDimension</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="va">customDimension</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>cd_index <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">customDimension</span>, <span class="st">"index"</span><span class="op">)</span>, 
         cd_value <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">customDimension</span>, <span class="op">~</span> <span class="va">.</span><span class="op">$</span><span class="va">value</span> <span class="op">%||%</span> <span class="cn">NA_character_</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">cd_value</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">customDimension</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">cd_index</span>, values_from <span class="op">=</span> <span class="va">cd_value</span>, names_prefix <span class="op">=</span> <span class="st">"customDim"</span><span class="op">)</span></code></pre></div>
<p>To unnest ecommerce and filter to only transactions, an example is shown below:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a_user</span><span class="op">$</span><span class="va">hits</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">activityType</span> <span class="op">==</span> <span class="st">"ECOMMERCE"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">sessionId</span>, <span class="va">activityTime</span>, <span class="va">ecommerce</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>transaction <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">ecommerce</span>, <span class="st">"transaction"</span><span class="op">)</span>,
         transactionRevenue <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span><span class="va">transaction</span>, <span class="op">~</span><span class="va">.</span><span class="op">[[</span><span class="st">"transactionRevenue"</span><span class="op">]</span><span class="op">]</span> <span class="op">%||%</span> <span class="cn">NA</span><span class="op">)</span>,
         transactionId <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">transaction</span>, <span class="op">~</span><span class="va">.</span><span class="op">[[</span><span class="st">"transactionId"</span><span class="op">]</span><span class="op">]</span> <span class="op">%||%</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">transactionRevenue</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">transaction</span>, <span class="op">-</span><span class="va">ecommerce</span><span class="op">)</span></code></pre></div>
<p>To get the traffic sources per hit, you only need the first hit per session so can compute via:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a_user</span><span class="op">$</span><span class="va">hits</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">activityType</span> <span class="op">==</span> <span class="st">"PAGEVIEW"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">sessionId</span>, <span class="va">activityTime</span>, 
         <span class="va">source</span>, <span class="va">medium</span>, 
         <span class="va">channelGrouping</span>, <span class="va">campaign</span>, 
         <span class="va">keyword</span>, <span class="va">landingPagePath</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">sessionId</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_all</a></span><span class="op">(</span><span class="va">min</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="filtering-the-response" class="section level2">
<h2 class="hasAnchor">
<a href="#filtering-the-response" class="anchor"></a>Filtering the response</h2>
<p>If you specify the <code>activity_type</code> parameter, you can filter down the response to only the events you include in a vector.</p>
<p>The permitted types are: <code><a href="https://rdrr.io/r/base/c.html">c("PAGEVIEW","SCREENVIEW","GOAL","ECOMMERCE","EVENT")</a></code> - include some of these to specify which you would like to see.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">only_goals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_clientid_activity.html">ga_clientid_activity</a></span><span class="op">(</span><span class="va">two_clientIds</span>,
                                   viewId <span class="op">=</span> <span class="fl">81416156</span>, 
                                   date_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2019-01-01"</span>,<span class="st">"2019-02-01"</span><span class="op">)</span>,
                                   activity_types <span class="op">=</span> <span class="st">"GOAL"</span><span class="op">)</span></code></pre></div>
</div>
<div id="example-calling-users-via-a-custom-dimension" class="section level2">
<h2 class="hasAnchor">
<a href="#example-calling-users-via-a-custom-dimension" class="anchor"></a>Example calling users via a custom dimension</h2>
<p>If you are capturing Google Analytics cookie ID or a userId in a custom dimension then the below workflow shows how you can use the standard reporting API to fetch more detail on the users:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://code.markedmondson.me/googleAnalyticsR/">googleAnalyticsR</a></span><span class="op">)</span>

<span class="va">al</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_account_list.html">ga_account_list</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># get a viewID you know has implemented putting cookie ID in a custom dimension</span>
<span class="va">viewId</span> <span class="op">&lt;-</span> <span class="fl">84714057</span>

<span class="va">view_row</span> <span class="op">&lt;-</span> <span class="va">al</span><span class="op">[</span><span class="va">al</span><span class="op">$</span><span class="va">viewId</span> <span class="op">==</span> <span class="va">viewId</span>,<span class="op">]</span>

<span class="co"># get the custom dimensions</span>
<span class="va">cus_dims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_custom_vars_list.html">ga_custom_vars_list</a></span><span class="op">(</span>accountId <span class="op">=</span> <span class="va">view_row</span><span class="op">$</span><span class="va">accountId</span>,
                                webPropertyId <span class="op">=</span> <span class="va">view_row</span><span class="op">$</span><span class="va">webPropertyId</span>,
                                type <span class="op">=</span> <span class="st">"customDimensions"</span><span class="op">)</span>
                                
<span class="co">#In this example, user.id is in ga:dimension2</span>

<span class="co"># date range of ids to query</span>
<span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">30</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>

<span class="co"># download all client.ids who had a pageview in last 30 days</span>
<span class="co"># change this query to a segment of users you are interested in</span>
<span class="va">cids</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/google_analytics.html">google_analytics</a></span><span class="op">(</span><span class="va">viewId</span>, date_range <span class="op">=</span> <span class="va">dates</span>,
                         dimensions <span class="op">=</span> <span class="st">"dimension2"</span>, metrics <span class="op">=</span> <span class="st">"pageviews"</span>,
                         order <span class="op">=</span> <span class="fu"><a href="../reference/order_type.html">order_type</a></span><span class="op">(</span><span class="st">"pageviews"</span>, <span class="st">"DESCENDING"</span><span class="op">)</span>,
                         max <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>

<span class="co"># download user activity for all the users</span>
<span class="va">user_activities</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_clientid_activity.html">ga_clientid_activity</a></span><span class="op">(</span><span class="va">cids</span><span class="op">$</span><span class="va">dimension2</span>,
                                        viewId <span class="op">=</span> <span class="va">viewId</span>,
                                        date_range <span class="op">=</span> <span class="va">dates</span><span class="op">)</span></code></pre></div>
</div>
<div id="sampled-response" class="section level2">
<h2 class="hasAnchor">
<a href="#sampled-response" class="anchor"></a>Sampled response</h2>
<p>The API response may be sampled - it will send a message if this happens. If it does, follow the advice on the <a href="https://developers.google.com/analytics/devguides/reporting/core/v4/user-reporting">API documentation</a> such as splitting up the call into smaller date ranges.</p>
<p>Also bear in mind each API call counts against your Analytics Reporting v4 API quota which by default is 50k per day, so you won’t be able to fetch more user activity than that without increasing your API quota.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Mark Edmondson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
