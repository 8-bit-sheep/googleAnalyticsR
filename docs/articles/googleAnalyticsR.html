<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>googleAnalyticsR. googleAnalyticsR</title><!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <div class="container">
      <header><div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">googleAnalyticsR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="../articles/setup.html">
    <span class="fa fa-wrench"></span>
     
    Setup
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Reporting API
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/v4.html">
        <span class="fa fa-cogs"></span>
         
        v4
      </a>
    </li>
    <li>
      <a href="../articles/v3.html">
        <span class="fa fa-cog"></span>
         
        v3
      </a>
    </li>
  </ul></li>
<li>
  <a href="../articles/big-query.html">
    <span class="fa fa-search"></span>
     
    Big Query
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Reporting
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/shiny.html">
        <span class="fa fa-cloud-upload"></span>
         
        Shiny
      </a>
    </li>
    <li>
      <a href="../articles/rmarkdown.html">
        <span class="fa fa-pencil-square"></span>
         
        RMarkdown
      </a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Help
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../reference/index.html">
        <span class="fa fa-question-circle"></span>
         
        Reference
      </a>
    </li>
    <li>
      <a href="../news/index.html">
        <span class="fa fa-newspaper-o"></span>
         
        News
      </a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>googleAnalyticsR</h1>
                        <h4 class="author">Mark Edmondson</h4>
            
            <h4 class="date">2016-10-12</h4>
          </div>

    
    
<p><a href="http://code.markedmondson.me/googleAnalyticsR">googleAnalyticsR guide online</a></p>
<p>A new Google Analytics R library using the new v4 of the Google Analytics Reporting API. Built using <a href="https://github.com/MarkEdmondson1234/googleAuthR"><code>googleAuthR</code></a>. The successor to <a href="https://github.com/MarkEdmondson1234/shinyga"><code>shinyga</code></a> it allows online OAuth2 authentication within Shiny apps, along with new features such as batching and compatibility with other Google APIs.</p>
<div id="other-ga-r-libraries" class="section level2">
<h2>Other GA R libraries</h2>
<p>These are all great libraries, that I have taken inspiration from.</p>
<ul><li><a href="https://github.com/skardhamar/rga">rga</a></li>
<li><a href="https://bitbucket.org/unikum/rga">RGA</a></li>
<li><a href="https://github.com/Tatvic/RGoogleAnalytics">RGoogleAnalytics</a></li>
<li><a href="https://github.com/jdeboer/ganalytics">ganalytics</a></li>
<li><a href="https://github.com/andrewgeisler/GAR">GAR</a></li>
</ul></div>
<div id="why-do-we-need-another-ga-library" class="section level2">
<h2>Why do we need another GA library?</h2>
<ul><li>First Google Analytics Reporting v4 API library for R</li>
<li>v4 features include: dynamic calculated metrics, pivots, histograms, date comparisons, batching.</li>
<li>Shiny App compatible</li>
<li>The same authentication flow can be used with other <code>googleAuthR</code> apps like <a href="https://github.com/MarkEdmondson1234/searchConsoleR"><code>searchConsoleR</code></a></li>
<li>Automatic batching, sampling avoidance with daily walk, multi-account fetching, multi-channel funnnel</li>
<li>Support for <code>googleAuthR</code> batch, meaning 10 calls at once to GA - great for big fetches. For big data calls this is implemented automatically so could be 10x quicker than normal GA fetching</li>
<li>Meta data included in attributes of returned dataframe including date ranges, totals, min and max</li>
</ul></div>
<div id="install" class="section level2">
<h2>Install</h2>
<p>You need the version &gt; <code>0.3.0</code> of <code>googleAuthR</code> too:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">"googleAuthR"</span>)
<span class="kw">install.packages</span>(<span class="st">"googleAnalyticsR"</span>)</code></pre></div>
<div id="development-version-off-github" class="section level3">
<h3>Development version off github</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools::<span class="kw">install_github</span>(<span class="st">"MarkEdmondson1234/googleAnalyticsR"</span>)</code></pre></div>
</div>
</div>
<div id="to-use---v4-api-calls" class="section level2">
<h2>To use - v4 API calls</h2>
<p>Todo. But check out <code>?google_analytics_4</code> and these example queries:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## setup
<span class="kw">library</span>(googleAnalyticsR)

## authenticate, or use the RStudio Addin "Google API Auth" with analytics scopes set
<span class="kw"><a href="../reference/ga_auth.html">ga_auth</a></span>()

## get your accounts
account_list &lt;-<span class="st"> </span><span class="kw"><a href="../reference/google_analytics_account_list.html">google_analytics_account_list</a></span>()

## pick a profile with data to query
ga_id &lt;-<span class="st"> </span>account_list[<span class="dv">23</span>,<span class="st">'viewId'</span>]</code></pre></div>
<div id="new-filter-syntax" class="section level3">
<h3>New Filter Syntax</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## create filters on metrics
mf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/met_filter.html">met_filter</a></span>(<span class="st">"bounces"</span>, <span class="st">"GREATER_THAN"</span>, <span class="dv">0</span>)
mf2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/met_filter.html">met_filter</a></span>(<span class="st">"sessions"</span>, <span class="st">"GREATER"</span>, <span class="dv">2</span>)

## create filters on dimensions
df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dim_filter.html">dim_filter</a></span>(<span class="st">"source"</span>,<span class="st">"BEGINS_WITH"</span>,<span class="st">"1"</span>,<span class="dt">not =</span> <span class="ot">TRUE</span>)
df2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dim_filter.html">dim_filter</a></span>(<span class="st">"source"</span>,<span class="st">"BEGINS_WITH"</span>,<span class="st">"a"</span>,<span class="dt">not =</span> <span class="ot">TRUE</span>)

## construct filter objects
fc2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/filter_clause_ga4.html">filter_clause_ga4</a></span>(<span class="kw">list</span>(df, df2), <span class="dt">operator =</span> <span class="st">"AND"</span>)
fc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/filter_clause_ga4.html">filter_clause_ga4</a></span>(<span class="kw">list</span>(mf, mf2), <span class="dt">operator =</span> <span class="st">"AND"</span>)

## make v4 request
## demo showing how the new filters work
ga_data1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/google_analytics_4.html">google_analytics_4</a></span>(ga_id, 
                              <span class="dt">date_range =</span> <span class="kw">c</span>(<span class="st">"2015-07-30"</span>,<span class="st">"2015-10-01"</span>),
                              <span class="dt">dimensions=</span><span class="kw">c</span>(<span class="st">'source'</span>,<span class="st">'medium'</span>), 
                              <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">'sessions'</span>,<span class="st">'bounces'</span>), 
                              <span class="dt">met_filters =</span> fc, 
                              <span class="dt">dim_filters =</span> fc2, 
                              <span class="dt">filtersExpression =</span> <span class="st">"ga:source!=(direct)"</span>)

ga_data1

<span class="co">#                     source   medium sessions bounces</span>
<span class="co"># 1                  baby.dk referral        3       2</span>
<span class="co"># 2                     bing  organic       71      42</span>
<span class="co"># 3  buttons-for-website.com referral        7       7</span>
<span class="co"># 4           duckduckgo.com referral        5       3</span>
<span class="co"># 5                   google  organic      642     520</span>
<span class="co"># 6                google.se referral        3       2</span>
<span class="co"># 7                 izito.se referral        3       1</span>
<span class="co"># 8          success-seo.com referral       35      35</span>
<span class="co"># 9    video--production.com referral       11      11</span>
<span class="co"># 10                   yahoo  organic       66      43</span>
<span class="co"># 11              zapmeta.se referral        6       4</span></code></pre></div>
</div>
<div id="querying-multiple-report-types-at-a-time" class="section level3">
<h3>Querying multiple report types at a time</h3>
<p>Example with two date ranges and two reports.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## demo of querying two date ranges at a time   
## we make the request via make_ga_4_req() to use in next demo
multidate_test &lt;-<span class="st"> </span><span class="kw"><a href="../reference/make_ga_4_req.html">make_ga_4_req</a></span>(ga_id, 
                                <span class="dt">date_range =</span> <span class="kw">c</span>(<span class="st">"2015-07-30"</span>,
                                               <span class="st">"2015-10-01"</span>,
                                               <span class="st">"2014-07-30"</span>,
                                               <span class="st">"2014-10-01"</span>),
                                <span class="dt">dimensions =</span> <span class="kw">c</span>(<span class="st">'source'</span>,<span class="st">'medium'</span>), 
                                <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">'sessions'</span>,<span class="st">'bounces'</span>))
                                
ga_data2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fetch_google_analytics_4.html">fetch_google_analytics_4</a></span>(multidate_test)
ga_data2
<span class="co">#                     source   medium sessions.d1 bounces.d1 sessions.d2 bounces.d2</span>
<span class="co"># 1                  baby.dk referral           3          2           6          3</span>
<span class="co"># 2                     bing  organic          71         42         217        126</span>
<span class="co"># 3  buttons-for-website.com referral           7          7           0          0</span>
<span class="co"># 4           duckduckgo.com referral           5          3           0          0</span>
<span class="co"># 5                   google  organic         642        520        1286        920</span>
<span class="co"># 6                google.se referral           3          2          12          9</span>
<span class="co"># 7                 izito.se referral           3          1           0          0</span>
<span class="co"># 8          success-seo.com referral          35         35           0          0</span>
<span class="co"># 9    video--production.com referral          11         11           0          0</span>
<span class="co"># 10                   yahoo  organic          66         43         236        178</span>
<span class="co"># 11              zapmeta.se referral           6          4           9          4</span>


## Demo querying two reports at the same time
## Use make_ga_4_req() to make multiple requests and then send 
##   them as a list to fetch_google_analytics_4()
multi_test2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/make_ga_4_req.html">make_ga_4_req</a></span>(ga_id,
                                <span class="dt">date_range =</span> <span class="kw">c</span>(<span class="st">"2015-07-30"</span>,
                                               <span class="st">"2015-10-01"</span>,
                                               <span class="st">"2014-07-30"</span>,
                                               <span class="st">"2014-10-01"</span>),
                             <span class="dt">dimensions=</span><span class="kw">c</span>(<span class="st">'hour'</span>,<span class="st">'medium'</span>), 
                             <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">'visitors'</span>,<span class="st">'bounces'</span>))

## all requests must have same viewID and dateRange
ga_data3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fetch_google_analytics_4.html">fetch_google_analytics_4</a></span>(<span class="kw">list</span>(multidate_test, multi_test2)) 
ga_data3
<span class="co"># [[1]]</span>
<span class="co">#                     source   medium sessions.d1 bounces.d1 sessions.d2 bounces.d2</span>
<span class="co"># 1                  baby.dk referral           3          2           6          3</span>
<span class="co"># 2                     bing  organic          71         42         217        126</span>
<span class="co"># 3  buttons-for-website.com referral           7          7           0          0</span>
<span class="co"># 4           duckduckgo.com referral           5          3           0          0</span>
<span class="co"># 5                   google  organic         642        520        1286        920</span>
<span class="co"># 6                google.se referral           3          2          12          9</span>
<span class="co"># 7                 izito.se referral           3          1           0          0</span>
<span class="co"># 8          success-seo.com referral          35         35           0          0</span>
<span class="co"># 9    video--production.com referral          11         11           0          0</span>
<span class="co"># 10                   yahoo  organic          66         43         236        178</span>
<span class="co"># 11              zapmeta.se referral           6          4           9          4</span>
<span class="co"># </span>
<span class="co"># [[2]]</span>
<span class="co">#    hour   medium visitors.d1 bounces.d1 visitors.d2 bounces.d2</span>
<span class="co"># 1    00  organic          28         16          85         59</span>
<span class="co"># 2    00 referral           3          2           1          1</span>
<span class="co"># 3    01  organic          43         28          93         66</span>
</code></pre></div>
</div>
<div id="on-the-fly-calculated-metrics" class="section level3">
<h3>On-the-fly calculated metrics</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ga_data4 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/google_analytics_4.html">google_analytics_4</a></span>(ga_id,
                               <span class="dt">date_range =</span> <span class="kw">c</span>(<span class="st">"2015-07-30"</span>,
                                              <span class="st">"2015-10-01"</span>),
                              <span class="dt">dimensions=</span><span class="kw">c</span>(<span class="st">'medium'</span>), 
                              <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="dt">visitsPerVisitor =</span> <span class="st">"ga:visits/ga:visitors"</span>,
                                          <span class="st">'bounces'</span>), 
                              <span class="dt">metricFormat =</span> <span class="kw">c</span>(<span class="st">"FLOAT"</span>,<span class="st">"INTEGER"</span>))
ga_data4
<span class="co">#     medium visitsPerVisitor bounces</span>
<span class="co"># 1   (none)         1.000000     117</span>
<span class="co"># 2  organic         1.075137     612</span>
<span class="co"># 3 referral         1.012500      71</span></code></pre></div>
</div>
<div id="segments-v4" class="section level3">
<h3>Segments v4</h3>
<p>Segments are more complex to configure that v3, but more powerful and in line to how you configure them in the UI</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## make a segment element
se &lt;-<span class="st"> </span><span class="kw"><a href="../reference/segment_element.html">segment_element</a></span>(<span class="st">"sessions"</span>, 
                      <span class="dt">operator =</span> <span class="st">"GREATER_THAN"</span>, 
                      <span class="dt">type =</span> <span class="st">"metric"</span>, 
                      <span class="dt">comparisonValue =</span> <span class="dv">1</span>, 
                      <span class="dt">scope =</span> <span class="st">"USER"</span>)
                      
se2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/segment_element.html">segment_element</a></span>(<span class="st">"medium"</span>, 
                      <span class="dt">operator =</span> <span class="st">"EXACT"</span>, 
                      <span class="dt">type =</span> <span class="st">"dimension"</span>, 
                      <span class="dt">expressions =</span> <span class="st">"organic"</span>)

## choose between segment_vector_simple or segment_vector_sequence
## Elements can be combined into clauses, which can then be combined into OR filter clauses
sv_simple &lt;-<span class="st"> </span><span class="kw"><a href="../reference/segment_vector_simple.html">segment_vector_simple</a></span>(<span class="kw">list</span>(<span class="kw">list</span>(se)))

sv_simple2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/segment_vector_simple.html">segment_vector_simple</a></span>(<span class="kw">list</span>(<span class="kw">list</span>(se2)))

## Each segment vector can then be combined into a logical AND
seg_defined &lt;-<span class="st"> </span><span class="kw"><a href="../reference/segment_define.html">segment_define</a></span>(<span class="kw">list</span>(sv_simple, sv_simple2))

## if only one AND definition, you can leave out wrapper list()
seg_defined_one &lt;-<span class="st"> </span><span class="kw"><a href="../reference/segment_define.html">segment_define</a></span>(sv_simple)


## Each segement defintion can apply to users, sessions or both.
## You can pass a list of several segments
segment4 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/segment_ga4.html">segment_ga4</a></span>(<span class="st">"simple"</span>, <span class="dt">user_segment =</span> seg_defined)

## Add the segments to the segments param
segment_example &lt;-<span class="st"> </span><span class="kw"><a href="../reference/google_analytics_4.html">google_analytics_4</a></span>(ga_id, 
                                      <span class="kw">c</span>(<span class="st">"2015-07-30"</span>,<span class="st">"2015-10-01"</span>), 
                                      <span class="dt">dimensions=</span><span class="kw">c</span>(<span class="st">'source'</span>,<span class="st">'medium'</span>,<span class="st">'segment'</span>), 
                                      <span class="dt">segments =</span> segment4, 
                                      <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">'sessions'</span>,<span class="st">'bounces'</span>)
                                      )

segment_example
<span class="co">#                            source   medium segment sessions bounces</span>
<span class="co"># 1                        24.co.uk referral  simple        1       1</span>
<span class="co"># 2                     aidsmap.com referral  simple        1       0</span>
<span class="co"># 3                             aol  organic  simple       30      19</span>
<span class="co"># 4                             ask  organic  simple       32      17</span>


## Sequence segment

se2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/segment_element.html">segment_element</a></span>(<span class="st">"medium"</span>, 
                       <span class="dt">operator =</span> <span class="st">"EXACT"</span>, 
                       <span class="dt">type =</span> <span class="st">"dimension"</span>, 
                       <span class="dt">expressions =</span> <span class="st">"organic"</span>)

se3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/segment_element.html">segment_element</a></span>(<span class="st">"medium"</span>,
                       <span class="dt">operator =</span> <span class="st">"EXACT"</span>,
                       <span class="dt">type =</span> <span class="st">"dimension"</span>,
                       <span class="dt">not =</span> <span class="ot">TRUE</span>,
                       <span class="dt">expressions =</span> <span class="st">"organic"</span>)

## step sequence
## users who arrived via organic then via referral
sv_sequence &lt;-<span class="st"> </span><span class="kw"><a href="../reference/segment_vector_sequence.html">segment_vector_sequence</a></span>(<span class="kw">list</span>(<span class="kw">list</span>(se2), 
                                             <span class="kw">list</span>(se3)))

seq_defined2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/segment_define.html">segment_define</a></span>(<span class="kw">list</span>(sv_sequence))

segment4_seq &lt;-<span class="st"> </span><span class="kw"><a href="../reference/segment_ga4.html">segment_ga4</a></span>(<span class="st">"sequence"</span>, <span class="dt">user_segment =</span> seq_defined2)

## Add the segments to the segments param
segment_seq_example &lt;-<span class="st"> </span><span class="kw"><a href="../reference/google_analytics_4.html">google_analytics_4</a></span>(ga_id, 
                                          <span class="kw">c</span>(<span class="st">"2016-04-01"</span>,<span class="st">"2016-05-01"</span>), 
                                          <span class="dt">dimensions=</span><span class="kw">c</span>(<span class="st">'source'</span>,<span class="st">'segment'</span>), 
                                          <span class="dt">segments =</span> segment4_seq,
                                          <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">'sessions'</span>,<span class="st">'bounces'</span>)
                                          )
segment_seq_example
<span class="co">#                                source  segment sessions bounces</span>
<span class="co"># 1                                 aol sequence        1       0</span>
<span class="co"># 2                                 ask sequence        5       1</span>
<span class="co"># 3      bestbackpackersinsurance.co.uk sequence        9       6</span>
<span class="co"># 4                                bing sequence       22       2</span></code></pre></div>
</div>
<div id="cohort-reports" class="section level3">
<h3>Cohort reports</h3>
<p>Details on <a href="https://developers.google.com/analytics/devguides/reporting/core/v4/advanced#cohorts">cohort reports and LTV can be found here</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## first make a cohort group
cohort4 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/make_cohort_group.html">make_cohort_group</a></span>(<span class="kw">list</span>(<span class="st">"cohort 1"</span> =<span class="st"> </span><span class="kw">c</span>(<span class="st">"2015-08-01"</span>, <span class="st">"2015-08-01"</span>), 
                                <span class="st">"cohort 2"</span> =<span class="st"> </span><span class="kw">c</span>(<span class="st">"2015-07-01"</span>,<span class="st">"2015-07-01"</span>)))

## then call cohort report.  No date_range and must include metrics and dimensions
##   from the cohort list
cohort_example &lt;-<span class="st"> </span><span class="kw"><a href="../reference/google_analytics_4.html">google_analytics_4</a></span>(ga_id, 
                                     <span class="dt">dimensions=</span><span class="kw">c</span>(<span class="st">'cohort'</span>), 
                                     <span class="dt">cohort =</span> cohort4, 
                                     <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">'cohortTotalUsers'</span>))

cohort_example
<span class="co">#     cohort cohortTotalUsers</span>
<span class="co"># 1 cohort 1               14</span>
<span class="co"># 2 cohort 2               20</span></code></pre></div>
</div>
<div id="pivot-requests" class="section level3">
<h3>Pivot Requests</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
## filter pivot results to 
pivot_dim_filter1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dim_filter.html">dim_filter</a></span>(<span class="st">"medium"</span>,
                                <span class="st">"REGEXP"</span>,
                                <span class="st">"organic|social|email|cpc"</span>)
                                
pivot_dim_clause &lt;-<span class="st"> </span><span class="kw"><a href="../reference/filter_clause_ga4.html">filter_clause_ga4</a></span>(<span class="kw">list</span>(pivot_dim_filter1))

pivme &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pivot_ga4.html">pivot_ga4</a></span>(<span class="st">"medium"</span>,
                   <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">"sessions"</span>), 
                   <span class="dt">maxGroupCount =</span> <span class="dv">4</span>, 
                   <span class="dt">dim_filter_clause =</span> pivot_dim_clause)

pivtest1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/google_analytics_4.html">google_analytics_4</a></span>(ga_id, 
                               <span class="kw">c</span>(<span class="st">"2016-01-30"</span>,<span class="st">"2016-10-01"</span>), 
                               <span class="dt">dimensions=</span><span class="kw">c</span>(<span class="st">'source'</span>), 
                               <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">'sessions'</span>), 
                               <span class="dt">pivots =</span> <span class="kw">list</span>(pivme))


<span class="kw">names</span>(pivtest1)
<span class="co">#  [1] "source"                      "sessions"                    "medium.referral.sessions"   </span>
<span class="co">#  [4] "medium..none..sessions"      "medium.cpc.sessions"         "medium.email.sessions"      </span>
<span class="co">#  [7] "medium.social.sessions"      "medium.twitter.sessions"     "medium.socialMedia.sessions"</span>
<span class="co"># [10] "medium.Social.sessions"      "medium.linkedin.sessions"  </span></code></pre></div>
</div>
</div>
<div id="to-use---v3-api-calls" class="section level2">
<h2>To use - v3 API calls</h2>
<p>v3 API calls are also tried and tested.</p>
<p>For syntax of filters and dimensions, this library parses in exactly as specified in the <a href="https://developers.google.com/analytics/devguides/reporting/core/v3/reference?hl=en#filters">Google Analytics v3 API docs</a>, so check those out. Note you do not need to encode symbols, but may have to encode URLs if you are filtering for those in say ga:pagePath</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(googleAnalyticsR)

## Authenticate in Google OAuth2
## this also sets options
<span class="kw"><a href="../reference/ga_auth.html">ga_auth</a></span>()

## if you need to re-authenticate use ga_auth(new_user=TRUE)

## if you have your own Google Dev console project keys, 
## then don't run ga_auth() as that will set the authentication project to the defaults.
## instead put your options here, and run googleAuthR::gar_auth()

## get account info, including View Ids
account_list &lt;-<span class="st"> </span><span class="kw"><a href="../reference/google_analytics_account_list.html">google_analytics_account_list</a></span>()
ga_id &lt;-<span class="st"> </span>account_list$viewId[<span class="dv">1</span>]

## get a list of what metrics and dimensions you can use
meta &lt;-<span class="st"> </span><span class="kw"><a href="../reference/google_analytics_meta.html">google_analytics_meta</a></span>()
<span class="kw">head</span>(meta)

## pick the account_list$viewId you want to see data for.
## metrics and dimensions can have or have not "ga:" prefix
gadata &lt;-<span class="st"> </span><span class="kw"><a href="../reference/google_analytics.html">google_analytics</a></span>(<span class="dt">id =</span> ga_id, 
                           <span class="dt">start=</span><span class="st">"2015-08-01"</span>, <span class="dt">end=</span><span class="st">"2015-08-02"</span>, 
                           <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">"sessions"</span>, <span class="st">"bounceRate"</span>), 
                           <span class="dt">dimensions =</span> <span class="kw">c</span>(<span class="st">"source"</span>, <span class="st">"medium"</span>))

## multi accounts, pass character vector of viewIds
## outputs a list of data.frames, named after the viewId
multi_gadata &lt;-<span class="st"> </span><span class="kw"><a href="../reference/google_analytics.html">google_analytics</a></span>(<span class="dt">id =</span> <span class="kw">c</span>(<span class="st">"123456"</span>,<span class="st">"9876545"</span>,<span class="st">"765432"</span>), 
                                 <span class="dt">start=</span><span class="st">"2015-08-01"</span>, <span class="dt">end=</span><span class="st">"2015-08-02"</span>, 
                                 <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">"sessions"</span>, <span class="st">"bounceRate"</span>), 
                                 <span class="dt">dimensions =</span> <span class="kw">c</span>(<span class="st">"source"</span>, <span class="st">"medium"</span>))

## if more than 10000 rows in results, auto batching
## example is setting lots of dimensions to try and create big sampled data
batch_gadata &lt;-<span class="st"> </span><span class="kw"><a href="../reference/google_analytics.html">google_analytics</a></span>(<span class="dt">id =</span> account_list$viewId[<span class="dv">1</span>], 
                                 <span class="dt">start=</span><span class="st">"2014-08-01"</span>, <span class="dt">end=</span><span class="st">"2015-08-02"</span>, 
                                 <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">"sessions"</span>, <span class="st">"bounceRate"</span>), 
                                 <span class="dt">dimensions =</span> <span class="kw">c</span>(<span class="st">"source"</span>, <span class="st">"medium"</span>, <span class="st">"landingPagePath"</span>,<span class="st">"hour"</span>,<span class="st">"minute"</span>),
                                 <span class="dt">max=</span><span class="dv">99999999</span>)

## mitigate sampling by setting samplingLevel="WALK"
## this will send lots and lots of calls to the Google API limits, beware
walk_gadata &lt;-<span class="st"> </span><span class="kw"><a href="../reference/google_analytics.html">google_analytics</a></span>(<span class="dt">id =</span> account_list$viewId[<span class="dv">1</span>], 
                                <span class="dt">start=</span><span class="st">"2014-08-01"</span>, <span class="dt">end=</span><span class="st">"2015-08-02"</span>, 
                                <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">"sessions"</span>, <span class="st">"bounceRate"</span>), 
                                <span class="dt">dimensions =</span> <span class="kw">c</span>(<span class="st">"source"</span>, <span class="st">"medium"</span>, <span class="st">"landingPagePath"</span>), 
                                <span class="dt">max=</span><span class="dv">99999999</span>, <span class="dt">samplingLevel=</span><span class="st">"WALK"</span>)

## multi-channel funnels set type="mcf"
mcf_gadata &lt;-<span class="st"> </span><span class="kw"><a href="../reference/google_analytics.html">google_analytics</a></span>(<span class="dt">id =</span> account_list$viewId[<span class="dv">1</span>], 
                               <span class="dt">start=</span><span class="st">"2015-08-01"</span>, <span class="dt">end=</span><span class="st">"2015-08-02"</span>, 
                               <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">"totalConversions"</span>), 
                               <span class="dt">dimensions =</span> <span class="kw">c</span>(<span class="st">"sourcePath"</span>), 
                               <span class="dt">type=</span><span class="st">"mcf"</span>)

## google_analytics dataframes include these meta data attributes:
-<span class="st"> </span><span class="kw">attr</span>(*, <span class="st">"containsSampledData"</span>)=<span class="st"> </span>logi <span class="ot">FALSE</span>
 -<span class="st"> </span><span class="kw">attr</span>(*, <span class="st">"samplePercent"</span>)=<span class="st"> </span>num <span class="dv">100</span>
 -<span class="st"> </span><span class="kw">attr</span>(*, <span class="st">"samplingLevel"</span>)=<span class="st"> </span>chr <span class="st">"DEFAULT"</span>
 -<span class="st"> </span><span class="kw">attr</span>(*, <span class="st">"profileInfo"</span>)=List of <span class="dv">6</span>
  ..$<span class="st"> </span>profileId            :<span class="st"> </span>chr <span class="st">"535656"</span>
  ..$<span class="st"> </span>accountId            :<span class="st"> </span>chr <span class="st">"2748374"</span>
  ..$<span class="st"> </span>webPropertyId        :<span class="st"> </span>chr <span class="st">"UA-278374-1"</span>
  ..$<span class="st"> </span>internalWebPropertyId:<span class="st"> </span>chr <span class="st">"5279208"</span>
  ..$<span class="st"> </span>profileName          :<span class="st"> </span>chr <span class="st">"XXXXX"</span>
  ..$<span class="st"> </span>tableId              :<span class="st"> </span>chr <span class="st">"mcf:539656"</span>
 -<span class="st"> </span><span class="kw">attr</span>(*, <span class="st">"dateRange"</span>)=List of <span class="dv">2</span>
  ..$<span class="st"> </span>startDate:<span class="st"> </span>chr <span class="st">"2015-08-01"</span>
  ..$<span class="st"> </span>endDate  :<span class="st"> </span>chr <span class="st">"2015-08-02"</span>
 -<span class="st"> </span><span class="kw">attr</span>(*, <span class="st">"totalResults"</span>)=<span class="st"> </span>int <span class="dv">4</span>

## reach meta-data via attr()
<span class="kw">attr</span>(gadata, <span class="st">"profileInfo"</span>)
<span class="kw">attr</span>(gadata, <span class="st">"dateRange"</span>)</code></pre></div>
</div>
<div id="using-your-own-google-developer-project-api-key" class="section level2">
<h2>Using your own Google Developer Project API Key</h2>
<p>With the amount of API calls possible with this library via batching and walking, its more likely the shared Google API project will hit the 50,000 calls per day limit.</p>
<p>To mitigate that, use your own Google Developer Console Project key, so it is not shared across all users of this library.</p>
<p>Get your own OAuth2 clientID and client secret and add to the options like so:</p>
<p>TODO: guide on how you get your own client Id.</p>
<div id="example-adding-your-own-google-developer-console-keys" class="section level3">
<h3>Example adding your own Google Developer Console keys</h3>
<p>Below a new client Id is set for both offline and Shiny use. Put the lines at the top of your R script with your own credentials.</p>
<p>In this example, the scopes are also set so a user can authenticate with searchConsoleR at the same time, which is possible as they both use googleAuthR as a backend.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">options</span>(<span class="st">"googleAuthR.client_id"</span> =<span class="st"> "994xxx55706-afliqtuxxxxxxx2fd4kesu6.apps.googleusercontent.com"</span>)
<span class="kw">options</span>(<span class="st">"googleAuthR.client_secret"</span> =<span class="st"> "3JhLa_GxxxxxCQYLe31c64"</span>)
<span class="kw">options</span>(<span class="st">"googleAuthR.scopes.selected"</span> =<span class="st"> </span><span class="kw">c</span>(<span class="st">"https://www.googleapis.com/auth/analytics"</span>, 
                                          <span class="st">"https://www.googleapis.com/auth/analytics.readonly"</span>, 
                                          <span class="st">"https://www.googleapis.com/auth/webmasters"</span>))
<span class="kw">options</span>(<span class="st">"googleAnalyticsR.webapp.client_id"</span> =<span class="st"> "994xxxx55706-e9qompxxxxx9pcab1u005cv.apps.googleusercontent.com"</span>)
<span class="kw">options</span>(<span class="st">"googleAnalyticsR.webapp.client_secret"</span> =<span class="st"> "zcofxxxxxxElemXN5sf"</span>)</code></pre></div>
</div>
</div>
<div id="shiny" class="section level2">
<h2>Shiny</h2>
<p>To use in Shiny, use the googleAuth <code>with_shiny</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
## in server.R
<span class="kw">library</span>(googleAuthR)
<span class="kw">library</span>(googleAnalyticsR)
<span class="kw">library</span>(shiny)

<span class="kw">shinyServer</span>(function(input, output, session){
  
  ## Get auth code from return URL
  access_token  &lt;-<span class="st"> </span><span class="kw">reactiveAccessToken</span>(session)
  
  ## Make a loginButton to display using loginOutput
  output$loginButton &lt;-<span class="st"> </span><span class="kw">renderLogin</span>(session, <span class="kw">access_token</span>(),
                                    <span class="dt">logout_class =</span> <span class="st">"btn btn-danger"</span>)

  gadata &lt;-<span class="st"> </span><span class="kw">reactive</span>({

    gadata &lt;-<span class="st"> </span><span class="kw">with_shiny</span>(google_analytics,
                         <span class="dt">id =</span> <span class="st">"222222"</span>,
                         <span class="dt">start=</span><span class="st">"2015-08-01"</span>, <span class="dt">end=</span><span class="st">"2015-08-02"</span>, 
                         <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">"sessions"</span>, <span class="st">"bounceRate"</span>), 
                         <span class="dt">dimensions =</span> <span class="kw">c</span>(<span class="st">"source"</span>, <span class="st">"medium"</span>),
                         <span class="dt">shiny_access_token =</span> <span class="kw">access_token</span>())

})</code></pre></div>
</div>
<div id="bigquery" class="section level2">
<h2>BigQuery</h2>
<p>Limited support for more user friendly calls to BigQuery Google Analytics 360 exports is implemented from version <code>0.2.0</code>.</p>
<p>This is intended for users who may be familar with Google Analytics but not with SQL necessary to extract equivalent data from a BigQuery export of Google Analytics 360 data.</p>
<p><code>google_analytics_bq</code> parses your metrics and dimensions into BigQuery queries.</p>
<div id="to-do" class="section level3">
<h3>To do</h3>
<p>This is under active development, and features will expand in the future. Eventually the BigQuery reports can do a lot more than the normal Google Analytics API as it allows for statistics, grouping, timestamps and unique visitor and visit Ids.</p>
</div>
<div id="setup" class="section level3">
<h3>Setup</h3>
<p>To use, you need to also install the <a href="http://code.markedmondson.me/bigQueryR/"><code>bigQueryR</code></a> library.</p>
<p>Stable version is on CRAN:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">"bigQueryR"</span>)</code></pre></div>
<p>Development version on devtools:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools::<span class="kw">install_github</span>(<span class="st">"MarkEdmondson1234/bigQueryR"</span>)</code></pre></div>
<p>Once installed, authenticate to BigQuery:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(bigQueryR)

## go through Google oAuth2 flow
## needs email that has access to the BigQuery dataset
<span class="kw">bqr_auth</span>()

## get lists of your project and datasets
<span class="kw">bqr_list_projects</span>()
<span class="kw">bqr_list_datasets</span>(<span class="st">"project-id"</span>)</code></pre></div>
<p>If you want to authenticate with Google Analytics and BigQuery in the same session (or others) then its best to authenticate with <code>googleAuthR::gar_auth()</code> with the appropriate scopes set. The below lets you authenticate with Google Analytics, Google Cloud Storage and BigQuery:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">options</span>(<span class="dt">googleAuthR.scopes.selected =</span> <span class="kw">c</span>(<span class="st">"https://www.googleapis.com/auth/analytics"</span>,
                                        <span class="st">"https://www.googleapis.com/auth/cloud-platform"</span>,
                                        <span class="st">"https://www.googleapis.com/auth/bigquery"</span>))
googleAuthR::<span class="kw">gar_auth</span>()</code></pre></div>
<p>You may also want to use a JSON file to authenticate with BigQuery. Make sure to add the service email to the users of the Google project, and then download the JSON file and authenitcate via:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">googleAuthR::<span class="kw">gar_auth_service</span>(<span class="st">"gwt-download-XXXX.json"</span>)</code></pre></div>
<p>See <a href="https://github.com/MarkEdmondson1234/googleAuthR"><code>googleAuthR</code> help</a> for more details.</p>
</div>
<div id="exporting-data" class="section level3">
<h3>Exporting data</h3>
<p>For BigQuery Google Analytics 360 exports, the dataset is the same as the GA View ID you are exporting.</p>
<p>You can then export BigQuery data via:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bq &lt;-<span class="st"> </span><span class="kw"><a href="../reference/google_analytics_bq.html">google_analytics_bq</a></span>(<span class="st">"project-id"</span>, <span class="st">"dataset-id-ga-viewid"</span>, 
                           <span class="dt">start =</span> <span class="st">"2016-01-01"</span>, <span class="dt">end =</span> <span class="st">"2016-02-01"</span>, 
                           <span class="dt">metrics =</span> <span class="st">"users"</span>, 
                           <span class="dt">dimensions =</span> <span class="kw">c</span>(<span class="st">"source"</span>,<span class="st">"medium"</span>))
<span class="kw">head</span>(bq)
             source   medium  users
<span class="dv">1</span>   mavas|blahbs.ru  display  <span class="dv">47837</span>
<span class="dv">2</span>          examp.ae referral   <span class="dv">6090</span>
<span class="dv">3</span>   lm.facebook.com referral    <span class="dv">335</span>
<span class="dv">4</span>       ghtie_yahoo  display <span class="dv">133900</span>
<span class="dv">5</span>      fjsfs_inmobi  display  <span class="dv">19887</span>
<span class="dv">6</span> tripadvisor.co.dk referral    <span class="dv">307</span>                         </code></pre></div>
<p>At the moment the metrics/dimensions are limited as they need to added manually to a lookup table.<br>
Segments/filters are not supported. The data is unsampled though.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bq2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/google_analytics_bq.html">google_analytics_bq</a></span>(<span class="st">"project-id"</span>, <span class="st">"dataset-id-ga-viewid"</span>, 
                           <span class="dt">start =</span> <span class="st">"2016-01-01"</span>, <span class="dt">end =</span> <span class="st">"2016-02-01"</span>, 
                           <span class="dt">metrics =</span> <span class="st">"users"</span>, 
                           <span class="dt">dimensions =</span> <span class="kw">c</span>(<span class="st">"source"</span>,<span class="st">"medium"</span>,<span class="st">"landingPagePath"</span>))
                           
&gt;<span class="st"> </span>Error in <span class="kw"><a href="../reference/google_analytics_bq.html">google_analytics_bq</a></span>(<span class="st">"project-id"</span>, <span class="st">"dataset-id-ga-viewid"</span>, <span class="dt">start =</span> <span class="st">"2016-01-01"</span>,  :<span class="st"> </span>
<span class="st">  </span>dimension not yet supported. Must be one of referralPath, campaign, source, medium, keyword, adContent, adwordsCampaignID, adwordsAdGroupID, transactionId, date, visitorId, visitId, visitStartTime, visitNumber                           </code></pre></div>
<p>You can also query the BigQuery table directly using the query parameter.</p>
<p>This is just as you would in the BigQuery interface, and allows queries you can also do there.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q &lt;-<span class="st"> "SELECT</span>
<span class="st">  date,</span>
<span class="st">  SUM (totals.visits) visits,</span>
<span class="st">  SUM (totals.pageviews) pageviews,</span>
<span class="st">  SUM (totals.transactions) transactions,</span>
<span class="st">  SUM (totals.transactionRevenue)/1000000 revenue</span>
<span class="st">FROM [87010628.ga_sessions_20160327],[87010628.ga_sessions_20160328],[87010628.ga_sessions_20160329]</span>
<span class="st">GROUP BY date</span>
<span class="st">ORDER BY date ASC "</span>

bq3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/google_analytics_bq.html">google_analytics_bq</a></span>(<span class="st">"project-id"</span>, <span class="st">"dataset-id-ga-viewid"</span>, 
                           <span class="dt">query =</span> q)</code></pre></div>
<p>You can also just output the query for use within the interface, if you pass in the parameter <code>return_query_only</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">just_query &lt;-<span class="st"> </span><span class="kw"><a href="../reference/google_analytics_bq.html">google_analytics_bq</a></span>(<span class="st">"project-id"</span>, <span class="st">"dataset-id-ga-viewid"</span>, 
                                  <span class="dt">start =</span> <span class="st">"2016-01-01"</span>, <span class="dt">end =</span> <span class="st">"2016-02-01"</span>, 
                                  <span class="dt">metrics =</span> <span class="st">"users"</span>, 
                                  <span class="dt">dimensions =</span> <span class="kw">c</span>(<span class="st">"source"</span>,<span class="st">"medium"</span>),
                                  <span class="dt">return_query_only =</span> <span class="ot">TRUE</span>)
just_query
<span class="co"># [1] "SELECT trafficSource.source as source, trafficSource.medium as medium, COUNT(fullVisitorId) as users </span>
<span class="co"># FROM (TABLE_DATE_RANGE([dataset-id-ga-viewid.ga_sessions_], TIMESTAMP('2016-01-01'),</span>
<span class="co"># TIMESTAMP('2016-02-01'))) GROUP BY source, medium  LIMIT 100"</span></code></pre></div>
<p>You could then paste this query into the BigQuery interface, or modify it and send it back in via <code>google_analytics_q</code>.</p>
</div>
<div id="implemented-metrics-and-dimensions" class="section level3">
<h3>Implemented metrics and dimensions</h3>
<p>The metrics and dimensions implemented so far are in the two lookups below.</p>
<p>They include the BigQuery exclusive <code>hitTimestamp</code>, <code>fullVisitorId</code>, <code>visitId</code> etc.</p>
<p>Read the full <a href="https://support.google.com/analytics/answer/3437719?hl=en">Google Analytics 360 BigQuery data schema</a> for an idea on what can be queried.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lookup_bq_query_m &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">visits =</span> <span class="st">"SUM(totals.visits) as sessions"</span>,
                       <span class="dt">sessions =</span> <span class="st">"SUM(totals.visits) as sessions"</span>,
                       <span class="dt">pageviews =</span> <span class="st">"SUM(totals.pageviews) as pageviews"</span>,
                       <span class="dt">timeOnSite =</span> <span class="st">"SUM(totals.timeOnSite) as timeOnSite"</span>,
                       <span class="dt">bounces =</span> <span class="st">"SUM(totals.bounces) as bounces"</span>,
                       <span class="dt">transactions =</span> <span class="st">"SUM(totals.transactions) as transactions"</span>,
                       <span class="dt">transactionRevenue =</span> <span class="st">"SUM(totals.transactionRevenue)/1000000 as transactionRevenue"</span>,
                       <span class="dt">newVisits =</span> <span class="st">"SUM(totals.newVisits) as newVisits"</span>,
                       <span class="dt">screenviews =</span> <span class="st">"SUM(totals.screenviews) as screenviews"</span>,
                       <span class="dt">uniqueScreenviews =</span> <span class="st">"SUM(totals.uniqueScreenviews) as uniqueScreenviews"</span>,
                       <span class="dt">timeOnScreen =</span> <span class="st">"SUM(totals.timeOnScreen) as timeOnScreen"</span>,
                       <span class="dt">users =</span> <span class="st">"COUNT(fullVisitorId) as users"</span>,
                       <span class="dt">exits =</span> <span class="st">"COUNT(hits.isExit) as exits"</span>,
                       <span class="dt">entrances =</span> <span class="st">"COUNT(hits.isEntrance) as entrances"</span>,
                       <span class="dt">eventValue =</span> <span class="st">"SUM(hits.eventinfo.eventValue) as eventValue"</span>,
                       <span class="dt">metricXX =</span> {a function to output hit level custom metrics})

lookup_bq_query_d &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">referralPath =</span> <span class="st">"trafficSource.referralPath as referralPath"</span>,
                       <span class="dt">hitTimestamp =</span> <span class="st">"(visitStartTime + (hits.time/1000)) as hitTimestamp"</span>,
                       <span class="dt">campaign =</span> <span class="st">"trafficSource.campaign as campaign"</span>,
                       <span class="dt">source =</span> <span class="st">"trafficSource.source as source"</span>,
                       <span class="dt">medium =</span> <span class="st">"trafficSource.medium as medium"</span>,
                       <span class="dt">keyword =</span> <span class="st">"trafficSource.keyword as keyword"</span>,
                       <span class="dt">adContent =</span> <span class="st">"trafficSource.adContent as adContent"</span>,
                       <span class="dt">adwordsCampaignID =</span> <span class="st">"trafficSource.adwordsClickInfo.campaignId as adwordsCampaignId"</span>,
                       <span class="dt">adwordsAdGroupID =</span> <span class="st">"trafficSource.adwordsClickInfo.adGroupId as adwordsAdGroupId"</span>,
                       <span class="co"># adwords...etc...</span>
                       <span class="dt">transactionId =</span> <span class="st">"hits.transaction.transactionId as transactionId"</span>,
                       <span class="dt">date =</span> <span class="st">"date"</span>,
                       <span class="dt">fullVisitorId =</span> <span class="st">"fullVisitorId"</span>,
                       <span class="dt">userId =</span> <span class="st">"userId"</span>,
                       <span class="dt">visitorId =</span> <span class="st">"visitorId"</span>,
                       <span class="dt">visitId =</span> <span class="st">"visitId"</span>,
                       <span class="dt">visitStartTime =</span> <span class="st">"visitStartTime"</span>,
                       <span class="dt">visitNumber =</span> <span class="st">"visitNumber"</span>,
                       <span class="dt">browser =</span> <span class="st">"device.browser as browser"</span>,
                       <span class="dt">browserVersion =</span> <span class="st">"device.browserVersion as browserVersion"</span>,
                       <span class="dt">operatingSystem =</span> <span class="st">"device.operatingSystem as operatingSystem"</span>,
                       <span class="dt">operatingSystemVersion =</span> <span class="st">"device.operatingSystemVersion as operatingSystemVersion"</span>,
                       <span class="dt">mobileDeviceBranding =</span> <span class="st">"device.mobileDeviceBranding as mobileDeviceBranding"</span>,
                       <span class="dt">flashVersion =</span> <span class="st">"device.flashVersion as flashVersion"</span>,
                       <span class="dt">language =</span> <span class="st">"device.language as language"</span>,
                       <span class="dt">screenColors =</span> <span class="st">"device.screenColors as screenColors"</span>,
                       <span class="dt">screenResolution =</span> <span class="st">"device.screenResolution as screenResolution"</span>,
                       <span class="dt">deviceCategory =</span> <span class="st">"device.deviceCategory as deviceCategory"</span>,
                       <span class="dt">continent =</span> <span class="st">"geoNetwork.continent as continent"</span>,
                       <span class="dt">subContinent =</span> <span class="st">"geoNetwork.subContinent as subContinent"</span>,
                       <span class="dt">country =</span> <span class="st">"geoNetwork.country as country"</span>,
                       <span class="dt">region =</span> <span class="st">"geoNetwork.region as region"</span>,
                       <span class="dt">metro =</span> <span class="st">"geoNetwork.region as metro"</span>,
                       <span class="dt">pagePath =</span> <span class="st">"hits.page.pagePath as pagePath"</span>,
                       <span class="dt">eventCategory =</span> <span class="st">"hits.eventInfo.eventCategory as eventCategory"</span>,
                       <span class="dt">eventAction =</span> <span class="st">"hits.eventInfo.eventAction as eventAction"</span>,
                       <span class="dt">eventLabel =</span> <span class="st">"hits.eventInfo.eventLabel as eventLabel"</span>,
                       <span class="dt">dimensionXX =</span> {a function to output hit level custom dimensions})</code></pre></div>
<p>This will increase as I get time to work on it, but feel free to submit a pull request with more.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked"><li><a href="#other-ga-r-libraries">Other GA R libraries</a></li>
      <li><a href="#why-do-we-need-another-ga-library">Why do we need another GA library?</a></li>
      <li><a href="#install">Install</a></li>
      <li><a href="#to-use---v4-api-calls">To use - v4 API calls</a></li>
      <li><a href="#to-use---v3-api-calls">To use - v3 API calls</a></li>
      <li><a href="#using-your-own-google-developer-project-api-key">Using your own Google Developer Project API Key</a></li>
      <li><a href="#shiny">Shiny</a></li>
      <li><a href="#bigquery">BigQuery</a></li>
      </ul></div>
      </div>

</div>


      <footer><p>Built by <a href="http://hadley.github.io/pkgdown/">pkgdown</a>. Styled with <a href="http://getbootstrap.com">Bootstrap 3</a>.</p>
      </footer></div>

  </body></html>
