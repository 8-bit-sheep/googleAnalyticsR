<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Setting up Google Analytics API downloads to R • googleAnalyticsR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Setting up Google Analytics API downloads to R">
<meta property="og:description" content="googleAnalyticsR">
<meta property="og:image" content="https://code.markedmondson.me/googleAnalyticsR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-47480439-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-47480439-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">googleAnalyticsR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/setup.html">
    <span class="fas fa-wrench"></span>
     
    Setup
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-table"></span>
     
    Reporting APIs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/reporting-ga4.html">
        <span class="fas fa-digital-tachograph"></span>
         
        GA4 Data API
      </a>
    </li>
    <li>
      <a href="../articles/measurement-protocol-v2.html">
        <span class="fas fa-upload"></span>
         
        Measurement Protocol
      </a>
    </li>
    <li>
      <a href="../articles/v4.html">
        <span class="fas fa-cogs"></span>
         
        v4 API
      </a>
    </li>
    <li>
      <a href="../articles/user-activity.html">
        <span class="fas fa-user"></span>
         
        User Activity API
      </a>
    </li>
    <li>
      <a href="../articles/v3.html">
        <span class="fas fa-cog"></span>
         
        v3 API
      </a>
    </li>
    <li>
      <a href="../articles/big-query.html">
        <span class="fas fa-search"></span>
         
        BigQuery
      </a>
    </li>
    <li>
      <a href="../articles/ganalytics.html">
        <span class="fas fa-bullseye"></span>
         
        ganalytics
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/management.html">
    <span class="fas fa-briefcase"></span>
     
    Management API
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-file"></span>
     
    Publishing
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/shiny.html">
        <span class="fas fa-cloud-upload"></span>
         
        Shiny
      </a>
    </li>
    <li>
      <a href="../articles/rmarkdown.html">
        <span class="fas fa-pencil-square"></span>
         
        RMarkdown
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-calculator"></span>
     
    Models
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/models.html">
        <span class="fas fa-calculator"></span>
         
        Creating Models
      </a>
    </li>
    <li>
      <a href="../articles/model-templates.html">
        <span class="fas fa-photo-video"></span>
         
        Shiny Model Templates
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-question-circle"></span>
     
    Help
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../reference/index.html">
        <span class="fas fa-book-reader"></span>
         
        Function Reference
      </a>
    </li>
    <li>
      <a href="../news/index.html">
        <span class="fas fa-newspaper"></span>
         
        News
      </a>
    </li>
    <li>
      <a href="../articles/faq.html">
        <span class="fas fa-glasses"></span>
         
        FAQs
      </a>
    </li>
    <li>
      <a href="../articles/practical-tips.html">
        <span class="fas fa-bicycle"></span>
         
        Practical tips
      </a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MarkEdmondson1234/googleAnalyticsR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="setup_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Setting up Google Analytics API downloads to R</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MarkEdmondson1234/googleAnalyticsR/blob/master/vignettes/setup.Rmd"><code>vignettes/setup.Rmd</code></a></small>
      <div class="hidden name"><code>setup.Rmd</code></div>

    </div>

    
    
<p>This guide will walk you through the steps required to properly set up googleAnalyticsR in terms of installation and authentication.</p>
<p>It assumes you have R installed on your machine and access rights to one or more Google Analytics accounts. In this case it will only take a few lines of R code to make a first test call to the GA API following the examples below.</p>
<p>The rest of this guide will give you an overview of the available set up options and cover some good practices to follow under different scenarios of use.</p>
<div id="quickstart-rstudio-cloud-project" class="section level2">
<h2 class="hasAnchor">
<a href="#quickstart-rstudio-cloud-project" class="anchor"></a>0. Quickstart RStudio Cloud Project</h2>
<p>If you wish to try out the library before installation, an RStudio Cloud project is available that has the library pre-installed.</p>
<p><a href="https://rstudio.cloud/project/1125233">Click this link and log in to RStudio Cloud to try it out</a>.</p>
<p>Once you are logged in, issue the following two R commands in the R console bottom-left:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://code.markedmondson.me/googleAnalyticsR/">googleAnalyticsR</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/ga_auth.html">ga_auth</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Select <code>1: Yes</code> to say you wish to keep your OAuth access credentials.</p>
<p>The library should then launch a browser window and ask you to login to Google - log in with an email that has access to your Google Analytics - it will take you to a screen with an OOB token. Copy-paste that token back into RStudio:</p>
<p><img src="rstudio-oob.png"></p>
<p>(The OOB token is only needed on RStudio Cloud - if you have googleAnalyticsR installed locally on your desktop it will authenticate automatically via <code>httpuv</code>)</p>
<p>You should then be authenticated and ready to use the functions in the package. Try <code><a href="../reference/ga_account_list.html">ga_account_list()</a></code> as a way to check you are authenticated correctly:</p>
<p><img src="test_ga_account_list.png"></p>
</div>
<div id="install" class="section level2">
<h2 class="hasAnchor">
<a href="#install" class="anchor"></a>1. Install</h2>
<p>The latest stable version of <code>googleAnalyticsR</code> is available on CRAN. <img src="http://www.r-pkg.org/badges/version/googleAnalyticsR" alt="CRAN"></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"googleAnalyticsR"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div id="development-version-off-github" class="section level3">
<h3 class="hasAnchor">
<a href="#development-version-off-github" class="anchor"></a>Development version off GitHub</h3>
<p>You may prefer to use the latest development version on GitHub which you can install via the below.</p>
<p>Build status: <img src="https://badger-ewjogewawq-ew.a.run.app/build/status?project=mark-edmondson-gde&amp;id=4ae2fa13-b1d8-41f3-b846-8bf3c67f050a" alt="CloudBuild"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"MarkEdmondson1234/googleAnalyticsR"</span><span class="op">)</span></code></pre></div>
<p>Check out the <a href="https://code.markedmondson.me/googleAnalyticsR/news/">NEWS</a> to see what is currently available in each version and the <a href="https://code.markedmondson.me/googleAnalyticsR/dev/">development version of the website here</a> which carries experimental documentation.</p>
</div>
<div id="optional-opt-in-tracking-of-library-use" class="section level3">
<h3 class="hasAnchor">
<a href="#optional-opt-in-tracking-of-library-use" class="anchor"></a>Optional opt-in tracking of library use</h3>
<p>If you are not opted in and its an interactive session, this message appears on first startup:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://code.markedmondson.me/googleAnalyticsR/">googleAnalyticsR</a></span><span class="op">)</span>
<span class="co">#You can opt in to tracking of your use of googleAnalyticsR - see ?ga_trackme for details.</span></code></pre></div>
<p>If you run <code><a href="../reference/ga_trackme.html">ga_trackme()</a></code> then you get this dialogue:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">ga_trackme</span>()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>── Tracking Consent <span class="cf">for</span> googleAnalyticsR usage ──────────────────────</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>ℹ This <span class="cf">function</span> opts you <span class="cf">in</span> or out of sending a tracking hit each time the library loads.  It is done using <span class="fu">ga_trackme_event</span>().</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>Do you opt <span class="cf">in</span> to tracking each time you load googleAnalyticsR?</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> Absolutely not</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> No way</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> Yeah</span></code></pre></div>
<p>If you opt-in it creates an <code>.optin-googleanalyticsr</code> file with your client.id (the ID associated with you)</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>✓ Thanks<span class="sc">!</span> Your consent and an ID will be marked by the presence of the file .optin<span class="sc">-</span>googleanalyticsr.  Delete it or run this <span class="cf">function</span> again to remove consent.</span></code></pre></div>
<p>When opted-in, on library load it sends a hit via the function <code><a href="../reference/ga_trackme.html">ga_trackme_event()</a></code></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(googleAnalyticsR)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>✓ Sent library load tracking event</span></code></pre></div>
<p>You can examine what is sent in that hit by looking at <code><a href="../reference/ga_trackme.html">ga_trackme_event(debug=TRUE)</a></code></p>
<p>Its sending your R session info (no personal data) to my GA4 account.</p>
<p>You can send your own message to the analytics with the <code>say_hello</code> argument:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># use debug=TRUE to see what would be sent, debug=FALSE will send it</span>
<span class="fu"><a href="../reference/ga_trackme.html">ga_trackme_event</a></span><span class="op">(</span>debug <span class="op">=</span> <span class="cn">TRUE</span>, say_hello <span class="op">=</span> <span class="st">"I love you"</span><span class="op">)</span></code></pre></div>
</div>
<div id="docker-image" class="section level3">
<h3 class="hasAnchor">
<a href="#docker-image" class="anchor"></a>Docker image</h3>
<p>If you know docker, then a public image is available at <code>gcr.io/gcer-public/googleanalyticsr</code></p>
<ul>
<li>
<code>gcr.io/gcer-public/googleanalyticsr:master</code> is the latest GitHub version</li>
<li>
<code>gcr.io/gcer-public/googleanalyticsr:CRAN</code> will be the last CRAN version</li>
</ul>
</div>
<div id="dependencies" class="section level3">
<h3 class="hasAnchor">
<a href="#dependencies" class="anchor"></a>Dependencies</h3>
<p><code>googleAnalyticsR</code> requires the packages described in the <a href="https://github.com/MarkEdmondson1234/googleAnalyticsR/blob/master/DESCRIPTION"><code>Imports</code> field of the <code>DESCRIPTION</code> file</a> to be installed first, which it will do via <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages("googleAnalyticsR", dependencies = TRUE)</a></code></p>
<p>The dependencies are roughly split into the following roles:</p>
<ul>
<li>
<code>googleAuthR</code>, <code>gargle</code> are used for authentication with Google APIs</li>
<li>
<code>jsonlite</code>, <code>httr</code> work with API responses</li>
<li>Tidyverse packages such as <code>dplyr</code> and <code>purrr</code> are used to make outputs easy to use (clean data.frames rather than nested lists)</li>
</ul>
<p>Note that on linux systems, due to its reliance on <a href="https://CRAN.R-project.org/package=httr"><code>httr</code></a> and in turn <a href="https://CRAN.R-project.org/package=curl"><code>curl</code></a>, it may require installation of these dependencies via <code>apt-get</code> or similar: <code>libssl-dev</code> and <code>libcurl4-openssl-dev</code>.</p>
<p>If you install <code>httpuv</code> then the authentication flows will occur behind the scenes - this is normally installed by default but if you do not include it you will need to use the more manual OOB method to generate authentication tokens.</p>
</div>
</div>
<div id="make-your-first-api-call" class="section level2">
<h2 class="hasAnchor">
<a href="#make-your-first-api-call" class="anchor"></a>2. Make your first API call</h2>
<p>Once you have installed the package you can make a first call to the GA API to test the connection.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## setup</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://code.markedmondson.me/googleAnalyticsR/">googleAnalyticsR</a></span><span class="op">)</span>

<span class="co">## This should send you to your browser to authenticate your email. </span>
<span class="co"># Authenticate with an email that has access to the </span>
<span class="co"># Google Analytics View you want to use.</span>
<span class="fu"><a href="../reference/ga_auth.html">ga_auth</a></span><span class="op">(</span><span class="op">)</span>

<span class="co">## get your accounts</span>
<span class="va">account_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_account_list.html">ga_account_list</a></span><span class="op">(</span><span class="op">)</span>

<span class="co">## account_list will have a column called "viewId"</span>
<span class="va">account_list</span><span class="op">$</span><span class="va">viewId</span>

<span class="co">## View account_list and pick the viewId you want to extract data from. </span>
<span class="va">ga_id</span> <span class="op">&lt;-</span> <span class="fl">123456</span>

<span class="co">## simple query to test connection, get 10 rows</span>
<span class="fu"><a href="../reference/google_analytics.html">google_analytics</a></span><span class="op">(</span><span class="va">ga_id</span>,
                 date_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2017-01-01"</span>, <span class="st">"2017-03-01"</span><span class="op">)</span>,
                 metrics <span class="op">=</span> <span class="st">"sessions"</span>,
                 dimensions <span class="op">=</span> <span class="st">"date"</span>,
                 max <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<p>You can find more code examples to query the API in <a href="http://code.markedmondson.me/googleAnalyticsR/articles/v4.html">v4 API</a> and <a href="http://code.markedmondson.me/googleAnalyticsR/articles/v3.html">v3 API</a> sections of the site.</p>
</div>
<div id="choose-authentication-method" class="section level2">
<h2 class="hasAnchor">
<a href="#choose-authentication-method" class="anchor"></a>3. Choose authentication method</h2>
<div id="tldr" class="section level3">
<h3 class="hasAnchor">
<a href="#tldr" class="anchor"></a>TL;DR</h3>
<p>Use <code><a href="../reference/ga_auth_setup.html">ga_auth_setup()</a></code> to configure your own GCP project and set up auto-authentication options.</p>
<p>Recommended long term defaults are:</p>
<ol style="list-style-type: decimal">
<li>Create your own GCP project, download the client JSON and save to a global location, which you point to via a environment argument <code>GAR_CLIENT_JSON</code> in an <code>.Renviron</code> file e.g. <code>GAR_CLIENT_JSON=~/dev/auth/client.json</code>
</li>
<li>Authenticate with <code><a href="../reference/ga_auth.html">ga_auth(email="your@email.com")</a></code> to create an authentication token cache, and repeat the <code><a href="../reference/ga_auth.html">ga_auth(email="your@email.com")</a></code> call to default to that email in future API calls</li>
<li>Set an environment argument <code>GARGLE_EMAIL</code> in the same <code>.Renviron</code> file to your email to auto-authenticate on package load e.g. <code>GARGLE_EMAIL=your@email.com</code>
</li>
</ol>
</div>
<div id="details" class="section level3">
<h3 class="hasAnchor">
<a href="#details" class="anchor"></a>Details</h3>
<p>To access the GA API authentication is required.</p>
<p>The example in the previous section used the simplest among the three available ways to authenticate to the API. If you are planning to make systematic use of the API however, it’s worth to know all the available options in order to choose the most suitable.</p>
<p>Note that no matter which method you use, the authentication is actually done via the <a href="http://code.markedmondson.me/googleAuthR/articles/google-authentication-types.html"><code>googleAuthR</code></a> package. In its documentation pages you can read more about advanced use cases.</p>
<p>To authenticate you need a client project (that authentication is performed through) and the user email to authenticate with (that gives access to that user’s Google Analytics accounts)</p>
</div>
<div id="email-authentication" class="section level3">
<h3 class="hasAnchor">
<a href="#email-authentication" class="anchor"></a>Email authentication</h3>
<p>As of version <code>googleAnalyticsR&gt;=0.6.0.9000</code> authentication is done via the <a href="https://CRAN.R-project.org/package=gargle"><code>gargle</code> package</a>. This creates a global cache that is accessed via the email you authenticate with.</p>
<p>If you use <code><a href="../reference/ga_auth.html">ga_auth()</a></code> the first time then it will ask you to create email credentials. You can then authenticate in the browser via your email. The next time you wish to authenticate, <code><a href="../reference/ga_auth.html">ga_auth()</a></code> will give you an option to use those credentials again:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://code.markedmondson.me/googleAnalyticsR/">googleAnalyticsR</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/ga_auth.html">ga_auth</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;The googleAnalyticsR package is requesting access to your Google account. </span>
<span class="co">#&gt; Select a pre-authorised account or enter '0' to obtain a new token. Press  #&gt;Esc/Ctrl + C to abort.</span>

<span class="co">#&gt; 1: mark@work.com</span>
<span class="co">#&gt; 2: home@home.com</span></code></pre></div>
<p>If you want to skip the menu, supply the email you wish to authenticate with:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(googleAnalyticsR)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ga_auth</span>(<span class="at">email =</span> <span class="st">"mark@work.com)</span></span></code></pre></div>
<p>To auto-authenticate on package load, add an environment argument <code>GARGLE_EMAIL</code> via an <code>.Renviron</code> file or otherwise.</p>
<p>e.g. in <code>.Renviron</code></p>
<p><code>GARGLE_EMAIL=your@email.com</code></p>
</div>
<div id="try-it-out-mode-the-default-googleanalyticsr-project" class="section level3">
<h3 class="hasAnchor">
<a href="#try-it-out-mode-the-default-googleanalyticsr-project" class="anchor"></a>‘Try-it-out’ mode: The default googleAnalyticsR project</h3>
<p>The fast authentication way of the previous section worked via the default Google Cloud Project for googleAnalyticsR which is shared with all googleAnalyticsR users. Even though it is a shared project other package users are not able to see and access your GA data.</p>
<p>However since Google has changed verification processes, the consent screen for the default googleAnalyticsR library may warn of ‘danger’, which you will need to trust and accept if you want to continue using the default project. It is preferred to use your own and get your own verificataion process.</p>
<p>You can not use the default project for scheduled scripts on servers - only interactivly. The default library is only intended for users to get to know the library looking for data as quickly as possible.</p>
<p>With the amount of API calls possible with this library via batching and walking, its more likely the default shared Google API project will hit the 50,000 calls per day quota.</p>
<p>However, using the default project means you will not need to go through the process outlined below to create your own Google Cloud Platform credentials and you can directly authenticate using the <code><a href="../reference/ga_auth.html">ga_auth()</a></code> function and your browser as soon as the library is downloaded.</p>
</div>
<div id="ga_auth_setup" class="section level3">
<h3 class="hasAnchor">
<a href="#ga_auth_setup" class="anchor"></a>ga_auth_setup()</h3>
<p>A new setup function is available in versions &gt;0.7.2 - use this to launch a wizard that will help you walk through some of the more advanced authentication setups detailed below. You will need to create your own Google Cloud Project and download a client Id file to get started.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://code.markedmondson.me/googleAnalyticsR/">googleAnalyticsR</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/ga_auth_setup.html">ga_auth_setup</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#ℹ ==Welcome to googleAnalyticsR v0.7.1.9000 setup==</span>
<span class="co">#This wizard will scan your system for setup options and help you with any that are missing. </span>
<span class="co">#Hit 0 or ESC to cancel. </span>
<span class="co">#</span>
<span class="co">#1: Setup your own client ID and secret</span>
<span class="co">#2: Setup auto-authentication (OAuth2 email)</span>
<span class="co">#3: Create and download JSON service account key</span>
<span class="co">#4: Setup auto-authentication (JSON service account key)</span>
<span class="co">#5: Add a service account email or another email to your GA account</span></code></pre></div>
</div>
<div id="professional-mode-your-own-google-project" class="section level3">
<h3 class="hasAnchor">
<a href="#professional-mode-your-own-google-project" class="anchor"></a>‘Professional’ mode: Your own Google Project</h3>
<p>To mitigate all the above, use your own Google Developer Console client ID, so it is not shared across all users of this library.</p>
<p>The easiest way to set this up is to create your own Google Cloud Platform project and then in R use the <code><a href="../reference/ga_auth_setup.html">ga_auth_setup()</a></code> function and select option 1.</p>
<div id="setting-up-clientid-manually" class="section level4">
<h4 class="hasAnchor">
<a href="#setting-up-clientid-manually" class="anchor"></a>Setting up clientId manually</h4>
<p>The setup function goes through the steps below.</p>
<ol style="list-style-type: decimal">
<li>Download your Google Cloud Project client JSON and place it in a location pointed to via the <code>GAR_CLIENT_JSON</code> environment argument.</li>
</ol>
<p>This file is found in the Google Cloud Platform under <code>APIs &amp; Services &gt; Credentials &gt; Create credentials &gt;  OAuth client ID &gt; Desktop</code>. For Shiny authentication, choose <code>Web application</code> instead of <code>Desktop</code>.</p>
<p>In the below examples the client ID file is downloaded to <code>~/dev/auth/gcp_client.json</code></p>
<ol start="2" style="list-style-type: decimal">
<li>Set an environment argument to point at the location of the client ID:</li>
</ol>
<pre><code># In your .Renviron
GAR_CLIENT_JSON=~/dev/auth/gcp_client.json</code></pre>
<p>You can also set your clientID before the library is available via <a href="https://code.markedmondson.me/googleAuthR/reference/gar_set_client.html"><code>googleAuthR::gar_set_client()</code></a></p>
<ol start="3" style="list-style-type: decimal">
<li>Once you have set the credentials for your project set these options before any call to <code><a href="../reference/ga_auth.html">ga_auth()</a></code> or other data fetching calls.</li>
</ol>
<p>If set via environment argument, restart R and then load the library:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Setting client.id from gar_auth_configure(path = json)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://code.markedmondson.me/googleAnalyticsR/">googleAnalyticsR</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/ga_auth.html">ga_auth</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>If setting in the script via <a href="https://code.markedmondson.me/googleAuthR/reference/gar_set_client.html"><code>googleAuthR::gar_set_client()</code></a> then it will look like this:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://code.markedmondson.me/googleAnalyticsR/">googleAnalyticsR</a></span><span class="op">)</span>
<span class="fu">googleAuthR</span><span class="fu">::</span><span class="fu"><a href="https://code.markedmondson.me/googleAuthR//reference/gar_set_client.html">gar_set_client</a></span><span class="op">(</span><span class="st">"~/dev/auth/gcp_client.json"</span><span class="op">)</span>
<span class="fu"><a href="../reference/ga_auth.html">ga_auth</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>The oldest method (deprecated) - <a href="http://donalphipps.co.uk/">Donal Phipps</a> has very kindly created a screencast on how to set this up that you can find embedded below and via <a href="https://www.youtube.com/watch?v=4B88dRbwNfc">this link</a>.</p>
<iframe width="560" height="315" src="http://www.youtube.com/embed/4B88dRbwNfc?rel=0" frameborder="0" allowfullscreen>
</iframe>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>googleAuthR.client_id <span class="op">=</span> <span class="st">"uxxxxxxx2fd4kesu6.apps.googleusercontent.com"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>googleAuthR.client_secret <span class="op">=</span> <span class="st">"3JhLa_GxxxxxCQYLe31c64"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>googleAuthR.scopes.selected <span class="op">=</span> <span class="st">"https://www.googleapis.com/auth/analytics"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="clientid-examples" class="section level3">
<h3 class="hasAnchor">
<a href="#clientid-examples" class="anchor"></a>clientId examples</h3>
<p>In the next example, the scopes are also set so a user can authenticate with <a href="http://code.markedmondson.me/searchConsoleR/"><code>searchConsoleR</code></a> at the same time, which is possible as they both use <a href="http://code.markedmondson.me/googleAuthR/"><code>googleAuthR</code></a> as a backend.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>googleAuthR<span class="sc">::</span><span class="fu">gar_set_client</span>(<span class="st">"~/dev/auth/gcp_client.json"</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">scopes =</span> <span class="fu">c</span>(<span class="st">"https://www.googleapis.com/auth/analytics"</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"https://www.googleapis.com/auth/webmasters"</span>))</span></code></pre></div>
<p>If you want to use with Shiny, then you need to download web based JSON client secrets. In that case, you then set the webapp clientId/secrets (which could be the same GCP project as the “Other” credentials.)</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>googleAuthR<span class="sc">::</span><span class="fu">gar_set_client</span>(<span class="at">web_json =</span> <span class="st">"~/dev/auth/gcp_web_client.json"</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">scopes =</span> <span class="fu">c</span>(<span class="st">"https://www.googleapis.com/auth/analytics"</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"https://www.googleapis.com/auth/webmasters"</span>))</span></code></pre></div>
<blockquote>
<p>Note: With either the default or your own GCP projects using the <code><a href="../reference/ga_auth.html">ga_auth()</a></code> function, you can specify the email you will use by passing that to the <code><a href="../reference/ga_auth.html">ga_auth()</a></code> function e.g. <code>ga_auth(email="my@email.com)</code>. This will skip the interactive menu choice for authentication. This can be useful when authenticating within an Rmarkdown document in which case it is recommended to specify your email (an Rmarkdown document can change the working directory during knitting).</p>
</blockquote>
</div>
<div id="server-mode-google-cloud-service-account" class="section level3">
<h3 class="hasAnchor">
<a href="#server-mode-google-cloud-service-account" class="anchor"></a>‘Server’ mode: Google Cloud service account</h3>
<p>You can alternatively authenticate by downloading a JSON file attached to a Google Cloud service account. More details on how to do that are on the <a href="http://code.markedmondson.me/googleAuthR/articles/google-authentication-types.html#authentication-with-a-json-file-via-service-accounts"><code>googleAuthR</code> website</a>.</p>
<p>A service authentication file then needs to be created that has edit access to the GA account. It is recommended to make a dedicated service account if you don’t need it for anything else.</p>
<p>The easiest way is to use <code><a href="../reference/ga_auth_setup.html">ga_auth_setup()</a></code> and select option 3 to create the file for you using your own details for authorization, then option 5 to add it to the GA account you need.</p>
<p>In your R script you can then authorize via:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://code.markedmondson.me/googleAnalyticsR/">googleAnalyticsR</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/ga_auth.html">ga_auth</a></span><span class="op">(</span>json_file<span class="op">=</span><span class="st">"service-key.json"</span><span class="op">)</span></code></pre></div>
<p>…or if you have set the environment arg <code>GA_AUTH_FILE</code> to the service key filepath, simply loading the library to enact auto-authenticataion.</p>
<p>This is helpful for Docker contaienrs where you don’t want to usually include any authentication files, but can specify them via environment arguments when launching the container.</p>
<div id="manual-setup" class="section level4">
<h4 class="hasAnchor">
<a href="#manual-setup" class="anchor"></a>Manual setup</h4>
<p>If you want to set it up yourself, the setup wizard goes through these steps:</p>
<ol style="list-style-type: decimal">
<li>Create your own Google Cloud Project or use an existing one.</li>
<li>Set your own client.id/secret via <code><a href="https://code.markedmondson.me/googleAuthR//reference/gar_set_client.html">googleAuthR::gar_set_client()</a></code>
</li>
<li>Service accounts for your project can be created at this link: <code>https://console.cloud.google.com/iam-admin/serviceaccounts/create</code>
</li>
<li>The service account does not need any GCP account permissions (we do that in next step when we add to GA)</li>
<li>After you can see your service account in the list, create a JSON key for that service account and download it somewhere safe</li>
<li>Copy the service email e.g. <code>ga-access@your-project.iam.gserviceaccount.com</code>
</li>
<li>Login to Google Analytics and add the email to your account at the level of permissions you want. If you want to upload data or update filters etc. then it needs at least edit permissions, if it just needs to read data then Viewer access is fine.</li>
<li>Make sure the GCP project the service key is for has both the Analytics API and the Analytics Reporting API access enabled. You can reach this via the Google API &amp; Services dashboard URL: <code>https://console.developers.google.com/apis/dashboard</code>
</li>
</ol>
<p>You should now be able to use the JSON auth file to authenticate with Google Analytics API via:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://code.markedmondson.me/googleAnalyticsR/">googleAnalyticsR</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/ga_auth.html">ga_auth</a></span><span class="op">(</span>json_file <span class="op">=</span> <span class="st">"your_auth_file.json"</span><span class="op">)</span>

<span class="co"># test authentication</span>
<span class="va">al</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_account_list.html">ga_account_list</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Note: A service account is a special type of account that belongs to an application rather than an individual user. If you should use this option, chances are you are already familiar with how they work. If however you wish to find out more about when and how to use service accounts, follow the link to the Google Cloud documentation page on <a href="https://cloud.google.com/iam/docs/understanding-service-accounts">Understanding Service Accounts</a></p>
</div>
</div>
</div>
<div id="optional-review-useful-auth-options" class="section level2">
<h2 class="hasAnchor">
<a href="#optional-review-useful-auth-options" class="anchor"></a>4 (optional): Review useful auth options</h2>
<p>This section covers some other aspects of authentication under various scenarios of use. This information is useful especially if you work systematically with Google Analytics and possibly other Google products too.</p>
<div id="auto-authentication" class="section level3">
<h3 class="hasAnchor">
<a href="#auto-authentication" class="anchor"></a>Auto-authentication</h3>
<p>To save authenticating and setting your GCP client each R session, you can specify the files/email in an <code>.Renviron</code> file that will be looked for each time you load <code><a href="https://code.markedmondson.me/googleAnalyticsR/">library(googleAnalyticsR)</a></code></p>
<ul>
<li>
<code>GAR_CLIENT_JSON</code> takes care of the GCP project client.id to authenticate under</li>
<li>
<code>GARGLE_EMAIL</code> lets you specify an email address that has already authenticated to skip the interactive menu. Make sure you authenticate with the right scopes and GCP project first in an interactive session.</li>
<li>
<code>GA_AUTH_FILE</code> is an optional argument if you have a service JSON key</li>
</ul>
<p>You can set environment arguments via <code><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv()</a></code> or using an <code>.Renviron</code> file saved in your home directory, but the recommended way is to use <code><a href="../reference/ga_auth_setup.html">ga_auth_setup()</a></code> and select option 2 (for OAuth2 email) or 4 (for JSON service account keys)</p>
<pre><code># In your .Renviron
GAR_CLIENT_JSON=~/dev/auth/gcp_client.json
GARGLE_EMAIL=my-email@me.com
GA_AUTH_FILE=/Users/me/dev/auth/keys/googleanalyticsr-auth-key.json</code></pre>
<p>Restart your R session to enact the arguments created in <code>.Renviron</code> - when you load the library they will be loaded in.</p>
</div>
<div id="multiple-api-authentification" class="section level3">
<h3 class="hasAnchor">
<a href="#multiple-api-authentification" class="anchor"></a>Multiple API authentification</h3>
<p>If you are using more than one API for authentication (such as Search Console), then authenticate using <code><a href="https://code.markedmondson.me/googleAuthR//reference/gar_auth.html">googleAuthR::gar_auth()</a></code> instead, to ensure you authenticate with the correct scopes. See the <a href="http://code.markedmondson.me/googleAuthR/articles/google-authentication-types.html#multiple-authentication-tokens">multiple authentication</a> section on the <code>googleAuthR</code> website for details.</p>
<p>If you have set up a personal project then you can use the <code><a href="https://rdrr.io/r/base/options.html">options()</a></code> function as shown in the previous section</p>
</div>
<div id="multiple-ga-accounts" class="section level3">
<h3 class="hasAnchor">
<a href="#multiple-ga-accounts" class="anchor"></a>Multiple GA accounts</h3>
<p>Using gargle means that you get a menu option to choose which email to authenticate with each time you issue <code><a href="../reference/ga_auth.html">ga_auth()</a></code>. This makes working with multiple GA accounts a lot easier to work with.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://code.markedmondson.me/googleAnalyticsR/">googleAnalyticsR</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/ga_auth.html">ga_auth</a></span><span class="op">(</span>email<span class="op">=</span><span class="st">"mark@work.com"</span><span class="op">)</span>
<span class="va">client_one</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/google_analytics.html">google_analytics</a></span><span class="op">(</span><span class="va">ga_id_one</span>, 
                               date_range <span class="op">=</span> <span class="va">my_date_range</span>,
                               metrics <span class="op">=</span> <span class="st">"sessions"</span>, 
                               dimensions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"medium"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/ga_auth.html">ga_auth</a></span><span class="op">(</span>email<span class="op">=</span><span class="st">"mark@work3.com"</span><span class="op">)</span>
<span class="va">client_one</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/google_analytics.html">google_analytics</a></span><span class="op">(</span><span class="va">ga_id_two</span>, 
                               date_range <span class="op">=</span> <span class="va">my_date_range</span>,
                               metrics <span class="op">=</span> <span class="st">"sessions"</span>, 
                               dimensions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"medium"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="authentication-with-shiny-and-rmarkdown" class="section level3">
<h3 class="hasAnchor">
<a href="#authentication-with-shiny-and-rmarkdown" class="anchor"></a>Authentication with shiny and Rmarkdown</h3>
<p>More details about these special cases of authentication are available on the corresponding sections of this site for <a href="http://code.markedmondson.me/googleAnalyticsR/articles/shiny.html">Shiny</a> and <a href="http://code.markedmondson.me/googleAnalyticsR/articles/rmarkdown.html">Rmarkdown</a></p>
</div>
<div id="where-to-go-from-here" class="section level3">
<h3 class="hasAnchor">
<a href="#where-to-go-from-here" class="anchor"></a>Where to go from here ?</h3>
<p>Once the set up is complete you are ready to start using the package to access your GA data. To give you some ideas the <a href="http://code.markedmondson.me/googleAnalyticsR/articles/v4.html">v4 API page</a> of this site provides several examples of key functionalities provided by the package.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Mark Edmondson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
