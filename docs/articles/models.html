<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pre-trained statistical models and visualisations with Google Analytics data â€¢ googleAnalyticsR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Pre-trained statistical models and visualisations with Google Analytics data">
<meta property="og:description" content="">
<meta property="og:image" content="https://code.markedmondson.me/googleAnalyticsR/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-47480439-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-47480439-2');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">googleAnalyticsR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/setup.html">
    <span class="fa fa-wrench"></span>
     
    Setup
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-table"></span>
     
    Reporting APIs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/v4.html">
        <span class="fa fa-cogs"></span>
         
        v4 API
      </a>
    </li>
    <li>
      <a href="../articles/v3.html">
        <span class="fa fa-cog"></span>
         
        v3 API
      </a>
    </li>
    <li>
      <a href="../articles/big-query.html">
        <span class="fa fa-search"></span>
         
        BigQuery
      </a>
    </li>
    <li>
      <a href="../articles/ganalytics.html">
        <span class="fa fa-bullseye"></span>
         
        ganalytics
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/management.html">
    <span class="fa fa-briefcase"></span>
     
    Management API
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-file"></span>
     
    Publishing
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/shiny.html">
        <span class="fa fa-cloud-upload"></span>
         
        Shiny
      </a>
    </li>
    <li>
      <a href="../articles/rmarkdown.html">
        <span class="fa fa-pencil-square"></span>
         
        RMarkdown
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/models.html">
    <span class="fa fa-calculator"></span>
     
    Models
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-question-circle"></span>
     
    Help
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../reference/index.html">
        <span class="fa fa-book-reader"></span>
         
        Function Reference
      </a>
    </li>
    <li>
      <a href="../news/index.html">
        <span class="fa fa-newspaper"></span>
         
        News
      </a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Pre-trained statistical models and visualisations with Google Analytics data</h1>
            
      
      
      <div class="hidden name"><code>models.Rmd</code></div>

    </div>

    
    
<p>Downloading Google Analytics data is all well and good, but the reason most users want to use the API is to then operate and act upon that data.</p>
<p>There are several tutorials linked from the homepage that demonstrate various applications of using <code>googleAnalyticsR</code> to analyse data, but they can still be intimidating for new users of R.</p>
<p>To make it easier to distribute these analysis, <code>googleAnalyticsR</code> now includes the <code>ga_model_*</code> functions to help end users get to insights more quickly.</p>
<p><code>ga_model</code> objects can be saved to the new <code>.gamr</code> format. Loading these files using <code><a href="../reference/ga_model.html">ga_model()</a></code> and specifying your own Google Analytics viewId, all the data processing, modelling and visualisation steps can be encapsulated to give you the output.</p>
<p><code>.gamr</code> files also includes the ability to create Shiny modules which you can use to quickly create online Shiny dashboards displaying the model results, and which can switch to users own Google Analytics data using the multi-user login capabilities.</p>
<p>The <code>.gamr</code> file format can be shared with others online or within your organisation. A new R package that includes some more advanced examples is available from <a href="https://github.com/IronistM/googleAnalyticsModelR/"><code>IronistM/googleAnalyticsModelR/</code></a></p>
<div id="pre-packaged-examples" class="section level2">
<h2 class="hasAnchor">
<a href="#pre-packaged-examples" class="anchor"></a>Pre-packaged examples</h2>
<p>A ready-made model is available in the <a href="https://github.com/IronistM/googleAnalyticsModelR/"><code>googleAnalyticsModelR</code> package</a>. This function loads the pre-made model object created by the <code>ga_model_*</code> functions in <code>googleAnalyticsR</code>. Some examples include:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(prophet)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(googleAnalyticsR)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(googleAnalyticsModelR)

my_view_id &lt;-<span class="st"> </span><span class="dv">81416156</span>

forecast_data &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/googleAnalyticsModelR/topics/ga_model_prophet">ga_model_prophet</a></span>(my_view_id, <span class="dt">interactive_plot =</span> <span class="ot">FALSE</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(forecast_data<span class="op">$</span>plot)</code></pre></div>
<p><img src="models_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">output &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/googleAnalyticsModelR/topics/ga_time_normalised">ga_time_normalised</a></span>(my_view_id, <span class="dt">interactive_plot =</span> <span class="ot">FALSE</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(output<span class="op">$</span>plot)</code></pre></div>
<p><img src="models_files/figure-html/unnamed-chunk-1-2.png" width="700"></p>
</div>
<div id="a-simple-example-loading-a-model-directly" class="section level2">
<h2 class="hasAnchor">
<a href="#a-simple-example-loading-a-model-directly" class="anchor"></a>A simple example loading a model directly</h2>
<p>The above loads models within a wrapper function, but you can also load model objects yourself via <code><a href="../reference/ga_model_load.html">ga_model_load()</a></code>. Included within the package are some simple models to demonstrate its use which use <code><a href="../reference/ga_model_load.html">ga_model_load()</a></code> to load from the package examples, via <code><a href="../reference/ga_model_example.html">ga_model_example()</a></code></p>
<p>The example below performs decomposition on the sessions to your website. Behind the scenes the model downloads your data with the right columns, applies the decomposition model then plots it, returning the data plotted for you to work with later:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(googleAnalyticsR)  <span class="co"># load library</span>

<span class="co"># authenticate</span>
<span class="kw"><a href="../reference/ga_auth.html">ga_auth</a></span>() 

<span class="co"># your own Google Analytics viewID</span>
my_viewid &lt;-<span class="st"> </span><span class="dv">81416156</span>

<span class="co"># load the model (equivalent to ga_model_load())</span>
decomp_ga &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ga_model_example.html">ga_model_example</a></span>(<span class="st">"decomp_ga.gamr"</span>)

<span class="co"># apply model to your data</span>
d1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ga_model.html">ga_model</a></span>(my_viewid, <span class="dt">model =</span> decomp_ga)</code></pre></div>
<p><img src="models_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>This model allows you to alter the date range of the data fetched:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># change default date range to 20 days ago to yesterday</span>
d2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ga_model.html">ga_model</a></span>(my_viewid, <span class="dt">model =</span> decomp_ga, <span class="dt">date_range =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"20daysAgo"</span>,<span class="st">"yesterday"</span>))</code></pre></div>
<p><img src="models_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div id="shiny-modules" class="section level2">
<h2 class="hasAnchor">
<a href="#shiny-modules" class="anchor"></a>Shiny modules</h2>
<p>The model can also be used to create a Shiny app, as it creates a <a href="https://shiny.rstudio.com/articles/modules.html">Shiny module</a> of the model. It is suggested this is the easiest route to turn your local GA analysis into Shiny apps.</p>
<p>An example is shown below, which allows whoever logs in to apply the model to their own Google Analytics data. You can run the app yourself via:</p>
<p><code><a href="https://www.rdocumentation.org/packages/shiny/topics/runApp">shiny::runApp(system.file("shiny/hello-world-models", package="googleAnalyticsR"))</a></code></p>
<div class="figure">
<img src="model-shiny-module.png">
</div>
<p>The model code is encapsulated in the Shiny module so the actual Shiny app is relatively simple:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(shiny)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(googleAuthR)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(googleAnalyticsR) 

<span class="kw"><a href="https://code.markedmondson.me/googleAuthR//reference/gar_set_client.html">gar_set_client</a></span>(<span class="dt">web_json =</span> <span class="st">"ga-web-client.json"</span>,
               <span class="dt">scopes =</span> <span class="st">"https://www.googleapis.com/auth/analytics.readonly"</span>)

<span class="co"># loads a pre-existing model</span>
model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ga_model_example.html">ga_model_example</a></span>(<span class="st">"decomp_ga.gamr"</span>, <span class="dt">location =</span> <span class="st">"googleAnalyticsR"</span>)

## ui.R
ui &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/shiny/topics/fluidPage">fluidPage</a></span>(<span class="dt">title =</span> <span class="st">"googleAnalyticsR Test Deployment"</span>,
                
                <span class="kw"><a href="../reference/authDropdownUI.html">authDropdownUI</a></span>(<span class="st">"auth_menu"</span>),
                <span class="kw"><a href="https://www.rdocumentation.org/packages/shiny/topics/builder">h2</a></span>(<span class="st">"Model Description"</span>),
                <span class="kw"><a href="https://www.rdocumentation.org/packages/shiny/topics/textOutput">textOutput</a></span>(<span class="st">"model_description"</span>),
                <span class="kw"><a href="https://www.rdocumentation.org/packages/shiny/topics/builder">h2</a></span>(<span class="st">"Model Output"</span>),
                model<span class="op">$</span>shiny_module<span class="op">$</span><span class="kw">ui</span>(<span class="st">"model1"</span>)
                
)

## server.R
server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session){
  
  <span class="kw"><a href="https://code.markedmondson.me/googleAuthR//reference/gar_shiny_auth.html">gar_shiny_auth</a></span>(session)
  
  al &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/shiny/topics/reactive">reactive</a></span>(<span class="kw"><a href="../reference/ga_account_list.html">ga_account_list</a></span>())
  
  <span class="co"># module for authentication</span>
  view_id &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/shiny/topics/callModule">callModule</a></span>(authDropdown, <span class="st">"auth_menu"</span>, <span class="dt">ga.table =</span> al)
  output<span class="op">$</span>model_description &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/shiny/topics/renderText">renderText</a></span>(model<span class="op">$</span>description)
  
  <span class="co"># module to display model results</span>
  <span class="kw"><a href="https://www.rdocumentation.org/packages/shiny/topics/callModule">callModule</a></span>(model<span class="op">$</span>shiny_module<span class="op">$</span>server, <span class="st">"model1"</span>, <span class="dt">view_id =</span> view_id)
  
}

<span class="kw"><a href="https://www.rdocumentation.org/packages/shiny/topics/shinyApp">shinyApp</a></span>(<span class="kw"><a href="https://code.markedmondson.me/googleAuthR//reference/gar_shiny_ui.html">gar_shiny_ui</a></span>(ui, <span class="dt">login_ui =</span> silent_auth), server)</code></pre></div>
<p>If you want to pass reactive input objects to your modelâ€™s module, do so by wrapping them in <code><a href="https://www.rdocumentation.org/packages/shiny/topics/reactive">shiny::reactive()</a></code> e.g.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw"><a href="https://www.rdocumentation.org/packages/shiny/topics/callModule">callModule</a></span>(model<span class="op">$</span>shiny_module<span class="op">$</span>server,
             <span class="st">"model1"</span>,
             <span class="dt">view_id =</span> view_id,
             <span class="dt">reactive_var =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/shiny/topics/reactive">reactive</a></span>(input<span class="op">$</span>my_option))</code></pre></div>
</div>
<div id="creating-model--gamr-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-model--gamr-objects" class="anchor"></a>Creating model <code>.gamr</code> objects</h2>
<p>To create your own models, you need to predefine all the functions to look after the fetching, modelling and viewing of the data. You then pass those functions to the <code><a href="../reference/ga_model_make.html">ga_model_make()</a></code> function.</p>
<p>The functions need to follow these specifications:</p>
<ul>
<li>
<code>data_f</code> - A function to collect the data you will need. The first argument should be the <code>view_id</code> which will be pass the viewId of Google Analytics property to fetch data from.</li>
<li>
<code>model_f</code> - A function to work with the data you have fetched. The first argument should be the data.frame that is produced by the data fetching function, <code>data_f()</code>.</li>
<li>
<code>output_f</code> - A function to plot the data. The first argument should be the data.frame that is produced by the model function, <code>model_f()</code>.</li>
<li>All functions you create must include <code>...</code> as an argument.</li>
<li>Take care if you use the same argument name that it is consistent with all functions</li>
</ul>
<p>If you want to also create the Shiny modules, then you also need to specify: * <code>outputShiny</code> - the output function for the UI, such as <code>plotOutput</code> * <code>renderShiny</code> - the render function for the server, such as <code>renderPlot</code></p>
<p>You then supply supporting information to make sure the user can run the model:</p>
<ul>
<li>
<code>required_columns</code> - Specification of which columns the data will fetch. It will fail if they are not present.</li>
<li>
<code>required_packages</code> - The packages the end user needs to have installed to run your functions.</li>
<li>
<code>description</code> - A sentence on what the model is so they can be distinguished.</li>
</ul>
<p>To create the example model above, the above was applied as shown below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">get_model_data &lt;-<span class="st"> </span><span class="cf">function</span>(viewId,
                           <span class="dt">date_range =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.time">Sys.Date</a></span>()<span class="op">-</span><span class="st"> </span><span class="dv">300</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.time">Sys.Date</a></span>()),
                           ...){
   <span class="kw"><a href="../reference/google_analytics.html">google_analytics</a></span>(viewId,
                    <span class="dt">date_range =</span> date_range,
                    <span class="dt">metrics =</span> <span class="st">"sessions"</span>,
                    <span class="dt">dimensions =</span> <span class="st">"date"</span>,
                    <span class="dt">max =</span> <span class="op">-</span><span class="dv">1</span>)
 }

decompose_sessions &lt;-<span class="st"> </span><span class="cf">function</span>(df, ...){
   <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/decompose">decompose</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/ts">ts</a></span>(df<span class="op">$</span>sessions, <span class="dt">frequency =</span> <span class="dv">7</span>))
 }
 
decomp_ga &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ga_model_make.html">ga_model_make</a></span>(get_model_data,
                           <span class="dt">required_columns =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"date"</span>, <span class="st">"sessions"</span>),
                           <span class="dt">model_f =</span> decompose_sessions,
                           <span class="dt">output_f =</span> graphics<span class="op">::</span>plot,
                           <span class="dt">description =</span> <span class="st">"Performs decomposition and creates a plot"</span>,
                           <span class="dt">outputShiny =</span> shiny<span class="op">::</span>plotOutput,
                           <span class="dt">renderShiny =</span> shiny<span class="op">::</span>renderPlot)</code></pre></div>
</div>
<div id="advanced-use" class="section level2">
<h2 class="hasAnchor">
<a href="#advanced-use" class="anchor"></a>Advanced use</h2>
<p>The more arguments you provide to the model creation functions, the more complicated it is for the end user, but the more flexible the model. It is suggested making several narrow useage models is better than one complicated one.</p>
<p>For instance, you could modify the above model to allow the end user to specify the metric, timespan and seasonality of the decomposition:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">get_model_data &lt;-<span class="st"> </span><span class="cf">function</span>(viewId,
                           <span class="dt">date_range =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.time">Sys.Date</a></span>()<span class="op">-</span><span class="st"> </span><span class="dv">300</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.time">Sys.Date</a></span>()),
                           metric,
                           ...){
   o &lt;-<span class="st"> </span><span class="kw"><a href="../reference/google_analytics.html">google_analytics</a></span>(viewId,
                    <span class="dt">date_range =</span> date_range,
                    <span class="dt">metrics =</span> metric,
                    <span class="dt">dimensions =</span> <span class="st">"date"</span>,
                    <span class="dt">max =</span> <span class="op">-</span><span class="dv">1</span>)
    <span class="co"># rename the metric column so its found for modelling</span>
    o<span class="op">$</span>the_metric &lt;-<span class="st"> </span>o[, metric]
    
    o
    
 }

decompose_sessions &lt;-<span class="st"> </span><span class="cf">function</span>(df, frequency, ...){
   <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/decompose">decompose</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/ts">ts</a></span>(df<span class="op">$</span>the_metric, <span class="dt">frequency =</span> frequency))
 }
 
decomp_ga_advanced &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ga_model_make.html">ga_model_make</a></span>(get_model_data,
                           <span class="dt">required_columns =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"date"</span>), <span class="co"># less restriction on column</span>
                           <span class="dt">model_f =</span> decompose_sessions,
                           <span class="dt">output_f =</span> graphics<span class="op">::</span>plot,
                           <span class="dt">description =</span> <span class="st">"Performs decomposition and creates a plot"</span>,
                           <span class="dt">outputShiny =</span> shiny<span class="op">::</span>plotOutput,
                           <span class="dt">renderShiny =</span> shiny<span class="op">::</span>renderPlot)</code></pre></div>
<p>It would then be used via:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ga_model.html">ga_model</a></span>(<span class="dv">81416156</span>, decomp_ga_advanced, <span class="dt">metric=</span><span class="st">"users"</span>, <span class="dt">frequency =</span> <span class="dv">30</span>)</code></pre></div>
<p><img src="models_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div id="working-with-the-model-object" class="section level3">
<h3 class="hasAnchor">
<a href="#working-with-the-model-object" class="anchor"></a>Working with the model object</h3>
<p>The model objects prints to console in a friendly manner:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">decomp_ga_advanced</code></pre></div>
<pre><code>## ==ga_model object==
## Description:  Performs decomposition and creates a plot 
## Data args:    viewId date_range metric 
## Input data:   date 
## Model args:   df frequency 
## Packages:</code></pre>
<p>You can save and load model objects from a file. It is suggested to save them with the <code>.gamr</code> suffix.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># save model to a file</span>
<span class="kw"><a href="../reference/ga_model_save.html">ga_model_save</a></span>(decomp_ga_advanced, <span class="dt">filename =</span> <span class="st">"my_model.gamr"</span>)

<span class="co"># load model again</span>
<span class="kw"><a href="../reference/ga_model_load.html">ga_model_load</a></span>(<span class="st">"my_model.gamr"</span>)</code></pre></div>
<p>You can use models directly from the file:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/ga_model.html">ga_model</a></span>(<span class="dv">81416156</span>, <span class="st">"my_model.gamr"</span>)</code></pre></div>
<p>If you need to change parts of a model, <code><a href="../reference/ga_model_edit.html">ga_model_edit()</a></code> lets you change individual aspects:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/ga_model_edit.html">ga_model_edit</a></span>(decomp_ga_advanced, <span class="dt">description =</span> <span class="st">"New description"</span>)</code></pre></div>
<pre><code>## ==ga_model object==
## Description:  New description 
## Data args:    viewId date_range metric 
## Input data:   date 
## Model args:   df frequency 
## Packages:</code></pre>
<p>You can also pass it the filename, which will load, make the edit, then save the model to disk again:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/ga_model_edit.html">ga_model_edit</a></span>(<span class="st">"my_model.gamr"</span>, <span class="dt">description =</span> <span class="st">"New description"</span>)</code></pre></div>
</div>
</div>
<div id="causalimpact-example" class="section level2">
<h2 class="hasAnchor">
<a href="#causalimpact-example" class="anchor"></a>CausalImpact example</h2>
<p>To make your own portable GA Effect, this model uses the CausalImpact and dygraphs libraries to make a plot of your GA data.</p>
<p>This example model is available via <code><a href="../reference/ga_model_example.html">ga_model_example("ga-effect.gamr")</a></code></p>
<div id="get-data" class="section level3">
<h3 class="hasAnchor">
<a href="#get-data" class="anchor"></a>Get data</h3>
<p>The data will focus on sessions per channel grouping. For this example the end user can select the date range, but we set a default of the last 600 days.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">get_ci_data &lt;-<span class="st"> </span><span class="cf">function</span>(viewId, 
                        <span class="dt">date_range =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.time">Sys.Date</a></span>()<span class="op">-</span><span class="dv">600</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.time">Sys.Date</a></span>()),
                        ...){
  
  <span class="kw"><a href="../reference/google_analytics.html">google_analytics</a></span>(viewId, 
                   <span class="dt">date_range =</span> date_range,
                   <span class="dt">metrics =</span> <span class="st">"sessions"</span>,
                   <span class="dt">dimensions =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"date"</span>, <span class="st">"channelGrouping"</span>), 
                   <span class="dt">max =</span> <span class="op">-</span><span class="dv">1</span>)
}</code></pre></div>
<p>The modelling step is copied over from the <a href="http://www.dartistics.com/timeseries.html">dartistics.com time-services example</a>.</p>
<p>The function transforms the data into the right shape, and performs the CausalImpact model. The user can select the event date to examine, the channel to test (response) and possible predictors to help the model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># response_dim is the channel to predict.</span>
<span class="co"># predictors help with forecast</span>
do_ci &lt;-<span class="st"> </span><span class="cf">function</span>(df, 
                  event_date,
                  <span class="dt">response =</span> <span class="st">"Organic Search"</span>,
                  <span class="dt">predictors =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Video"</span>,<span class="st">"Social"</span>,<span class="st">"Direct"</span>),
                  ...){
  
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/message">message</a></span>(<span class="st">"CausalImpact input data columns: "</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(df), <span class="dt">collapse =</span> <span class="st">" "</span>))
  <span class="co"># restrict to one response </span>
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/stopifnot">stopifnot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">is.character</a></span>(response), 
            <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(response) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>,
            assertthat<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/assertthat/topics/assert-is">is.date</a></span>(event_date),
            <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">is.character</a></span>(predictors))
  
  pivoted &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span>tidyr<span class="op">::</span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span>(channelGrouping, sessions)
  
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/stopifnot">stopifnot</a></span>(response <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(pivoted))
  
  ## create a time-series zoo object
  web_data_xts &lt;-<span class="st"> </span>xts<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/xts/topics/xts">xts</a></span>(pivoted[<span class="op">-</span><span class="dv">1</span>], <span class="dt">order.by =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date</a></span>(pivoted<span class="op">$</span>date), <span class="dt">frequency =</span> <span class="dv">7</span>)
  
  pre.period &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">min</a></span>(df<span class="op">$</span>date), event_date))
  post.period &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(event_date <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(df<span class="op">$</span>date)))
  
  predictors &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sets">intersect</a></span>(predictors, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(web_data_xts))

  ## data in order of response, predictor1, predictor2, etc.
  model_data &lt;-<span class="st"> </span>web_data_xts[,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(response,predictors)]
  
  <span class="co"># deal with names</span>
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(model_data) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/make.names">make.names</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(model_data))
  <span class="co"># remove any NAs</span>
  model_data[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(model_data)] &lt;-<span class="st"> </span><span class="dv">0</span>

  CausalImpact<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/CausalImpact/topics/CausalImpact">CausalImpact</a></span>(model_data,  pre.period, post.period)

}</code></pre></div>
<p>Finally the CausalImpact model is sent into Dygraphs for interactive visualisation. The event date is the same as the one sent to the modelling step, and used to indicate it on the plot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dygraph_plot &lt;-<span class="st"> </span><span class="cf">function</span>(impact, event_date, ...){
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(dygraphs)
  ## the data for the plot is in here
  ci &lt;-<span class="st"> </span>impact<span class="op">$</span>series
  
  ci &lt;-<span class="st"> </span>xts<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/xts/topics/xts">xts</a></span>(ci)

  ## the dygraph output
  <span class="kw"><a href="https://www.rdocumentation.org/packages/dygraphs/topics/dygraph">dygraph</a></span>(<span class="dt">data=</span>ci[,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'response'</span>, <span class="st">'point.pred'</span>, <span class="st">'point.pred.lower'</span>, <span class="st">'point.pred.upper'</span>)], 
          <span class="dt">main=</span><span class="st">"Expected (95% confidence level) vs Observed"</span>, <span class="dt">group=</span><span class="st">"ci"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/dygraphs/topics/dyEvent">dyEvent</a></span>(<span class="dt">x =</span> event_date, <span class="st">"Event"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/dygraphs/topics/dySeries">dySeries</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'point.pred.lower'</span>, <span class="st">'point.pred'</span>,<span class="st">'point.pred.upper'</span>), 
             <span class="dt">label=</span><span class="st">'Expected'</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/dygraphs/topics/dySeries">dySeries</a></span>(<span class="st">'response'</span>, <span class="dt">label=</span><span class="st">"Observed"</span>)
}</code></pre></div>
<p>The main functions done, we now specify which R packages the model needs the user to load.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">req_packs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"CausalImpact"</span>, <span class="st">"xts"</span>, <span class="st">"tidyr"</span>, <span class="st">"googleAnalyticsR"</span>, <span class="st">"assertthat"</span>, <span class="st">"dygraphs"</span>)</code></pre></div>
<p>Finally we make the model, specifying which columns we expect the data to fetch, a description and specifying which Shiny functions are needed to show the dygraph if the model is used in a Shiny app.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ci_model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ga_model_make.html">ga_model_make</a></span>(get_ci_data,
                          <span class="dt">required_columns =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"date"</span>,<span class="st">"channelGrouping"</span>,<span class="st">"sessions"</span>),
                          <span class="dt">model_f =</span> do_ci,
                          <span class="dt">output_f =</span> dygraph_plot,
                          <span class="dt">required_packages =</span> req_packs,
                          <span class="dt">description =</span> <span class="st">"Causal Impact on channelGrouping data"</span>,
                          <span class="dt">outputShiny =</span> dygraphs<span class="op">::</span>dygraphOutput,
                          <span class="dt">renderShiny =</span> dygraphs<span class="op">::</span>renderDygraph)
<span class="co"># print out model details</span>
ci_model</code></pre></div>
<pre><code>## ==ga_model object==
## Description:  Causal Impact on channelGrouping data 
## Data args:    viewId date_range 
## Input data:   date channelGrouping sessions 
## Model args:   df event_date response predictors 
## Packages:     CausalImpact xts tidyr googleAnalyticsR assertthat dygraphs</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># save it to a file for use later</span>
<span class="kw"><a href="../reference/ga_model_save.html">ga_model_save</a></span>(ci_model, <span class="st">"causalImpact_model.gamr"</span>)</code></pre></div>
<p>To use:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(googleAnalyticsR)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(CausalImpact)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(xts)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyr)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dygraphs)

ci &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ga_model.html">ga_model</a></span>(<span class="dv">81416156</span>, ci_model, <span class="dt">event_date =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date</a></span>(<span class="st">"2019-01-01"</span>))</code></pre></div>
<p>Similarly, you can launch this in a Shiny app by slightly modifying the example above.</p>
<p>This is available within the package via <code><a href="https://www.rdocumentation.org/packages/shiny/topics/runApp">shiny::runApp(system.file("shiny/models-ga-effect", package="googleAnalyticsR"))</a></code></p>
<div class="figure">
<img src="model-ga-effect.png">
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#pre-packaged-examples">Pre-packaged examples</a></li>
      <li><a href="#a-simple-example-loading-a-model-directly">A simple example loading a model directly</a></li>
      <li><a href="#shiny-modules">Shiny modules</a></li>
      <li><a href="#creating-model--gamr-objects">Creating model <code>.gamr</code> objects</a></li>
      <li><a href="#advanced-use">Advanced use</a></li>
      <li><a href="#causalimpact-example">CausalImpact example</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Mark Edmondson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
